<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рел рд╡рд░реНрд╖реЗ ROI рд╡рд┐рд╢реНрд▓реЗрд╖рдг | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1100px;margin:25px auto;
  background:#fff;padding:30px;border-radius:12px;
}
h2,h3{color:#2e7d32;margin-top:0}

table{
  width:100%;border-collapse:collapse;margin-top:15px;
}
th,td{
  border:1px solid #ccc;padding:8px;
}
th{background:#eef5ee}
.right{text-align:right}
.note{font-size:13px;color:#555;margin-top:8px}

@media print{
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="wrap">

<h2>ЁЯУИ рел рд╡рд░реНрд╖реЗ ROI рддрдерд╛ рд╡рд┐рддреНрддреАрдп рд╕реВрдЪрдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</h2>

<!-- ================= BASIC CASH FLOW ================= -->
<h3>рез. рдЖрдзрд╛рд░рднреВрдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣ (рд╡рд╛рд░реНрд╖рд┐рдХ)</h3>
<table>
<tr><th>рд╡рд┐рд╡рд░рдг</th><th class="right">рд░рдХрдо (рд░реБ.)</th></tr>
<tr><td>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td><td class="right" id="inc"></td></tr>
<tr><td>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</td><td class="right" id="op"></td></tr>
<tr><td>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</td><td class="right" id="dep"></td></tr>
<tr><td>рдмреНрдпрд╛рдЬ</td><td class="right" id="int"></td></tr>
<tr><td>рдХрд░ рдЕрдШрд┐рдХреЛ рдирд╛рдлрд╛ (PBT)</td><td class="right" id="pbt"></td></tr>
<tr><td>рдХрд░ (реирел%)</td><td class="right" id="tax"></td></tr>
<tr><td><b>рдЦреБрдж рдирд╛рдлрд╛ (PAT)</b></td><td class="right" id="pat"></td></tr>
<tr><td><b>Operating Cash Flow</b></td><td class="right" id="ocf"></td></tr>
</table>

<!-- ================= ROI SUMMARY ================= -->
<h3>реи. рд▓рдЧрд╛рдиреА рдкреНрд░рддрд┐рдлрд▓ (ROI Summary)</h3>
<table>
<tr><th>рд╕реВрдЪрдХ</th><th class="right">рдкрд░рд┐рдгрд╛рдо</th></tr>
<tr><td>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</td><td class="right" id="inv"></td></tr>
<tr><td>Payback Period</td><td class="right" id="payback"></td></tr>
<tr><td>IRR (рдЕрдиреБрдорд╛рдирд┐рдд)</td><td class="right" id="irr"></td></tr>
<tr><td>NPV (10% Discount)</td><td class="right" id="npv"></td></tr>
</table>

<!-- ================= BANK RATIOS ================= -->
<h3>рей. рдмреИрдВрдХ/рд╡рд┐рддреНрддреАрдп рдЕрдиреБрдкрд╛рддрд╣рд░реВ</h3>
<table>
<tr><th>рдЕрдиреБрдкрд╛рдд</th><th class="right">рдореВрд▓реНрдп</th></tr>
<tr><td>DebtтАУEquity Ratio</td><td class="right" id="de"></td></tr>
<tr><td>Interest Coverage Ratio</td><td class="right" id="icr"></td></tr>
<tr><td>Cash Flow Adequacy Ratio</td><td class="right" id="cfa"></td></tr>
<tr><td>Operating Margin (%)</td><td class="right" id="opm"></td></tr>
<tr><td>Dividend / Profit Distribution (%)</td><td class="right" id="divr"></td></tr>
</table>

<p class="note">
тЬФя╕П рдпреЛ рдкреЗрдЬ рдмреИрдВрдХ/рд▓рдЧрд╛рдиреАрдХрд░реНрддрд╛рдХрд╛ рд▓рд╛рдЧрд┐ рдкреВрд░реНрдг ROI рд░рд┐рдкреЛрд░реНрдЯ рд╣реЛ  
тЬФя╕П Proposal рдорд╛ рдпрд╣реА page attach рдЧрд░реНрджрд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╣реБрдиреНрдЫ
</p>

</div>

<script>
/* ================= LOAD PROJECT ================= */
let key = localStorage.getItem("activeProject");
let p = key ? JSON.parse(localStorage.getItem(key)) : {};

/* ================= INCOME ================= */
let income=0;
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));

/* ================= EXPENSE ================= */
let operating=0, depreciation=0, interest=0;
(p.expenseData||[]).forEach(e=>{
  let a=Number(e.amount||0);
  let c=(e.category||"").toLowerCase();
  let t=(e.title||"").toLowerCase();

  if(t.includes("рдмреНрдпрд╛рдЬ")||c.includes("рд▓рдЧрд╛рдиреА")) interest+=a;
  else if(c.includes("рдореЗрд╢рд┐рди")||c.includes("рдФрдЬрд╛рд░")||c.includes("рдкреВрд░реНрд╡рд╛рдзрд╛рд░"))
    depreciation+=a*0.15;
  else operating+=a;
});

/* ================= PROFIT ================= */
let PBT = income-operating-depreciation-interest;
let tax = PBT>0 ? PBT*0.25 : 0;
let PAT = PBT-tax;
let OCF = PAT + depreciation;

/* ================= INITIAL INVESTMENT ================= */
let s = p.shortInfo||{};
let investment = Number((s.bp_capital||"").replace(/[^\d]/g,"")) || 0;

/* ================= PAYBACK ================= */
let payback = OCF>0 ? (investment/OCF).toFixed(2)+" рд╡рд░реНрд╖" : "N/A";

/* ================= NPV ================= */
let rate=0.10;
let npv = -investment;
for(let y=1;y<=5;y++){
  npv += OCF / Math.pow(1+rate,y);
}

/* ================= IRR (Approx) ================= */
let irr = ((PAT/investment)*100).toFixed(1)+" %";

/* ================= RATIOS ================= */
let debt = interest>0 ? interest*10 : 0;      // approx
let equity = investment - debt;

let DE = equity>0 ? (debt/equity).toFixed(2)+" : 1" : "N/A";
let ICR = interest>0 ? (PBT+interest)/interest : "тИЮ";
let CFA = (OCF/(interest+investment/5)).toFixed(2);
let OPM = income>0 ? ((income-operating)/income*100).toFixed(1)+" %" : "0 %";

/* Dividend ratio (from PAT) */
let divPerc = 60; // default / from dividend table later

/* ================= RENDER ================= */
inc.innerText = Math.round(income);
op.innerText = Math.round(operating);
dep.innerText = Math.round(depreciation);
int.innerText = Math.round(interest);
pbt.innerText = Math.round(PBT);
tax.innerText = Math.round(tax);
pat.innerText = Math.round(PAT);
ocf.innerText = Math.round(OCF);

inv.innerText = investment;
payback.innerText = payback;
irr.innerText = irr;
npv.innerText = Math.round(npv);

de.innerText = DE;
icr.innerText = typeof ICR==="number"?ICR.toFixed(2):ICR;
cfa.innerText = CFA;
opm.innerText = OPM;
divr.innerText = divPerc+" %";
</script>

</body>
</html>

