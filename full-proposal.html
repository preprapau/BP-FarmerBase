<script>
/* ===== LOAD ACTIVE PROJECT ===== */
const key = localStorage.getItem("activeProject");
if(!key){
  alert("Active project select गरिएको छैन");
}
const project = JSON.parse(localStorage.getItem(key)) || {};

/* ===== SHORT INFO (REAL ENTRY) ===== */
const shortInfoBox = document.getElementById("shortInfoBox");
if(shortInfoBox){
  shortInfoBox.innerHTML = `
    <b>${project.orgName || ""}</b><br>
    दर्ता नं: ${project.regNo || ""}<br>
    PAN: ${project.panNo || ""}<br>
    लाभान्वित समूह: ${project.beneficiaryType || ""}<br>
    महिला: ${project.female || 0},
    पुरुष: ${project.male || 0}
  `;
}

/* ===== BUSINESS DETAIL ===== */
const bizDetail = document.getElementById("bizDetail");
if(bizDetail){
  bizDetail.innerHTML = `
    <b>उद्देश्य:</b> ${project.objective || ""}<br>
    <b>स्थान:</b> ${project.location || ""}<br>
    <b>अवधि:</b> ${project.duration || ""}
  `;
}

/* ===== EXPENSE ===== */
let expense = 0;
(project.expenses || project.expenseData || []).forEach(e=>{
  expense += Number(e.amount || 0);
});

/* ===== INCOME ===== */
let income = 0;
(project.incomes || project.incomeData || []).forEach(i=>{
  income += Number(i.amount || 0);
});

/* ===== PROFIT ===== */
const profit = income - expense;

/* ===== FILL SUMMARY ===== */
document.getElementById("sumExpense").innerText =
  expense.toLocaleString();

document.getElementById("sumIncome").innerText =
  income.toLocaleString();

document.getElementById("sumProfit").innerText =
  profit.toLocaleString();

/* ===== MAP ===== */
if(project.location){
  const map = document.getElementById("mapFrame");
  if(map){
    map.src =
      "https://maps.google.com/maps?q=" +
      encodeURIComponent(project.location) +
      "&z=13&output=embed";
  }
}

/* ===== DATE ===== */
document.getElementById("proposalDate").innerText =
  new Date().toLocaleDateString();
</script>
