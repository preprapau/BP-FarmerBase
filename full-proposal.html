<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Final Business Proposal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0;
}
.page{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#eef5ee}
.left{text-align:left}
.right{text-align:right}
.sub{background:#f6fbf6;font-weight:600}
.total{background:#e8f5e9;font-weight:700}
.note{font-size:13px;color:#555}

@media print{
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="page">

<h1 id="bpName">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡</h1>

<!-- ================= SHORT INFO ================= -->
<h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</h2>
<table>
<tr><th class="left">рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо</th><td id="si_name"></td></tr>
<tr><th class="left">рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
<tr><th class="left">рд╕рдЮреНрдЪрд╛рд▓рдХ рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
<tr><th class="left">рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
<tr><th class="left">рд╕рдореНрдкрд░реНрдХ рдирдВ</th><td id="si_phone"></td></tr>
<tr><th class="left">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐</th><td id="si_products"></td></tr>
</table>

<h3>рд╕рдВрд╕реНрдерд╛рдЧрдд рдкрд░рд┐рдЪрдп</h3>
<table>
<tr><th class="left">рджрд░реНрддрд╛ рдорд┐рддрд┐</th><td id="reg_date"></td></tr>
<tr><th class="left">рджрд░реНрддрд╛ рдирдВ</th><td id="reg_no"></td></tr>
<tr><th class="left">PAN рдирдВ</th><td id="pan_no"></td></tr>
</table>

<h3>рд▓рд╛рднрд╛рдиреНрд╡рд┐рдд рд╕рдореВрд╣</h3>
<table>
<tr><th class="left">рд╕рдореВрд╣ рдкреНрд░рдХрд╛рд░</th><td id="bg_type"></td></tr>
<tr><th class="left">рдорд╣рд┐рд▓рд╛</th><td id="bg_female"></td></tr>
<tr><th class="left">рдкреБрд░реБрд╖</th><td id="bg_male"></td></tr>
<tr><th class="left">рдЬрдореНрдорд╛</th><td id="bg_total"></td></tr>
</table>

<!-- ================= BUSINESS DETAIL ================= -->
<h2>реи. рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
<div id="bizDetail"></div>

<!-- ================= PRODUCTION ================= -->
<h2>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</h2>
<table>
<tr><th class="left">рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдмрдпрд╕реНрдХ</th><td id="p_adult"></td></tr>
<tr><th class="left">рдмреНрдпрд╛рдЙрдиреЗ рджрд░ (%)</th><td id="p_breed"></td></tr>
<tr><th class="left">рдмрдЪреНрдЪрд╛ рдореГрддреНрдпреБрджрд░ (%)</th><td id="p_death"></td></tr>
<tr><th class="left">рел рд╡рд░реНрд╖рдХреЛ рдХреБрд▓ рдмрд┐рдХреНрд░реА</th><td id="p_sale"></td></tr>
</table>

<!-- ================= EXPENSE ================= -->
<h2>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (рд╡рд┐рдзрд╛рдЧрдд)</h2>
<table>
<thead>
<tr>
  <th class="left">рд╡рд┐рдзрд╛</th>
  <th class="left">рд╢реАрд░реНрд╖рдХ</th>
  <th class="right">рд░рдХрдо</th>
</tr>
</thead>
<tbody id="expenseBox"></tbody>
<tfoot>
<tr class="total">
  <td colspan="2" class="left">рдХреБрд▓ рдЦрд░реНрдЪ</td>
  <td id="expGrand"></td>
</tr>
</tfoot>
</table>

<!-- ================= INCOME ================= -->
<h2>рел. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</h2>
<table>
<tr><th class="left">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="incTotal"></td></tr>
</table>

<!-- ================= PROFIT LOSS ================= -->
<h2>рем. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</h2>
<table>
<tr><th class="left">рдХрд░ рдЕрдШрд┐рдХреЛ рдирд╛рдлрд╛ (PBT)</th><td class="right" id="pbt"></td></tr>
<tr><th class="left">рдХрд░ (реирел%)</th><td class="right" id="tax"></td></tr>
<tr class="total"><th class="left">рдЦреБрдж рдирд╛рдлрд╛ (PAT)</th><td class="right" id="pat"></td></tr>
</table>

<!-- ================= ROI ================= -->
<h2>рен. ROI рд╕рд╛рд░рд╛рдВрд╢</h2>
<table>
<tr><th class="left">рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</th><td class="right" id="inv"></td></tr>
<tr><th class="left">Payback Period</th><td class="right" id="payback"></td></tr>
</table>

<p class="note">
тЬФя╕П рдпреЛ Proposal Print / PDF рдХрд╛ рд▓рд╛рдЧрд┐ рддрдпрд╛рд░ рдЫ  
</p>

</div>

<script>
let key=localStorage.getItem("activeProject");
let p=key?JSON.parse(localStorage.getItem(key)):{};

/* SHORT INFO */
let s=p.shortInfo||{};
bpName.innerText=s.bp_name||"рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡";
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";

reg_date.innerText=s.reg_date||"";
reg_no.innerText=s.reg_no||"";
pan_no.innerText=s.pan_no||"";

bg_type.innerText=s.benef_group_type||"";
bg_female.innerText=s.female_count||"";
bg_male.innerText=s.male_count||"";
bg_total.innerText=s.total_count||"";

/* BUSINESS DETAIL */
let bd=p.businessDetail||[];
if(!bd.length) bizDetail.innerHTML="<i>рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди</i>";
bd.forEach(d=>{
  bizDetail.innerHTML+=`<h3>${d.topic}</h3><p>${d.content}</p>`;
});

/* PRODUCTION */
let ps=JSON.parse(localStorage.getItem("productionSalesPlan")||"{}");
p_adult.innerText=ps.adult||"";
p_breed.innerText=ps.breedRate||"";
p_death.innerText=ps.death||"";
p_sale.innerText="(Calculation based)";

/* EXPENSE CATEGORY WISE */
let exp=p.expenseData||[];
let groups={},expGrand=0,interest=0,depr=0,op=0;

exp.forEach(e=>{
  if(!groups[e.category]) groups[e.category]=[];
  groups[e.category].push(e);
});

for(let c in groups){
  let sub=0;
  expenseBox.innerHTML+=`
  <tr class="sub"><td colspan="3">ЁЯФ╣ ${c}</td></tr>`;
  groups[c].forEach(e=>{
    let a=Number(e.amount||0);
    sub+=a; expGrand+=a;
    if((e.title||"").includes("рдмреНрдпрд╛рдЬ")) interest+=a;
    if(c.includes("рдореЗрд╢реАрди")||c.includes("рдкреВрд░реНрд╡рд╛рдзрд╛рд░")) depr+=a*0.15;
    else op+=a;
    expenseBox.innerHTML+=`
      <tr>
        <td></td>
        <td class="left">${e.title}</td>
        <td class="right">${a.toLocaleString("ne-NP")}</td>
      </tr>`;
  });
  expenseBox.innerHTML+=`
    <tr class="total">
      <td colspan="2" class="left">рдЙрдктАУрдЬрдореНрдорд╛</td>
      <td class="right">${sub.toLocaleString("ne-NP")}</td>
    </tr>`;
}
expGrandEl.innerText=expGrand.toLocaleString("ne-NP");

/* INCOME */
let income=0;
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));
incTotal.innerText=income.toLocaleString("ne-NP");

/* PROFIT */
let PBT=income-op-depr-interest;
let taxAmt=PBT>0?PBT*0.25:0;
let PAT=PBT-taxAmt;
pbt.innerText=Math.round(PBT).toLocaleString("ne-NP");
tax.innerText=Math.round(taxAmt).toLocaleString("ne-NP");
pat.innerText=Math.round(PAT).toLocaleString("ne-NP");

/* ROI */
let invAmt=Number((s.bp_capital||"").replace(/[^\d]/g,""))||0;
inv.innerText=invAmt.toLocaleString("ne-NP");
payback.innerText=PAT>0?(invAmt/PAT).toFixed(2)+" рд╡рд░реНрд╖":"N/A";
</script>

</body>
</html>

