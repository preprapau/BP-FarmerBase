<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
@page{margin:25mm}
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  margin:0;
  background:#f4f7f6;
}
.page{
  max-width:900px;
  margin:0 auto;
  background:#fff;
  padding:30px;
  position:relative;
  z-index:1;
}
h1,h2,h3{color:#1b5e20}
h1{font-size:28px}
h2{
  margin-top:32px;
  border-bottom:2px solid #c8e6c9;
  padding-bottom:6px;
}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px}
th{background:#f1f8e9}
.right{text-align:right}
.center{text-align:center}

/* LETTERHEAD */
.letterhead{
  display:flex;
  align-items:center;
  gap:15px;
  border-bottom:3px solid #2e7d32;
  padding-bottom:10px;
  margin-bottom:20px;
}
.lh-left img{height:70px;max-width:120px;object-fit:contain}
.lh-center{flex:1;text-align:center}
.lh-org{font-size:22px;font-weight:700;color:#1b5e20}
.lh-tagline{font-size:14px;color:#555}
.lh-address{font-size:13px;color:#333}

/* COVER */
.cover{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}

/* WATERMARK */
.watermark-img{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:520px;
  height:520px;
  background:url("project-image.jpg") center/contain no-repeat;
  opacity:0.05;
  pointer-events:none;
  z-index:0;
}

/* SUMMARY */
.summary-box{
  border:2px solid #c8e6c9;
  background:#f1f8e9;
  padding:15px;
  border-radius:8px;
}

/* MAP */
iframe{width:100%;height:260px;border:0;margin-top:10px}

/* TOC */
#autoTOC ol{padding-left:20px}
#autoTOC a{text-decoration:none;color:#000}

/* PAGE BREAK */
.page-break{page-break-before:always}

/* WARNING */
.warn{
  border:2px solid #f44336;
  background:#ffebee;
  padding:12px;
  border-radius:8px;
  color:#b71c1c;
  margin-bottom:15px;
}

/* FOOTER */
footer{
  text-align:center;
  font-size:12px;
  color:#555;
  margin-top:40px;
}

/* PRINT */
@media print{
  body{background:#fff}
  table{page-break-inside:avoid}
  h2{page-break-after:avoid}
}
</style>
</head>

<body>

<div class="watermark-img"></div>

<!-- ================= COVER PAGE ================= -->
<div class="page cover">
  <h1 id="cProject"></h1>
  <h2>कृषि व्यवसायिक प्रस्ताव</h2>
  <p><b id="cOrg"></b></p>
  <p id="cAddress"></p>
  <p>मिति: <span id="cDate"></span></p>
</div>

<div class="page-break"></div>

<!-- ================= MAIN CONTENT ================= -->
<div class="page">

<!-- LETTERHEAD -->
<div class="letterhead">
  <div class="lh-left">
    <img id="orgLogo" alt="Logo">
  </div>
  <div class="lh-center">
    <div class="lh-org" id="lhOrgName"></div>
    <div class="lh-tagline" id="lhTagline"></div>
    <div class="lh-address" id="lhAddress"></div>
  </div>
</div>

<div id="siWarning"></div>

<h2>कार्यकारी सारांश (Executive Summary)</h2>
<div class="summary-box" id="execSummary"></div>

<h2>विषय सूची (Table of Contents)</h2>
<div id="autoTOC"></div>

<h2>१. परियोजनाको संक्षिप्त विवरण</h2>
<p id="pDesc"></p>

<h2>२. संस्था विवरण</h2>
<table>
<tr><th>संस्था नाम</th><td id="oName"></td></tr>
<tr><th>ठेगाना</th><td id="oAddr"></td></tr>
<tr><th>दर्ता मिति</th><td id="oRegDate"></td></tr>
<tr><th>दर्ता निकाय</th><td id="oRegBody"></td></tr>
<tr><th>दर्ता नं</th><td id="oRegNo"></td></tr>
<tr><th>पान नं</th><td id="oPan"></td></tr>
</table>

<h2>३. परियोजना स्थान</h2>
<iframe id="mapFrame"></iframe>

<h2>४. विधागत खर्च विवरण</h2>
<div id="expenseTable"></div>

<h2>५. आम्दानी विवरण</h2>
<div id="incomeTable"></div>

<h2>६. नाफा तथा ROI विश्लेषण</h2>
<table>
<tr><th>कुल लगानी</th><td class="right" id="roiInv"></td></tr>
<tr><th>५ वर्षे कुल नाफा</th><td class="right" id="roiReturn"></td></tr>
<tr><th>ROI (%)</th><td class="right" id="roiPct"></td></tr>
<tr><th>Payback Period</th><td id="roiPay"></td></tr>
</table>

<h2>Annex : Short-Info (Auto Table)</h2>
<div id="annexShortInfo"></div>

<footer>
  © <span id="fYear"></span> <span id="fOrg"></span> | Generated by FarmerBase BPMS
</footer>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
if(!key){ alert("Project open छैन"); location.href="index.html"; }
let p = JSON.parse(localStorage.getItem(key));
let si = p.shortInfo || {};

/* COVER */
cProject.innerText = si.businessName || "व्यवसायिक परियोजना";
cOrg.innerText = si.organization || "";
cAddress.innerText = si.location || "";
cDate.innerText = new Date().toLocaleDateString("ne-NP");

/* LETTERHEAD */
orgLogo.src = si.logoURL || "logo.png";
lhOrgName.innerText = si.organization || "";
lhTagline.innerText = si.businessType ? "("+si.businessType+" व्यवसाय)" : "";
lhAddress.innerText = si.location || "";

/* EXEC SUMMARY */
execSummary.innerHTML = `
<b>${si.businessName||""}</b> नामक यो
${si.businessType||"कृषि"} व्यवसाय
${si.location||""} क्षेत्रमा सञ्चालन गरिने
${si.startYear||""} देखि
${si.duration||""} वर्ष अवधिको योजना हो।
<br><br>
यसबाट ${si.beneficiaryType||""} समूहका
जम्मा <b>${si.totalBeneficiary || (Number(si.femaleCount||0)+Number(si.maleCount||0))}</b>
जना लाभान्वित हुनेछन्।
`;

/* WARNING */
let miss=[];
["businessName","organization","location","beneficiaryType"].forEach(k=>{ if(!si[k]) miss.push(k); });
if(miss.length){
  siWarning.innerHTML=`<div class="warn">⚠️ Short-info अपूर्ण छ: ${miss.join(", ")}</div>`;
}

/* DESCRIPTION */
pDesc.innerText = si.description || "";

/* ORG */
oName.innerText = si.organization || "";
oAddr.innerText = si.location || "";
oRegDate.innerText = si.regDate || "";
oRegBody.innerText = si.regBody || "";
oRegNo.innerText = si.regNo || "";
oPan.innerText = si.pan || "";

/* MAP */
mapFrame.src = "https://www.google.com/maps?q="+encodeURIComponent(si.location||"Nepal")+"&output=embed";

/* EXPENSE */
let eHtml="<table><tr><th>विधा</th><th>शीर्षक</th><th>रकम</th></tr>";
(p.expenseData||[]).forEach(e=>{
  eHtml+=`<tr><td>${e.category}</td><td>${e.title}</td><td class="right">${e.amount}</td></tr>`;
});
eHtml+="</table>";
expenseTable.innerHTML=eHtml;

/* INCOME */
let iHtml="<table><tr><th>शीर्षक</th><th>रकम</th></tr>";
(p.incomeData||[]).forEach(i=>{
  iHtml+=`<tr><td>${i.title}</td><td class="right">${i.amount}</td></tr>`;
});
iHtml+="</table>";
incomeTable.innerHTML=iHtml;

/* ROI */
roiInv.innerText = p.fiveYearROI?.investment || 0;
roiReturn.innerText = p.fiveYearROI?.totalReturn || 0;
roiPct.innerText = p.fiveYearROI?.roi || 0;
roiPay.innerText = p.fiveYearROI?.payback || "";

/* ANNEX SHORT-INFO AUTO TABLE */
let rows="";
Object.entries({
 "व्यवसाय नाम":si.businessName,
 "व्यवसाय प्रकार":si.businessType,
 "स्थान":si.location,
 "लाभान्वित समूह":si.beneficiaryType,
 "महिला":si.femaleCount,
 "पुरुष":si.maleCount,
 "जम्मा":si.totalBeneficiary
}).forEach(([k,v])=>{
 rows+=`<tr><th>${k}</th><td>${v||""}</td></tr>`;
});
annexShortInfo.innerHTML="<table>"+rows+"</table>";

/* AUTO TOC */
(function(){
 let t="",hs=document.querySelectorAll(".page h2");
 hs.forEach((h,i)=>{ h.id="s"+i; t+=`<li><a href="#s${i}">${h.innerText}</a></li>`;});
 autoTOC.innerHTML="<ol>"+t+"</ol>";
})();

/* FOOTER */
fOrg.innerText = si.organization || "";
fYear.innerText = new Date().getFullYear();
</script>

</body>
</html>
