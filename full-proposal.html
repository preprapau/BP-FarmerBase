<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0;
}
.page{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h1,h2,h3{color:#2e7d32}
h1{text-align:center}

.section{margin-top:35px}
.section h2{
  border-bottom:2px solid #e0e0e0;
  padding-bottom:6px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#eef5ee}
.right{text-align:right}

.toc a{
  display:block;
  text-decoration:none;
  color:#2e7d32;
  margin:4px 0;
}

@media print{
  thead{display:table-header-group}
  tfoot{display:table-footer-group}
  tr{page-break-inside:avoid}
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="page">

<h1 id="title">व्यवसाय प्रस्ताव</h1>

<!-- ================= TOC ================= -->
<div class="section toc">
<h2>विषयसूची</h2>
<a href="#short">१. संक्षिप्त परिचय</a>
<a href="#prod">२. उत्पादन तथा बिक्री योजना</a>
<a href="#expense">३. खर्च विवरण</a>
<a href="#income">४. आम्दानी विवरण</a>
<a href="#profit">५. नाफा / नोक्सान</a>
</div>

<!-- ================= SHORT INFO ================= -->
<div class="section" id="short">
<h2>१. संक्षिप्त परिचय</h2>
<table>
<tr><th>व्यवसाय</th><td id="si_name"></td></tr>
<tr><th>स्थान</th><td id="si_location"></td></tr>
<tr><th>संस्था</th><td id="si_org"></td></tr>
<tr><th>सम्पर्क</th><td id="si_phone"></td></tr>
</table>
</div>

<!-- ================= PRODUCTION SALES ================= -->
<div class="section" id="prod">
<h2>२. उत्पादन तथा बिक्री योजना</h2>

<table>
<thead>
<tr>
<th>वर्ष</th>
<th>बयस्क</th>
<th>बाँचेक बच्चा</th>
<th>बिक्री (बच्चा)</th>
<th>बयस्क बिक्री</th>
<th>अर्को वर्ष बयस्क</th>
</tr>
</thead>
<tbody id="prodBody"></tbody>
</table>
</div>

<!-- ================= EXPENSE ================= -->
<div class="section" id="expense">
<h2>३. खर्च विवरण (विधागत)</h2>
<table>
<thead>
<tr>
<th>विधा</th>
<th>शीर्षक</th>
<th class="right">रकम</th>
</tr>
</thead>
<tbody id="expBody"></tbody>
<tfoot>
<tr>
<th colspan="2" class="right">कुल खर्च</th>
<th class="right" id="expTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ================= INCOME ================= -->
<div class="section" id="income">
<h2>४. आम्दानी विवरण</h2>
<table>
<thead>
<tr>
<th>शीर्षक</th>
<th class="right">रकम</th>
</tr>
</thead>
<tbody id="incBody"></tbody>
<tfoot>
<tr>
<th class="right">कुल आम्दानी</th>
<th class="right" id="incTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ================= PROFIT ================= -->
<div class="section" id="profit">
<h2>५. नाफा / नोक्सान</h2>
<table>
<tr><th>कुल आम्दानी</th><td class="right" id="pIncome"></td></tr>
<tr><th>कुल खर्च</th><td class="right" id="pExpense"></td></tr>
<tr><th>खुद नाफा</th><td class="right" id="pNet"></td></tr>
</table>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key=localStorage.getItem("activeProject");
let p=key?JSON.parse(localStorage.getItem(key)):{};

/* SHORT INFO */
let s=p.shortInfo||{};
title.innerText=s.bp_name||"व्यवसाय प्रस्ताव";
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_phone.innerText=s.bp_phone||"";

/* ===== PRODUCTION SALES (FROM productionSalesPlan) ===== */
let ps=JSON.parse(localStorage.getItem("productionSalesPlan")||"null");
if(ps){
  let adult=ps.adult;
  for(let y=1;y<=5;y++){
    let breeding=adult*ps.breedRate/100;
    let born=breeding*ps.kids;
    let alive=born*(100-ps.death)/100;

    let male=alive*ps.maleRate/100;
    let female=alive-male;

    let keepF=female*ps.keepFemale/100;
    let sellKids=alive-keepF;
    let replaceSell=adult*ps.replacement/100;

    prodBody.innerHTML+=`
      <tr>
        <td>${y}</td>
        <td>${Math.round(adult)}</td>
        <td>${Math.round(alive)}</td>
        <td>${Math.round(sellKids)}</td>
        <td>${Math.round(replaceSell)}</td>
        <td>${Math.round(adult+keepF)}</td>
      </tr>`;
    adult+=keepF;
  }
}

/* ===== EXPENSE CATEGORY WISE ===== */
let eTotal=0;
(p.expenseData||[]).forEach(e=>{
  eTotal+=Number(e.amount||0);
  expBody.innerHTML+=`
    <tr>
      <td>${e.category||""}</td>
      <td>${e.title||""}</td>
      <td class="right">${e.amount||0}</td>
    </tr>`;
});
expTotal.innerText=eTotal;

/* ===== INCOME ===== */
let iTotal=0;
(p.incomeData||[]).forEach(i=>{
  iTotal+=Number(i.amount||0);
  incBody.innerHTML+=`
    <tr>
      <td>${i.title||""}</td>
      <td class="right">${i.amount||0}</td>
    </tr>`;
});
incTotal.innerText=iTotal;

/* ===== PROFIT ===== */
pIncome.innerText=iTotal;
pExpense.innerText=eTotal;
pNet.innerText=iTotal-eTotal;
</script>

</body>
</html>
