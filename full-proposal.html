<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== BASE ===== */
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;margin:0;
  counter-reset: page;
}
.page{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:35px;
  border-radius:10px;
  page-break-after:always;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
h2{border-bottom:2px solid #e0e0e0;padding-bottom:6px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#f1f5f1}
.right{text-align:right}
.center{text-align:center}

/* ===== COVER ===== */
.cover{
  text-align:center;
  padding:90px 30px;
}
.cover h1{font-size:36px}
.tagline{font-size:18px;color:#555;margin:20px 0}
.qrbox{margin-top:25px}
.footer{
  margin-top:80px;
  font-size:14px;
  color:#555;
}

/* ===== TOC ===== */
.toc li{
  display:flex;
  justify-content:space-between;
  border-bottom:1px dotted #aaa;
  padding:6px 0;
}

/* ===== PAGE NO ===== */
@media print{
  a[href]:after{content:""}
  body{background:#fff}
}
@page{
  @bottom-right{
    content:"Page " counter(page);
  }
}
</style>
</head>

<body>

<!-- ================================================= -->
<!-- PAGE 1 : COVER -->
<!-- ================================================= -->
<div class="page cover">
  <h1 id="cv_name">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡</h1>
  <div class="tagline" id="cv_tagline">
    рд╕рддрдд рдХреГрд╖рд┐ тАв рдЖрддреНрдордирд┐рд░реНрднрд░ рдЖрдореНрджрд╛рдиреА тАв рджреАрд░реНрдШрдХрд╛рд▓реАрди рд╡рд┐рдХрд╛рд╕
  </div>

  <div class="qrbox">
    <div id="proposalQR"></div>
    <div style="font-size:13px;color:#555;margin-top:8px">
      ЁЯУ▒ QR Scan рдЧрд░реА Digital Proposal рдкрдвреНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ
    </div>
  </div>

  <div class="footer">
    <b id="cv_org"></b><br>
    <span id="cv_addr"></span>
  </div>
</div>

<!-- ================================================= -->
<!-- PAGE 2 : TABLE OF CONTENTS -->
<!-- ================================================= -->
<div class="page">
  <h2>Table of Contents</h2>
  <ol class="toc">
    <li><span>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</span><span>1</span></li>
    <li><span>реи. рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</span><span>2</span></li>
    <li><span>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</span><span>3</span></li>
    <li><span>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг</span><span>4</span></li>
    <li><span>рел. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</span><span>5</span></li>
    <li><span>рем. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рддрдерд╛ рд▓рд╛рднрд╛рдВрд╢</span><span>6</span></li>
    <li><span>рен. рел рд╡рд░реНрд╖реЗ ROI</span><span>7</span></li>
  </ol>
</div>

<!-- ================================================= -->
<!-- PAGE 3 : SHORT INFO -->
<!-- ================================================= -->
<div class="page">
  <h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</h2>
  <table>
    <tr><th>рд╡реНрдпрд╡рд╕рд╛рдп рдирд╛рдо</th><td id="si_name"></td></tr>
    <tr><th>рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
    <tr><th>рд╕рдЮреНрдЪрд╛рд▓рди рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
    <tr><th>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
    <tr><th>рд╕рдореНрдкрд░реНрдХ рдирдореНрдмрд░</th><td id="si_phone"></td></tr>
    <tr><th>рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐</th><td id="si_products"></td></tr>
    <tr><th>рдореБрдЦреНрдп рдмрдЬрд╛рд░</th><td id="si_market"></td></tr>
    <tr><th>рдХреБрд▓ рдкреВрдБрдЬреА</th><td id="si_capital"></td></tr>
  </table>
</div>

<!-- ================================================= -->
<!-- PAGE 4 : EXECUTIVE SUMMARY -->
<!-- ================================================= -->
<div class="page">
  <h2>реи. рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</h2>
  <p id="execSummary"></p>
</div>

<!-- ================================================= -->
<!-- PAGE 5 : PRODUCTION SUMMARY -->
<!-- ================================================= -->
<div class="page">
  <h2>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</h2>
  <table>
    <tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд╡рдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td id="ps_adult"></td></tr>
    <tr><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдЙрддреНрдкрд╛рджрди (рдФрд╕рдд)</th><td id="ps_production"></td></tr>
    <tr><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдмрд┐рдХреНрд░реА (рдФрд╕рдд)</th><td id="ps_sell"></td></tr>
    <tr><th>рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди</th><td id="ps_replace"></td></tr>
    <tr><th>рел рд╡рд░реНрд╖рдХреЛ рдХреБрд▓ рдмрд┐рдХреНрд░реА</th><td id="ps_5yr"></td></tr>
  </table>
</div>

<!-- ================================================= -->
<!-- PAGE 6 : EXPENSE -->
<!-- ================================================= -->
<div class="page">
  <h2>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг</h2>
  <table>
    <thead>
      <tr>
        <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
        <th>рд╢реАрд░реНрд╖рдХ</th>
        <th class="right">рд░рдХрдо</th>
      </tr>
    </thead>
    <tbody id="expBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="2" class="right">рдХреБрд▓ рдЦрд░реНрдЪ</th>
        <th class="right" id="expTotal"></th>
      </tr>
    </tfoot>
  </table>
</div>

<!-- ================================================= -->
<!-- PAGE 7 : INCOME -->
<!-- ================================================= -->
<div class="page">
  <h2>рел. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</h2>
  <table>
    <thead>
      <tr>
        <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
        <th>рд╢реАрд░реНрд╖рдХ</th>
        <th class="right">рд░рдХрдо</th>
      </tr>
    </thead>
    <tbody id="incBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="2" class="right">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
        <th class="right" id="incTotal"></th>
      </tr>
    </tfoot>
  </table>
</div>

<!-- ================================================= -->
<!-- PAGE 8 : PROFIT / DIVIDEND -->
<!-- ================================================= -->
<div class="page">
  <h2>рем. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рддрдерд╛ рд▓рд╛рднрд╛рдВрд╢</h2>
  <table>
    <tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="pl_inc"></td></tr>
    <tr><th>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</th><td class="right" id="pl_cash"></td></tr>
    <tr><th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (15%)</th><td class="right" id="pl_dep"></td></tr>
    <tr><th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th><td class="right" id="pl_int"></td></tr>
    <tr><th>рдХрд░ рдЕрдШрд┐рдХреЛ рдирд╛рдлрд╛ (PBT)</th><td class="right" id="pl_pbt"></td></tr>
    <tr><th>рдХрд░ (25%)</th><td class="right" id="pl_tax"></td></tr>
    <tr><th><b>рдЦреБрдж рдирд╛рдлрд╛ (PAT)</b></th><td class="right" id="pl_pat"></td></tr>
  </table>

  <h3 style="margin-top:25px">рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>
  <table>
    <tr><th>рд╡рд┐рдзрд╛</th><th>%</th><th class="right">рд░рдХрдо</th></tr>
    <tr><td>рд╕реНрд╡рд╛рдореА / рд╕рд╛рдЭреЗрджрд╛рд░</td><td>60%</td><td class="right" id="div_owner"></td></tr>
    <tr><td>рдкреБрдирдГ рд▓рдЧрд╛рдиреА</td><td>40%</td><td class="right" id="div_reinvest"></td></tr>
  </table>
</div>

<!-- ================================================= -->
<!-- PAGE 9 : 5 YEAR ROI -->
<!-- ================================================= -->
<div class="page">
  <h2>рен. рел рд╡рд░реНрд╖реЗ ROI рд╕рд╛рд░рд╛рдВрд╢</h2>
  <table id="roiTable">
    <tr>
      <th>рд╡рд░реНрд╖</th><th>рдЖрдореНрджрд╛рдиреА</th><th>рдЦрд░реНрдЪ</th>
      <th>рдирд╛рдлрд╛</th><th>рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</th>
    </tr>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
<script>
/* ===== LOAD DATA ===== */
let key=localStorage.getItem("activeProject");
let p=JSON.parse(localStorage.getItem(key)||"{}");
let s=p.shortInfo||{};

/* ===== COVER ===== */
cv_name.innerText=s.bp_name||"рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡";
cv_org.innerText=s.bp_org||"";
cv_addr.innerText=s.bp_location||"";

/* ===== QR ===== */
new QRious({
  element:document.getElementById("proposalQR"),
  value:location.href,
  size:160
});

/* ===== SHORT INFO ===== */
si_name.innerText=s.bp_name||"";
si_org.innerText=s.bp_org||"";
si_location.innerText=s.bp_location||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";
si_market.innerText=s.bp_market||"";
si_capital.innerText=s.bp_capital||"";

/* ===== EXPENSE / INCOME ===== */
let incT=0, expCash=0, dep=0, interest=Number(p.loanInterest||0);
(p.incomeData||[]).forEach(i=>{
  incT+=Number(i.amount||0);
  incBody.innerHTML+=`<tr><td>${i.category}</td><td>${i.title}</td><td class="right">${i.amount}</td></tr>`;
});
(p.expenseData||[]).forEach(e=>{
  expBody.innerHTML+=`<tr><td>${e.category}</td><td>${e.title}</td><td class="right">${e.amount}</td></tr>`;
  if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")
    dep+=Number(e.amount||0)*0.15;
  else
    expCash+=Number(e.amount||0);
});
expTotal.innerText=Math.round(expCash+dep);
incTotal.innerText=Math.round(incT);

/* ===== PROFIT ===== */
pl_inc.innerText=incT;
pl_cash.innerText=Math.round(expCash);
pl_dep.innerText=Math.round(dep);
pl_int.innerText=interest;
let pbt=incT-expCash-dep-interest;
let tax=Math.round(pbt*0.25);
let pat=pbt-tax;
pl_pbt.innerText=Math.round(pbt);
pl_tax.innerText=tax;
pl_pat.innerText=Math.round(pat);
div_owner.innerText=Math.round(pat*0.6);
div_reinvest.innerText=Math.round(pat*0.4);

/* ===== EXEC SUMMARY ===== */
execSummary.innerText=
`рдпрд╕ ${s.bp_products||""} рд╡реНрдпрд╡рд╕рд╛рдп рдЕрдиреНрддрд░реНрдЧрдд рдХреБрд▓ рдкреВрдБрдЬреА ${s.bp_capital||""} рд▓рдЧрд╛рдиреА рдЧрд░реА рд╕рдЮреНрдЪрд╛рд▓рди рдкреНрд░рд╕реНрддрд╛рд╡ рдЧрд░рд┐рдПрдХреЛ рдЫред
рд╡рд╛рд░реНрд╖рд┐рдХ рдЖрдореНрджрд╛рдиреА рдХрд░рд┐рдм ${incT} рд░рд╣рдиреЗ рд░ рдЦреБрдж рдирд╛рдлрд╛ ${Math.round(pat)} рд╣реБрдиреЗ рдЕрдиреБрдорд╛рди рдЫред
рел рд╡рд░реНрд╖реЗ рдЕрд╡рдзрд┐рдорд╛ рд▓рдЧрд╛рдиреА рдлрд┐рд░реНрддрд╛ рд╣реБрдиреЗ рддрдерд╛ рджреАрд░реНрдШрдХрд╛рд▓реАрди рд▓рд╛рдн рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реБрдиреЗ рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░рд┐рдПрдХреЛ рдЫред`;

/* ===== ROI TABLE ===== */
let table=document.getElementById("roiTable");
let cum=0, income=incT, expense=expCash+dep;
for(let y=1;y<=5;y++){
  let profit=income-expense;
  cum+=profit;
  table.innerHTML+=`
    <tr>
      <td>рд╡рд░реНрд╖ ${y}</td>
      <td class="right">${Math.round(income)}</td>
      <td class="right">${Math.round(expense)}</td>
      <td class="right">${Math.round(profit)}</td>
      <td class="right">${Math.round(cum)}</td>
    </tr>`;
  income*=1.1; expense*=1.06;
}
</script>

</body>
</html>
