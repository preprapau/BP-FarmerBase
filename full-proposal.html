<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1100px;margin:25px auto;
  background:#fff;padding:30px;border-radius:12px;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
hr{margin:30px 0;border:none;border-top:1px solid #ddd}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px}
th{background:#eef5ee}
.right{text-align:right}
.center{text-align:center}
.note{font-size:13px;color:#555;margin-top:8px}

@media print{
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="wrap">

<h1 class="center">ЁЯУШ рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡ (Full Proposal)</h1>

<!-- ================= LOAD PROJECT ================= -->
<script>
let key = localStorage.getItem("activeProject");
if(!key){alert("Project рднреЗрдЯрд┐рдПрди");}
let p = JSON.parse(localStorage.getItem(key)) || {};
</script>

<!-- ================================================= -->
<h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг (Short Info)</h2>
<table>
<tr><th>рд╡реНрдпрд╡рд╕рд╛рдп рдирд╛рдо</th><td id="si_name"></td></tr>
<tr><th>рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
<tr><th>рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
<tr><th>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
<tr><th>рд╕рдореНрдкрд░реНрдХ</th><td id="si_phone"></td></tr>
<tr><th>рд╡реНрдпрд╡рд╕рд╛рдп рдкреНрд░рдХреГрддрд┐</th><td id="si_products"></td></tr>
</table>

<h3>рд╕рдВрд╕реНрдерд╛рдЧрдд рд╡рд┐рд╡рд░рдг</h3>
<table>
<tr><th>рджрд░реНрддрд╛ рдорд┐рддрд┐</th><td id="reg_date"></td></tr>
<tr><th>рджрд░реНрддрд╛ рдирд┐рдХрд╛рдп</th><td id="reg_authority"></td></tr>
<tr><th>рджрд░реНрддрд╛ рдирдВ</th><td id="reg_no"></td></tr>
<tr><th>PAN рдирдВ</th><td id="pan_no"></td></tr>
</table>

<h3>рд▓рд╛рднрд╛рдиреНрд╡рд┐рдд рд╕рдореВрд╣</h3>
<table>
<tr><th>рд╕рдореВрд╣ рдкреНрд░рдХрд╛рд░</th><td id="bg_type"></td></tr>
<tr><th>рдорд╣рд┐рд▓рд╛</th><td id="bg_female"></td></tr>
<tr><th>рдкреБрд░реБрд╖</th><td id="bg_male"></td></tr>
<tr><th>рдЬрдореНрдорд╛</th><td id="bg_total"></td></tr>
</table>

<hr>

<!-- ================================================= -->
<h2>реи. рд╡реНрдпрд╡рд╕рд╛рдп рд╡рд┐рд╡рд░рдг (By Topic)</h2>
<div id="bizDetail"></div>

<hr>

<!-- ================================================= -->
<h2>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛</h2>
<div id="prodSummary"></div>

<hr>

<!-- ================================================= -->
<h2>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (рд╡рд┐рдзрд╛рдЧрдд)</h2>
<table>
<thead>
<tr><th>рд╡рд┐рдзрд╛</th><th>рд╢реАрд░реНрд╖рдХ</th><th class="right">рд░рдХрдо</th></tr>
</thead>
<tbody id="expBody"></tbody>
<tfoot>
<tr>
<th colspan="2" class="right">рдХреБрд▓ рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</th>
<th class="right" id="cashExp"></th>
</tr>
<tr>
<th colspan="2" class="right">рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (резрел%)</th>
<th class="right" id="depExp"></th>
</tr>
</tfoot>
</table>

<hr>

<!-- ================================================= -->
<h2>рел. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>
<table>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="pl_income"></td></tr>
<tr><th>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</th><td class="right" id="pl_cash"></td></tr>
<tr><th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</th><td class="right" id="pl_dep"></td></tr>
<tr><th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th><td class="right" id="pl_int"></td></tr>
<tr><th>рдХрд░ рдЕрдШрд┐рдХреЛ рдирд╛рдлрд╛ (PBT)</th><td class="right" id="pl_pbt"></td></tr>
<tr><th>рдХрд░ (реирел%)</th><td class="right" id="pl_tax"></td></tr>
<tr><th><b>рдЦреБрдж рдирд╛рдлрд╛ (PAT)</b></th><td class="right" id="pl_pat"></td></tr>
</table>

<hr>

<!-- ================================================= -->
<h2>рем. рел рд╡рд░реНрд╖реЗ ROI рд╕рд╛рд░рд╛рдВрд╢</h2>
<table>
<thead>
<tr>
<th>рд╡рд░реНрд╖</th>
<th>рдЖрдореНрджрд╛рдиреА</th>
<th>рдЦрд░реНрдЪ</th>
<th>рдирд╛рдлрд╛</th>
<th>рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</th>
</tr>
</thead>
<tbody id="roiBody"></tbody>
</table>

<table style="margin-top:15px">
<tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</th><td id="roi_inv"></td></tr>
<tr><th>Payback Period</th><td id="roi_pay"></td></tr>
<tr><th>IRR (рдЕрдиреБрдорд╛рди)</th><td id="roi_irr"></td></tr>
<tr><th>NPV (10%)</th><td id="roi_npv"></td></tr>
</table>

<hr>

<p class="note">
тЬФя╕П рдпреЛ Proposal Short Info, Expense, Income, Profit/Loss рд░ ROI рдмрд╛рдЯ рд╕реНрд╡рддрдГ рддрдпрд╛рд░ рдЧрд░рд┐рдПрдХреЛ рд╣реЛ  
тЬФя╕П QR рд╡рд╛ Print рджреБрдмреИрдХрд╛ рд▓рд╛рдЧрд┐ рдЙрдкрдпреБрдХреНрдд
</p>

</div>

<script>
/* ===== SHORT INFO ===== */
let s=p.shortInfo||{};
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";

reg_date.innerText=s.reg_date||"";
reg_authority.innerText=s.reg_authority||"";
reg_no.innerText=s.reg_no||"";
pan_no.innerText=s.pan_no||"";

bg_type.innerText=s.benef_group_type||"";
bg_female.innerText=s.female_count||"";
bg_male.innerText=s.male_count||"";
bg_total.innerText=s.total_count||"";

/* ===== BUSINESS DETAIL ===== */
let bd=p.businessDetail||[];
bizDetail.innerHTML=bd.length
 ? bd.map((d,i)=>`<h3>${i+1}. ${d.topic}</h3><p>${d.content}</p>`).join("")
 : "<i>рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди</i>";

/* ===== PRODUCTION ===== */
let prod=JSON.parse(localStorage.getItem("productionSalesPlan")||"null");
prodSummary.innerHTML=prod
 ? `рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдмрдпрд╕реНрдХ: ${prod.adult}, рдмреНрдпрд╛рдЙрдиреЗ рджрд░: ${prod.breedRate}%, рдореГрддреНрдпреБрджрд░: ${prod.death}%`
 : "<i>рдЙрддреНрдкрд╛рджрди рдпреЛрдЬрдирд╛ рдЙрдкрд▓рдмреНрдз рдЫреИрди</i>";

/* ===== EXPENSE / PROFIT ===== */
let income=0, cash=0, dep=0, interest=Number(localStorage.getItem("ANNUAL_LOAN_INTEREST")||0);
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));
(p.expenseData||[]).forEach(e=>{
  if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг") dep+=e.amount*0.15;
  else cash+=e.amount;
  expBody.innerHTML+=`<tr><td>${e.category}</td><td>${e.title}</td><td class="right">${e.amount}</td></tr>`;
});
cashExp.innerText=Math.round(cash);
depExp.innerText=Math.round(dep);

let pbt=income-cash-dep-interest;
let tax=pbt>0?pbt*0.25:0;
let pat=pbt-tax;

pl_income.innerText=income;
pl_cash.innerText=cash;
pl_dep.innerText=Math.round(dep);
pl_int.innerText=Math.round(interest);
pl_pbt.innerText=Math.round(pbt);
pl_tax.innerText=Math.round(tax);
pl_pat.innerText=Math.round(pat);

/* ===== ROI ===== */
let inv=Number((s.bp_capital||"").replace(/[^\d]/g,""))||0;
let ocf=pat+dep;
let cum=-inv;

for(let y=1;y<=5;y++){
  cum+=ocf;
  roiBody.innerHTML+=`
  <tr>
    <td>${y}</td>
    <td>${income}</td>
    <td>${cash}</td>
    <td>${pat}</td>
    <td>${Math.round(cum)}</td>
  </tr>`;
}

roi_inv.innerText=inv;
roi_pay.innerText=ocf>0?(inv/ocf).toFixed(2)+" рд╡рд░реНрд╖":"N/A";
roi_irr.innerText=inv>0?((pat/inv)*100).toFixed(1)+" %":"N/A";

let npv=-inv;
for(let y=1;y<=5;y++) npv+=ocf/Math.pow(1.1,y);
roi_npv.innerText=Math.round(npv);
</script>

</body>
</html>
