<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Business Proposal ‚Äì Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h1,h2,h3{color:#2e7d32}
h1{text-align:center;margin-top:0}

.meta{
  text-align:center;
  font-size:13px;
  color:#555;
  margin-bottom:15px;
}

.lang-switch{
  text-align:right;
  margin-bottom:10px;
}
.lang-switch button{
  margin-left:6px;
  padding:4px 10px;
  border:1px solid #2e7d32;
  background:#fff;
  color:#2e7d32;
  border-radius:4px;
  cursor:pointer;
}

.section{margin-top:26px}
.section h2{
  border-bottom:2px solid #e0e0e0;
  padding-bottom:6px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#f0f0f0}
.right{text-align:right}

.note{
  font-size:13px;
  color:#666;
  margin-top:8px;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button.action{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}

/* ===== PRINT FINAL ===== */
@media print{
  .nav,.lang-switch{display:none}
  body{background:#fff}
  a[href]:after{content:""}
}
@page{margin:20mm}
</style>
</head>

<body>

<div class="container">

<div class="lang-switch">
  <button onclick="setLang('ne')">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</button>
  <button onclick="setLang('en')">English</button>
</div>

<h1 id="bpTitle">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ</h1>

<div class="meta">
  <span id="fpStatus"></span> |
  Version <span id="fpVersion"></span><br>
  Created: <span id="fpCreated"></span> |
  Last Updated: <span id="fpEdited"></span>
</div>

<!-- ===== EXECUTIVE SUMMARY ===== -->
<div class="section">
<h2 id="h_exec"></h2>
<table>
<tr><th id="l_exp"></th><td class="right" id="sumExpense"></td></tr>
<tr><th id="l_inc"></th><td class="right" id="sumIncome"></td></tr>
<tr><th id="l_net"></th><td class="right" id="sumNet"></td></tr>
</table>
<p class="note" id="roiNote"></p>
</div>

<!-- ===== BUSINESS DETAIL ===== -->
<div class="section">
<h2 id="h_detail"></h2>
<div id="detailBox"></div>
</div>

<!-- ===== EXPENSE ===== -->
<div class="section">
<h2 id="h_expense"></h2>
<table>
<thead>
<tr>
  <th id="th_cat"></th>
  <th id="th_title"></th>
  <th class="right" id="th_qty"></th>
  <th class="right" id="th_rate"></th>
  <th class="right" id="th_amount"></th>
</tr>
</thead>
<tbody id="expenseBody"></tbody>
<tfoot>
<tr>
  <th colspan="4" class="right" id="th_total_exp"></th>
  <th class="right" id="expenseTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== INCOME ===== -->
<div class="section">
<h2 id="h_income"></h2>
<table>
<thead>
<tr>
  <th id="th_cat2"></th>
  <th id="th_title2"></th>
  <th class="right" id="th_qty2"></th>
  <th class="right" id="th_rate2"></th>
  <th class="right" id="th_amount2"></th>
</tr>
</thead>
<tbody id="incomeBody"></tbody>
<tfoot>
<tr>
  <th colspan="4" class="right" id="th_total_inc"></th>
  <th class="right" id="incomeTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== PROFIT ===== -->
<div class="section">
<h2 id="h_profit"></h2>
<table>
<tr><th id="pl_i_l"></th><td class="right" id="pl_income"></td></tr>
<tr><th id="pl_e_l"></th><td class="right" id="pl_expense"></td></tr>
<tr><th id="pl_n_l"></th><td class="right" id="pl_net"></td></tr>
</table>
</div>

<!-- ===== ROI ===== -->
<div class="section">
<h2 id="h_roi"></h2>
<table>
<tr><th id="roi_i"></th><td class="right" id="roi_inv"></td></tr>
<tr><th id="roi_p"></th><td class="right" id="roi_profit"></td></tr>
<tr><th id="roi_r"></th><td class="right" id="roi_percent"></td></tr>
</table>
</div>

<div class="nav">
  <button class="action" onclick="location.href='index.html'">‚¨Ö Home</button>
  <button class="action" onclick="window.print()">üñ® Print</button>
</div>

</div>

<script>
/* ===== LOAD ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("No active project");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key) || "{}");

/* ===== FINAL FREEZE ===== */
p.status = "final";
p.version = p.version || "1.0";
localStorage.setItem(key, JSON.stringify(p));

/* ===== LANGUAGE ===== */
let LANG = localStorage.getItem("bp_lang") || "ne";
function setLang(l){ LANG=l; localStorage.setItem("bp_lang",l); render(); }
function t(ne,en){ return LANG==="en" ? (en||ne) : ne; }

/* ===== HELPERS ===== */
function money(n){
  return (LANG==="en"?"NPR ":"‡§∞‡•Å. ") + Number(n||0).toLocaleString(LANG==="en"?"en-US":"ne-NP");
}

/* ===== META ===== */
fpStatus.innerText = "Final Proposal";
fpVersion.innerText = p.version;
fpCreated.innerText = p.createdAt || "";
fpEdited.innerText = p.lastEdited || "";

/* ===== RENDER ===== */
function render(){

  h_exec.innerText   = t("‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂","Executive Summary");
  h_detail.innerText = t("‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£","Business Details");
  h_expense.innerText= t("‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)","Annual Expense");
  h_income.innerText = t("‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)","Annual Income");
  h_profit.innerText = t("‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®","Profit / Loss");
  h_roi.innerText    = t("‡•´ ‡§µ‡§∞‡•ç‡§∑‡•á ROI ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂","Five-Year ROI Summary");

  l_exp.innerText = t("‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö","Total Expense");
  l_inc.innerText = t("‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä","Total Income");
  l_net.innerText = t("‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®","Net Result");

  th_cat.innerText = th_cat2.innerText = t("‡§ï‡•ç‡§Ø‡§æ‡§ü‡•á‡§ó‡•ã‡§∞‡•Ä","Category");
  th_title.innerText = th_title2.innerText = t("‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï","Description");
  th_qty.innerText = th_qty2.innerText = t("‡§™‡§∞‡§ø‡§Æ‡§æ‡§£","Qty");
  th_rate.innerText = th_rate2.innerText = t("‡§¶‡§∞","Rate");
  th_amount.innerText = th_amount2.innerText = t("‡§∞‡§ï‡§Æ","Amount");
  th_total_exp.innerText = t("‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö","Total Expense");
  th_total_inc.innerText = t("‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä","Total Income");

  pl_i_l.innerText = t("‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä","Total Income");
  pl_e_l.innerText = t("‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö","Total Expense");
  pl_n_l.innerText = t("‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®","Net Result");

  roi_i.innerText = t("‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä","Initial Investment");
  roi_p.innerText = t("‡§ï‡•Å‡§≤ ‡§®‡§æ‡§´‡§æ (‡•´ ‡§µ‡§∞‡•ç‡§∑)","Total Profit (5 Years)");
  roi_r.innerText = t("ROI (%)","ROI (%)");

  bpTitle.innerText = t(
    p.shortInfo?.bp_name || "‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ",
    p.shortInfo?.bp_name_en || p.shortInfo?.bp_name || "Business Proposal"
  );

  /* ===== BUSINESS DETAIL ===== */
  detailBox.innerHTML="";
  (p.businessDetail||[]).forEach((d,i)=>{
    detailBox.innerHTML+=`
      <h3>${i+1}. ${t(d.topic,d.topic_en)}</h3>
      <p>${(t(d.content,d.content_en)||"").replace(/\n/g,"<br>")}</p>`;
  });
  if(!detailBox.innerHTML)
    detailBox.innerHTML="<i>"+t("‡§∏‡•Ç‡§ö‡§®‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§õ‡•à‡§®","Information not available")+"</i>";

  /* ===== CATEGORY-WISE EXPENSE ===== */
  expenseBody.innerHTML="";
  let eTotal=0, groups={};
  (p.expenseData||[]).forEach(e=>{
    let c=e.category||t("‡§Ö‡§®‡•ç‡§Ø","Others");
    (groups[c]=groups[c]||[]).push(e);
  });
  Object.keys(groups).forEach(c=>{
    expenseBody.innerHTML+=`<tr><th colspan="5" style="background:#eef5ee">${c}</th></tr>`;
    groups[c].forEach(e=>{
      eTotal+=Number(e.amount||0);
      expenseBody.innerHTML+=`
        <tr>
          <td></td>
          <td>${e.title||""}</td>
          <td class="right">${e.qty||""}</td>
          <td class="right">${e.rate||""}</td>
          <td class="right">${money(e.amount)}</td>
        </tr>`;
    });
  });
  expenseTotal.innerText = money(eTotal);

  /* ===== INCOME ===== */
  incomeBody.innerHTML="";
  let iTotal=0;
  (p.incomeData||[]).forEach(i=>{
    iTotal+=Number(i.amount||0);
    incomeBody.innerHTML+=`
      <tr>
        <td>${i.category||""}</td>
        <td>${i.title||""}</td>
        <td class="right">${i.qty||""}</td>
        <td class="right">${i.rate||""}</td>
        <td class="right">${money(i.amount)}</td>
      </tr>`;
  });
  incomeTotal.innerText = money(iTotal);

  /* ===== PROFIT ===== */
  sumExpense.innerText = money(eTotal);
  sumIncome.innerText  = money(iTotal);
  sumNet.innerText     = money(iTotal-eTotal);
  pl_income.innerText  = money(iTotal);
  pl_expense.innerText = money(eTotal);
  pl_net.innerText     = money(iTotal-eTotal);

  /* ===== 5-YEAR ROI (YEAR-WISE %) ===== */
  let incG=[10,12,8,7,5], expG=[5,6,6,5,4];
  let ci=iTotal, ce=eTotal, ti=0, te=0;
  for(let y=0;y<5;y++){
    if(y>0){ ci*=1+incG[y]/100; ce*=1+expG[y]/100; }
    ti+=ci; te+=ce;
  }
  let p5=ti-te;
  roi_inv.innerText    = money(eTotal);
  roi_profit.innerText = money(p5);
  roi_percent.innerText= ((p5/eTotal)*100).toFixed(2)+" %";

  roiNote.innerText = t(
    "‡§™‡§æ‡§Å‡§ö ‡§µ‡§∞‡•ç‡§∑‡•á ‡§µ‡§ø‡§§‡•ç‡§§‡•Ä‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∑‡•á‡§™‡§£ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§∞ ‡§ñ‡§∞‡•ç‡§ö‡§Æ‡§æ ‡§µ‡§∞‡•ç‡§∑‡§ó‡§§ ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø‡§ï‡§æ ‡§Ü‡§ß‡§æ‡§∞‡§Æ‡§æ ‡§§‡§Ø‡§æ‡§∞ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§π‡•ã‡•§",
    "The five-year financial projection is prepared using year-wise growth assumptions for income and expenses."
  );
}

render();
</script>

</body>
</html>

