<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Final Business Proposal | FarmerBase BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#fff;margin:0;line-height:1.6
}
.page{
  max-width:1100px;margin:auto;padding:35px
}
h1,h2,h3,h4{color:#2e7d32;margin-top:30px}
h1{text-align:center;margin-top:0}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #999;padding:6px}
th{background:#eef5ee}
.right{text-align:right}
.center{text-align:center}
.section{margin-top:35px}
.note{font-size:13px;color:#555}
hr{margin:30px 0}
@media print{
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="page">

<h1 id="title">व्यवसायिक प्रस्तावना</h1>

<p class="center note">
Generated by FarmerBase Business Planning System
</p>

<hr>

<!-- ================= SHORT INFO ================= -->
<div class="section">
<h2>१. संक्षिप्त परिचय</h2>
<table>
<tr><th>व्यवसाय नाम</th><td id="si_name"></td></tr>
<tr><th>सञ्चालन स्थान</th><td id="si_location"></td></tr>
<tr><th>संस्था</th><td id="si_org"></td></tr>
<tr><th>प्रोप्राइटर</th><td id="si_owner"></td></tr>
<tr><th>सम्पर्क</th><td id="si_phone"></td></tr>
<tr><th>व्यवसाय प्रकृति</th><td id="si_products"></td></tr>
</table>

<h3>संस्थागत परिचय</h3>
<table>
<tr><th>दर्ता मिति</th><td id="reg_date"></td></tr>
<tr><th>दर्ता निकाय</th><td id="reg_auth"></td></tr>
<tr><th>दर्ता नं</th><td id="reg_no"></td></tr>
<tr><th>PAN नं</th><td id="pan_no"></td></tr>
</table>

<h3>लाभान्वित समूह</h3>
<table>
<tr><th>समूह प्रकार</th><td id="bg_type"></td></tr>
<tr><th>महिला</th><td id="bg_female"></td></tr>
<tr><th>पुरुष</th><td id="bg_male"></td></tr>
<tr><th>जम्मा</th><td id="bg_total"></td></tr>
</table>
</div>

<!-- ================= BUSINESS DETAIL ================= -->
<div class="section">
<h2>२. व्यवसाय विवरण</h2>
<div id="businessDetail"></div>
</div>

<!-- ================= PRODUCTION PLAN ================= -->
<div class="section">
<h2>३. उत्पादन तथा बिक्री योजना</h2>
<table>
<tr><th>प्रारम्भिक बयस्क संख्या</th><td id="pd_adult"></td></tr>
<tr><th>ब्याउने दर (%)</th><td id="pd_breed"></td></tr>
<tr><th>प्रति बयस्क बच्चा</th><td id="pd_kids"></td></tr>
<tr><th>मृत्युदर (%)</th><td id="pd_death"></td></tr>
<tr><th>राखिने पोथी (%)</th><td id="pd_keepf"></td></tr>
<tr><th>प्रतिस्थापन (%)</th><td id="pd_replace"></td></tr>
</table>
</div>

<!-- ================= EXPENSE ================= -->
<div class="section">
<h2>४. खर्च विवरण (विधागत)</h2>
<table id="expenseTable">
<tr><th>विधा</th><th class="right">रकम</th></tr>
</table>
</div>

<!-- ================= INVESTMENT SOURCE ================= -->
<div class="section">
<h2>५. लगानी / खर्चको स्रोत</h2>
<table>
<tr><th>विवरण</th><th class="right">रकम</th></tr>
<tr><td>प्रारम्भिक लगानी</td><td class="right" id="inv_amt"></td></tr>
<tr><td>वार्षिक बैंक ब्याज</td><td class="right" id="bank_int"></td></tr>
</table>
</div>

<!-- ================= PROFIT LOSS ================= -->
<div class="section">
<h2>६. नाफा / नोक्सान (वार्षिक)</h2>
<table>
<tr><th>विवरण</th><th class="right">रकम</th></tr>
<tr><td>कुल आम्दानी</td><td class="right" id="pl_income"></td></tr>
<tr><td>चालु खर्च</td><td class="right" id="pl_operating"></td></tr>
<tr><td>ह्रासकट्टी</td><td class="right" id="pl_depr"></td></tr>
<tr><td>बैंक ब्याज</td><td class="right" id="pl_interest"></td></tr>
<tr><td>कर अघिको नाफा (PBT)</td><td class="right" id="pl_pbt"></td></tr>
<tr><td>कर (२५%)</td><td class="right" id="pl_tax"></td></tr>
<tr><th>खुद नाफा (PAT)</th><th class="right" id="pl_pat"></th></tr>
</table>
</div>

<!-- ================= ROI ================= -->
<div class="section">
<h2>७. ५ वर्षे ROI सारांश</h2>
<table>
<tr><th>सूचक</th><th class="right">परिणाम</th></tr>
<tr><td>प्रारम्भिक लगानी</td><td class="right" id="roi_inv"></td></tr>
<tr><td>वार्षिक नगद प्रवाह</td><td class="right" id="roi_ocf"></td></tr>
<tr><td>Payback Period</td><td class="right" id="roi_payback"></td></tr>
</table>
</div>

<hr>
<p class="center note">
✔ यो प्रस्ताव FarmerBase BPMS द्वारा स्वतः तयार गरिएको हो  
</p>

</div>

<script>
const key=localStorage.getItem("activeProject");
const p=key?JSON.parse(localStorage.getItem(key)):{};
const s=p.shortInfo||{};
const bd=p.businessDetail||[];
const ex=p.expenseData||[];
const inc=p.incomeData||[];
const prod=JSON.parse(localStorage.getItem("productionSalesPlan")||"{}");
const bankInterest=Number(localStorage.getItem("ANNUAL_LOAN_INTEREST")||0);

/* Short Info */
title.innerText=s.bp_name||"व्यवसायिक प्रस्तावना";
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";
reg_date.innerText=s.reg_date||"";
reg_auth.innerText=s.reg_authority||"";
reg_no.innerText=s.reg_no||"";
pan_no.innerText=s.pan_no||"";
bg_type.innerText=s.benef_group_type||"";
bg_female.innerText=s.female_count||0;
bg_male.innerText=s.male_count||0;
bg_total.innerText=s.total_count||0;

/* Business Detail */
businessDetail.innerHTML=bd.map(d=>`
<h4>${d.topic}</h4>
<p>${d.content}</p>
`).join("") || "<i>विवरण उपलब्ध छैन</i>";

/* Production */
pd_adult.innerText=prod.adult||0;
pd_breed.innerText=prod.breedRate||0;
pd_kids.innerText=prod.kids||0;
pd_death.innerText=prod.death||0;
pd_keepf.innerText=prod.keepFemale||0;
pd_replace.innerText=prod.replacement||0;

/* Expense Group */
let eg={},operating=0,depr=0;
ex.forEach(e=>{
  eg[e.category]=(eg[e.category]||0)+Number(e.amount||0);
  if(e.category.includes("मेशीन")||e.category.includes("पूर्वाधार"))
    depr+=e.amount*0.15;
  else operating+=e.amount;
});
Object.keys(eg).forEach(c=>{
  expenseTable.innerHTML+=`<tr><td>${c}</td><td class="right">${Math.round(eg[c])}</td></tr>`;
});

/* Income */
let income=0;
inc.forEach(i=>income+=Number(i.amount||0));

/* Profit */
let pbt=income-operating-depr-bankInterest;
let tax=pbt>0?pbt*0.25:0;
let pat=pbt-tax;

pl_income.innerText=Math.round(income);
pl_operating.innerText=Math.round(operating);
pl_depr.innerText=Math.round(depr);
pl_interest.innerText=Math.round(bankInterest);
pl_pbt.innerText=Math.round(pbt);
pl_tax.innerText=Math.round(tax);
pl_pat.innerText=Math.round(pat);

/* ROI */
let investment=Number((s.bp_capital||"").replace(/[^\d]/g,""))||0;
let ocf=pat+depr;
roi_inv.innerText=investment;
roi_ocf.innerText=Math.round(ocf);
roi_payback.innerText=ocf>0?(investment/ocf).toFixed(2)+" वर्ष":"N/A";
inv_amt.innerText=investment;
bank_int.innerText=Math.round(bankInterest);
</script>

</body>
</html>
