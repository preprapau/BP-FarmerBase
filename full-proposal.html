<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== BASE ===== */
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;margin:0;
}
.page{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:32px;
  border-radius:10px;
  page-break-after:always;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
h2{border-bottom:2px solid #e0e0e0;padding-bottom:6px}
.center{text-align:center}
.right{text-align:right}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border:1px solid #ccc;padding:8px}
th{background:#f1f5f1}

/* ===== KEEP TOGETHER ===== */
.keep-together{page-break-inside:avoid;break-inside:avoid}

/* ===== PRINT FIX ===== */
@media print{
  body{background:#fff}
  a[href]:after{content:""}
  thead{display:table-header-group}
  tfoot{display:table-footer-group}
  tr{page-break-inside:avoid;break-inside:avoid}
}
tfoot th{background:#e8f5e9;font-weight:bold}

/* ===== COVER ===== */
.cover{padding:90px 30px;text-align:center}
.cover h1{font-size:36px}
.tagline{font-size:18px;color:#555;margin:18px 0}
.footer{margin-top:70px;font-size:14px;color:#555}

/* ===== TOC ===== */
.toc li{display:flex;justify-content:space-between;border-bottom:1px dotted #aaa;padding:6px 0}
</style>
</head>

<body>

<!-- ===================== PAGE 1 : COVER ===================== -->
<div class="page cover">
  <h1 id="cv_name">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡</h1>
  <div class="tagline">рд╕рддрдд рдХреГрд╖рд┐ тАв рдЖрддреНрдордирд┐рд░реНрднрд░ рдЖрдореНрджрд╛рдиреА тАв рджреАрд░реНрдШрдХрд╛рд▓реАрди рд╡рд┐рдХрд╛рд╕</div>

  <div id="proposalQR"></div>
  <div style="font-size:13px;color:#555;margin-top:6px">
    ЁЯУ▒ QR Scan рдЧрд░реА Digital Proposal рдкрдвреНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ
  </div>

  <div class="footer">
    <b id="cv_org"></b><br>
    <span id="cv_addr"></span>
  </div>
</div>

<!-- ===================== PAGE 2 : ToC ===================== -->
<div class="page">
  <h2>Table of Contents</h2>
  <ol class="toc">
    <li><span>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</span><span>1</span></li>
    <li><span>реи. рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</span><span>2</span></li>
    <li><span>рей. рд╡реНрдпрд╡рд╕рд╛рдп / рдкрд░рд┐рдпреЛрдЬрдирд╛рдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</span><span>3</span></li>
    <li><span>рек. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</span><span>4</span></li>
    <li><span>рел. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг</span><span>5</span></li>
    <li><span>рем. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</span><span>6</span></li>
    <li><span>рен. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рддрдерд╛ рд▓рд╛рднрд╛рдВрд╢</span><span>7</span></li>
    <li><span>рео. рел рд╡рд░реНрд╖реЗ ROI</span><span>8</span></li>
  </ol>
</div>

<!-- ===================== PAGE 3 : SHORT INFO ===================== -->
<div class="page keep-together">
  <h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</h2>
  <table>
    <tr><th>рд╡реНрдпрд╡рд╕рд╛рдп рдирд╛рдо</th><td id="si_name"></td></tr>
    <tr><th>рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
    <tr><th>рд╕рдЮреНрдЪрд╛рд▓рди рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
    <tr><th>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
    <tr><th>рд╕рдореНрдкрд░реНрдХ рдирдореНрдмрд░</th><td id="si_phone"></td></tr>
    <tr><th>рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐</th><td id="si_products"></td></tr>
    <tr><th>рдореБрдЦреНрдп рдмрдЬрд╛рд░</th><td id="si_market"></td></tr>
    <tr><th>рдХреБрд▓ рдкреВрдБрдЬреА</th><td id="si_capital"></td></tr>
  </table>
</div>

<!-- ===================== PAGE 4 : EXEC SUMMARY ===================== -->
<div class="page keep-together">
  <h2>реи. рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</h2>
  <p id="execSummary"></p>
</div>

<!-- ===================== PAGE 5 : BUSINESS DETAIL ===================== -->
<div class="page">
  <h2>рей. рд╡реНрдпрд╡рд╕рд╛рдп / рдкрд░рд┐рдпреЛрдЬрдирд╛рдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
  <div id="detailBox"></div>
</div>

<!-- ===================== PAGE 6 : PRODUCTION SUMMARY ===================== -->
<div class="page keep-together">
  <h2>рек. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</h2>
  <table>
    <tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд╡рдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td id="ps_adult"></td></tr>
    <tr><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдЙрддреНрдкрд╛рджрди (рдФрд╕рдд)</th><td id="ps_production"></td></tr>
    <tr><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдмрд┐рдХреНрд░реА (рдФрд╕рдд)</th><td id="ps_sell"></td></tr>
    <tr><th>рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди</th><td id="ps_replace"></td></tr>
    <tr><th>рел рд╡рд░реНрд╖рдХреЛ рдХреБрд▓ рдмрд┐рдХреНрд░реА</th><td id="ps_5yr"></td></tr>
  </table>
</div>

<!-- ===================== PAGE 7 : EXPENSE (CATEGORY-WISE) ===================== -->
<div class="page">
  <h2>рел. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг</h2>
  <table class="print-table">
    <thead>
      <tr>
        <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
        <th>рд╢реАрд░реНрд╖рдХ</th>
        <th class="right">рд░рдХрдо</th>
      </tr>
    </thead>
    <tbody id="expBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="2" class="right">рдХреБрд▓ рдЦрд░реНрдЪ</th>
        <th class="right" id="expTotal"></th>
      </tr>
    </tfoot>
  </table>
</div>

<!-- ===================== PAGE 8 : INCOME ===================== -->
<div class="page">
  <h2>рем. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</h2>
  <table class="print-table">
    <thead>
      <tr>
        <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
        <th>рд╢реАрд░реНрд╖рдХ</th>
        <th class="right">рд░рдХрдо</th>
      </tr>
    </thead>
    <tbody id="incBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="2" class="right">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
        <th class="right" id="incTotal"></th>
      </tr>
    </tfoot>
  </table>
</div>

<!-- ===================== PAGE 9 : PROFIT / DIVIDEND ===================== -->
<div class="page">
  <h2>рен. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рддрдерд╛ рд▓рд╛рднрд╛рдВрд╢</h2>
  <table>
    <tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="pl_inc"></td></tr>
    <tr><th>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</th><td class="right" id="pl_cash"></td></tr>
    <tr><th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (15%)</th><td class="right" id="pl_dep"></td></tr>
    <tr><th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th><td class="right" id="pl_int"></td></tr>
    <tr><th>рдХрд░ рдЕрдШрд┐рдХреЛ рдирд╛рдлрд╛ (PBT)</th><td class="right" id="pl_pbt"></td></tr>
    <tr><th>рдХрд░ (25%)</th><td class="right" id="pl_tax"></td></tr>
    <tr><th><b>рдЦреБрдж рдирд╛рдлрд╛ (PAT)</b></th><td class="right" id="pl_pat"></td></tr>
  </table>

  <h3 style="margin-top:18px">рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>
  <table>
    <thead>
      <tr><th>рд╡рд┐рдзрд╛</th><th>%</th><th class="right">рд░рдХрдо</th></tr>
    </thead>
    <tbody id="divBody"></tbody>
  </table>
</div>

<!-- ===================== PAGE 10 : 5-YEAR ROI ===================== -->
<div class="page">
  <h2>рео. рел рд╡рд░реНрд╖реЗ ROI</h2>
  <table class="print-table" id="roiTable">
    <thead>
      <tr>
        <th>рд╡рд░реНрд╖</th>
        <th class="right">рдЖрдореНрджрд╛рдиреА</th>
        <th class="right">рдЦрд░реНрдЪ</th>
        <th class="right">рдирд╛рдлрд╛</th>
        <th class="right">рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
<script>
/* ===================== LOAD ===================== */
let key=localStorage.getItem("activeProject");
let p=JSON.parse(localStorage.getItem(key)||"{}");
let s=p.shortInfo||{};

/* ===================== COVER & QR ===================== */
cv_name.innerText=s.bp_name||"рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡";
cv_org.innerText=s.bp_org||"";
cv_addr.innerText=s.bp_location||"";
new QRious({element:proposalQR,value:location.href,size:160});

/* ===================== SHORT INFO ===================== */
si_name.innerText=s.bp_name||"";
si_org.innerText=s.bp_org||"";
si_location.innerText=s.bp_location||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";
si_market.innerText=s.bp_market||"";
si_capital.innerText=s.bp_capital||"";

/* ===================== EXEC SUMMARY ===================== */
execSummary.innerText=
`рдпрд╕ ${s.bp_products||""} рд╡реНрдпрд╡рд╕рд╛рдпрдорд╛ рдХреБрд▓ рдкреВрдБрдЬреА ${s.bp_capital||""} рд▓рдЧрд╛рдиреА рдкреНрд░рд╕реНрддрд╛рд╡ рдЧрд░рд┐рдПрдХреЛ рдЫред
рд╡рд╛рд░реНрд╖рд┐рдХ рдЖрдореНрджрд╛рдиреА рдХрд░рд┐рдм рд╕реНрд╡рддрдГ рдЧрдгрдирд╛ рднрдИ рджреЗрдЦрд╛рдЗрдПрдХреЛ рдЫ рд░ рел рд╡рд░реНрд╖реЗ рдЕрд╡рдзрд┐рдорд╛ рд▓рдЧрд╛рдиреА рдлрд┐рд░реНрддрд╛ рд╣реБрдиреЗ рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░рд┐рдПрдХреЛ рдЫред`;

/* ===================== BUSINESS DETAIL ===================== */
let db=document.getElementById("detailBox");
if(Array.isArray(p.businessDetail)&&p.businessDetail.length){
  p.businessDetail.forEach((d,i)=>{
    db.innerHTML+=`<h3>${i+1}. ${d.topic}</h3><p>${String(d.content||"").replace(/\n/g,"<br>")}</p>`;
  });
}else db.innerHTML="<i>(рд╡реНрдпрд╡рд╕рд╛рдп рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди)</i>";

/* ===================== PRODUCTION SUMMARY ===================== */
let ps=p.productionPlan||{};
ps_adult.innerText=ps.adult||"тАФ";
ps_production.innerText=ps.annualProduction||"тАФ";
ps_sell.innerText=ps.annualSell||"тАФ";
ps_replace.innerText=ps.replacement||"тАФ";
ps_5yr.innerText=ps.fiveYearSell||"тАФ";

/* ===================== EXPENSE (CATEGORY-WISE) ===================== */
let expMap={}, expTotal=0;
(p.expenseData||[]).forEach(e=>{
  let c=e.category||"рдЕрдиреНрдп";
  expMap[c]=expMap[c]||[];
  expMap[c].push(e);
  expTotal+=Number(e.amount||0);
});
for(let c in expMap){
  let sub=0;
  expBody.innerHTML+=`<tr><th colspan="3">${c}</th></tr>`;
  expMap[c].forEach(e=>{
    sub+=Number(e.amount||0);
    expBody.innerHTML+=`<tr><td></td><td>${e.title}</td><td class="right">${e.amount}</td></tr>`;
  });
  expBody.innerHTML+=`<tr><th colspan="2" class="right">рдЙрдктАУрдХреБрд▓</th><th class="right">${sub}</th></tr>`;
}
expTotal.innerText=expTotal;

/* ===================== INCOME ===================== */
let incT=0;
(p.incomeData||[]).forEach(i=>{
  incT+=Number(i.amount||0);
  incBody.innerHTML+=`<tr><td>${i.category}</td><td>${i.title}</td><td class="right">${i.amount}</td></tr>`;
});
incTotal.innerText=incT;

/* ===================== PROFIT / DIVIDEND ===================== */
let cash=0,dep=0,intt=0;
(p.expenseData||[]).forEach(e=>{
  let a=Number(e.amount||0);
  let k=(e.category+e.title).toLowerCase();
  if(k.includes("interest")||k.includes("рдмреНрдпрд╛рдЬ")) intt+=a;
  else if(k.includes("рдореЗрд╕рд┐рди")||k.includes("рдкреВрд░реНрд╡рд╛рдзрд╛рд░")||k.includes("shed")) dep+=a*0.15;
  else cash+=a;
});
pl_inc.innerText=incT;
pl_cash.innerText=cash;
pl_dep.innerText=Math.round(dep);
pl_int.innerText=intt;
let pbt=incT-cash-dep-intt;
let tax=Math.max(0,Math.round(pbt*0.25));
let pat=pbt-tax;
pl_pbt.innerText=pbt; pl_tax.innerText=tax; pl_pat.innerText=pat;

let divs=p.dividends||[{title:"рд╕реНрд╡рд╛рдореА / рд╕рд╛рдЭреЗрджрд╛рд░",pct:60},{title:"рдкреБрдирдГ рд▓рдЧрд╛рдиреА",pct:40}];
divs.forEach(d=>{
  divBody.innerHTML+=`<tr><td>${d.title}</td><td>${d.pct}%</td><td class="right">${Math.round(pat*d.pct/100)}</td></tr>`;
});

/* ===================== ROI ===================== */
let tb=document.querySelector("#roiTable tbody");
let cum=0, income=incT, expense=cash+dep;
for(let y=1;y<=5;y++){
  let prof=income-expense;
  cum+=prof;
  tb.innerHTML+=`<tr><td>рд╡рд░реНрд╖ ${y}</td><td class="right">${Math.round(income)}</td><td class="right">${Math.round(expense)}</td><td class="right">${Math.round(prof)}</td><td class="right">${Math.round(cum)}</td></tr>`;
  income*=1.1; expense*=1.06;
}
</script>

</body>
</html>
