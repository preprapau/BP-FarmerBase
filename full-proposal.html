<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h1,h2,h3{color:#2e7d32}
h1{text-align:center;margin-top:0}

.meta{
  text-align:center;
  font-size:13px;
  color:#555;
  margin-bottom:20px;
}

.section{margin-top:25px}
.section h2{
  border-bottom:2px solid #e0e0e0;
  padding-bottom:5px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:left;
}
th{background:#f0f0f0}
.right{text-align:right}

.note{font-size:13px;color:#666}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}

/* ===== PRINT FINAL ===== */
@media print{
  body{background:#fff}
  button,.nav{display:none!important}
  a[href]:after{content:""!important}
  @page{size:A4;margin:20mm}
}
</style>
</head>

<body>

<div class="container">

<h1 id="bpTitle">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛</h1>

<div class="meta">
  <span id="fpStatus"></span> |
  Version : v<span id="fpVersion"></span><br>
  Created : <span id="fpCreated"></span> |
  Last Edited : <span id="fpEdited"></span>
</div>

<!-- ===== EXECUTIVE SUMMARY ===== -->
<div class="section">
<h2>рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</h2>

<table>
<tr><th>рдХреБрд▓ рдЦрд░реНрдЪ</th><td class="right" id="sumExpense"></td></tr>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="sumIncome"></td></tr>
<tr><th>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</th><td class="right" id="sumNet"></td></tr>
</table>

<p class="note" id="summaryConclusion"></p>
</div>

<!-- ===== SHORT INFO ===== -->
<div class="section">
<h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</h2>
<table>
<tr><th>рд╡реНрдпрд╡рд╕рд╛рдп/рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛рдХреЛ рдирд╛рдо</th><td id="si_name"></td></tr>
<tr><th>рд╕рдЮреНрдЪрд╛рд▓рди рд╣реБрдиреЗ рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
<tr><th>рд╕рдЮреНрдЪрд╛рд▓рди рдЧрд░реНрдиреЗ рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
<tr><th>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
<tr><th>рд╕рдореНрдкрд░реНрдХ рд╡реНрдпрдХреНрддрд┐</th><td id="si_contact"></td></tr>
<tr><th>рд╕рдореНрдкрд░реНрдХ рдирдореНрдмрд░</th><td id="si_phone"></td></tr>
<tr><th>рдЙрддреНрдкрд╛рджрди/рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐</th><td id="si_products"></td></tr>
<tr><th>рдореБрдЦреНрдп рдмрдЬрд╛рд░</th><td id="si_market"></td></tr>
<tr><th>рдХреБрд▓ рдкреВрдБрдЬреА</th><td id="si_capital"></td></tr>
</table>
</div>

<!-- ===== BUSINESS DETAIL ===== -->
<div class="section">
<h2>реи. рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
<div id="detailBox"></div>
</div>

<!-- ===== EXPENSE ===== -->
<div class="section">
<h2>рей. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>
<table>
<thead>
<tr>
  <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
  <th>рд╢реАрд░реНрд╖рдХ</th>
  <th class="right">рдкрд░рд┐рдорд╛рдг</th>
  <th class="right">рджрд░</th>
  <th class="right">рд░рдХрдо</th>
</tr>
</thead>
<tbody id="expenseBody"></tbody>
<tfoot>
<tr>
  <th colspan="4" class="right">рдХреБрд▓ рдЦрд░реНрдЪ</th>
  <th class="right" id="expenseTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== INCOME ===== -->
<div class="section">
<h2>рек. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>
<table>
<thead>
<tr>
  <th>рдХреНрдпрд╛рдЯреЗрдЧреЛрд░реА</th>
  <th>рд╢реАрд░реНрд╖рдХ</th>
  <th class="right">рдкрд░рд┐рдорд╛рдг</th>
  <th class="right">рджрд░</th>
  <th class="right">рд░рдХрдо</th>
</tr>
</thead>
<tbody id="incomeBody"></tbody>
<tfoot>
<tr>
  <th colspan="4" class="right">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
  <th class="right" id="incomeTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== PROFIT LOSS ===== -->
<div class="section">
<h2>рел. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</h2>
<table>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="pl_income"></td></tr>
<tr><th>рдХреБрд▓ рдЦрд░реНрдЪ</th><td class="right" id="pl_expense"></td></tr>
<tr><th>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</th><td class="right" id="pl_net"></td></tr>
</table>
</div>

<!-- ===== ROI ===== -->
<div class="section">
<h2>рем. рдкрд╛рдБрдЪ рд╡рд░реНрд╖реЗ ROI рд╕рд╛рд░рд╛рдВрд╢</h2>
<table>
<tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</th><td class="right" id="roi_inv"></td></tr>
<tr><th>рдХреБрд▓ рдирд╛рдлрд╛ (рел рд╡рд░реНрд╖)</th><td class="right" id="roi_profit"></td></tr>
<tr><th>ROI (%)</th><td class="right" id="roi_percent"></td></tr>
<tr><th>Payback Period</th><td id="roi_payback"></td></tr>
</table>
</div>

<div class="nav">
  <button onclick="goHome()">тмЕ Home</button>
  <button onclick="window.print()">ЁЯЦи Print</button>
</div>

</div>

<script>
/* ===== SAFETY ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("Project рднреЗрдЯрд┐рдПрди");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key)||"{}");

/* ===== HELPERS ===== */
function safe(v){ return v && v!=="" ? v : "<i>(рд╕реВрдЪрдирд╛ рдЙрдкрд▓рдмреНрдз рдЫреИрди)</i>"; }
function money(n){ return "рд░реБ. " + Number(n||0).toLocaleString("ne-NP"); }

/* ===== FINAL FREEZE MARK ===== */
p.status = "final";
p.version = p.version || "1.0";
localStorage.setItem(key, JSON.stringify(p));

/* ===== META ===== */
fpStatus.innerText = "Final Proposal";
fpVersion.innerText = p.version;
fpCreated.innerText = p.createdAt || "";
fpEdited.innerText = p.lastEdited || "";

/* ===== SHORT INFO ===== */
let s = p.shortInfo || {};
bpTitle.innerText = s.bp_name || "рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛";
si_name.innerHTML = safe(s.bp_name);
si_location.innerHTML = safe(s.bp_location);
si_org.innerHTML = safe(s.bp_org);
si_owner.innerHTML = safe(s.bp_owner);
si_contact.innerHTML = safe(s.bp_contact_person);
si_phone.innerHTML = safe(s.bp_phone);
si_products.innerHTML = safe(s.bp_products);
si_market.innerHTML = safe(s.bp_market);
si_capital.innerHTML = safe(s.bp_capital);

/* ===== BUSINESS DETAIL ===== */
let dbox = document.getElementById("detailBox");
(p.businessDetail||[]).forEach((d,i)=>{
  dbox.innerHTML += `
    <div style="margin-bottom:18px">
      <h3>${i+1}. ${d.topic}</h3>
      <p>${(d.content||"").replace(/\n/g,"<br>")}</p>
    </div>`;
});
if(!dbox.innerHTML) dbox.innerHTML="<i>(рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди)</i>";

/* ===== EXPENSE ===== */
let eTotal=0;
(p.expenseData||[]).forEach(e=>{
  eTotal+=Number(e.amount||0);
  expenseBody.innerHTML+=`
    <tr>
      <td>${e.category}</td>
      <td>${e.title}</td>
      <td class="right">${e.qty}</td>
      <td class="right">${e.rate}</td>
      <td class="right">${money(e.amount)}</td>
    </tr>`;
});
expenseTotal.innerText = money(eTotal);

/* ===== INCOME ===== */
let iTotal=0;
(p.incomeData||[]).forEach(i=>{
  iTotal+=Number(i.amount||0);
  incomeBody.innerHTML+=`
    <tr>
      <td>${i.category}</td>
      <td>${i.title}</td>
      <td class="right">${i.qty}</td>
      <td class="right">${i.rate}</td>
      <td class="right">${money(i.amount)}</td>
    </tr>`;
});
incomeTotal.innerText = money(iTotal);

/* ===== PROFIT LOSS ===== */
pl_income.innerText = money(iTotal);
pl_expense.innerText = money(eTotal);
let net = iTotal - eTotal;
pl_net.innerText = net>=0 ? "рдирд╛рдлрд╛ : "+money(net) : "рдиреЛрдХреНрд╕рд╛рди : "+money(Math.abs(net));

/* ===== EXECUTIVE SUMMARY ===== */
sumExpense.innerText = money(eTotal);
sumIncome.innerText  = money(iTotal);
sumNet.innerText     = net>=0 ? "рдирд╛рдлрд╛ : "+money(net) : "рдиреЛрдХреНрд╕рд╛рди : "+money(Math.abs(net));

summaryConclusion.innerText =
  net>=0
  ? "рдЦрд░реНрдЪ рддрдерд╛ рдЖрдореНрджрд╛рдиреАрдХреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЕрдиреБрд╕рд╛рд░ рдпрд╕ рд╡реНрдпрд╡рд╕рд╛рдпрд▓реЗ рджреАрд░реНрдШрдХрд╛рд▓реАрди рд░реВрдкрдорд╛ рдирд╛рдлрд╛рдореВрд▓рдХ рд╣реБрдиреЗ рд╕реНрдкрд╖реНрдЯ рдЖрдзрд╛рд░ рджреЗрдЦрд╛рдПрдХреЛ рдЫред рддрд╕рд░реНрде, рдпрд╕ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдирдпреЛрдЧреНрдп рд░рд╣реЗрдХреЛ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓рд┐рдПрдХреЛ рдЫред"
  : "рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдЪрд░рдгрдорд╛ рдЦрд░реНрдЪ рдмрдвреА рджреЗрдЦрд┐рдП рдкрдирд┐ рдЙрдЪрд┐рдд рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рддрдерд╛ рдмрдЬрд╛рд░ рд╡рд┐рд╕реНрддрд╛рд░рд╕рдБрдЧреИ рднрд╡рд┐рд╖реНрдпрдорд╛ рдирд╛рдлрд╛рдореВрд▓рдХ рд╣реБрдиреЗ рд╕рдореНрднрд╛рд╡рдирд╛ рджреЗрдЦрд┐рдиреНрдЫред";

/* ===== ROI ===== */
let r = p.fiveYearROI || {};
roi_inv.innerText = money(r.investment);
roi_profit.innerText = money(r.totalProfit);
roi_percent.innerText = r.roi || "";
roi_payback.innerText = r.payback || "";

/* ===== NAV ===== */
function goHome(){location.href="index.html";}
</script>

</body>
</html>
