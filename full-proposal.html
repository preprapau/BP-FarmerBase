<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1000px;margin:25px auto;
  background:#fff;padding:30px;border-radius:12px;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
h1{text-align:center}

.section{margin-top:30px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#eef5ee}
.left{text-align:left}
.right{text-align:right}
.cat{background:#e8f5e9;font-weight:700}
.sum{background:#f1f8f1;font-weight:700}

.note{font-size:13px;color:#555}

@media print{
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="wrap">

<h1 id="title">व्यवसाय प्रस्ताव</h1>

<!-- ================= SHORT INFO ================= -->
<div class="section">
<h2>१. संक्षिप्त परिचय</h2>
<table>
<tr><th class="left">व्यवसायको नाम</th><td id="si_name"></td></tr>
<tr><th class="left">सञ्चालन स्थान</th><td id="si_location"></td></tr>
<tr><th class="left">संस्था</th><td id="si_org"></td></tr>
<tr><th class="left">प्रोप्राइटर</th><td id="si_owner"></td></tr>
<tr><th class="left">सम्पर्क नं</th><td id="si_phone"></td></tr>
<tr><th class="left">उत्पादन / प्रकृति</th><td id="si_products"></td></tr>
</table>
</div>

<!-- ================= BUSINESS DETAIL ================= -->
<div class="section">
<h2>२. व्यवसाय विवरण</h2>
<div id="detailBox"></div>
</div>

<!-- ================= PRODUCTION SALES ================= -->
<div class="section">
<h2>३. उत्पादन तथा बिक्री योजना</h2>

<table>
<thead>
<tr>
  <th>वर्ष</th>
  <th>बयस्क संख्या</th>
  <th>बाँचेक बच्चा</th>
  <th>बच्चा बिक्री</th>
  <th>बयस्क बिक्री<br>(प्रतिस्थापन)</th>
  <th>अर्को वर्षका बयस्क</th>
</tr>
</thead>
<tbody id="prodBody"></tbody>
</table>

<p class="note">
प्रारम्भिक बयस्क, ब्याउने दर, मृत्युदर, राखिने % अनुसार गणना
</p>
</div>

<!-- ================= EXPENSE ================= -->
<div class="section">
<h2>४. खर्च विवरण</h2>

<table>
<thead>
<tr>
  <th class="left">विधा</th>
  <th class="left">शीर्षक</th>
  <th class="right">रकम</th>
</tr>
</thead>
<tbody id="expBody"></tbody>
<tfoot>
<tr class="sum">
  <td colspan="2" class="right">कुल चालु खर्च</td>
  <td class="right" id="cashTotal"></td>
</tr>
<tr class="sum">
  <td colspan="2" class="right">ह्रासकट्टी</td>
  <td class="right" id="deprTotal"></td>
</tr>
</tfoot>
</table>
</div>

</div>

<script>
let key=localStorage.getItem("activeProject");
let p=key?JSON.parse(localStorage.getItem(key)):{};

/* ---------- SHORT INFO ---------- */
let s=p.shortInfo||{};
title.innerText=s.bp_name||"व्यवसाय प्रस्ताव";
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";
si_products.innerText=s.bp_products||"";

/* ---------- BUSINESS DETAIL ---------- */
let box=document.getElementById("detailBox");
(p.businessDetail||[]).forEach(d=>{
  box.innerHTML+=`<h3>${d.topic}</h3><p>${d.content}</p>`;
});
if(!box.innerHTML) box.innerHTML="<i>व्यवसाय विवरण उपलब्ध छैन</i>";

/* ---------- PRODUCTION TABLE ---------- */
let ps=localStorage.getItem("productionSalesPlan");
if(ps){
  let d=JSON.parse(ps);
  let adult=d.adult;
  for(let y=1;y<=5;y++){
    let breeding=adult*d.breedRate/100;
    let born=breeding*d.kids;
    let alive=born*(100-d.death)/100;
    let male=alive*d.maleRate/100;
    let female=alive-male;
    let keepF=female*d.keepFemale/100;
    let sellKids=alive-(male*d.keepMale/100+keepF);
    let replace=adult*d.replacement/100;

    prodBody.innerHTML+=`
    <tr>
      <td>वर्ष ${y}</td>
      <td>${Math.round(adult)}</td>
      <td>${Math.round(alive)}</td>
      <td>${Math.round(sellKids)}</td>
      <td>${Math.round(replace)}</td>
      <td>${Math.round(adult+keepF)}</td>
    </tr>`;
    adult=adult+keepF;
  }
}else{
  prodBody.innerHTML="<tr><td colspan='6'>उत्पादन योजना उपलब्ध छैन</td></tr>";
}

/* ---------- EXPENSE CATEGORY-WISE ---------- */
let groups={},cash=0,depr=0;
(p.expenseData||[]).forEach(e=>{
  if(!groups[e.category]) groups[e.category]=[];
  groups[e.category].push(e);
});

for(let c in groups){
  expBody.innerHTML+=`<tr class="cat"><td colspan="3">${c}</td></tr>`;
  groups[c].forEach(e=>{
    expBody.innerHTML+=`
    <tr>
      <td></td>
      <td class="left">${e.title}</td>
      <td class="right">${e.amount}</td>
    </tr>`;
    if(c==="मेशीन औजार / प्रविधि"||c==="पूर्वाधार निर्माण")
      depr+=e.amount*0.15;
    else
      cash+=e.amount;
  });
}
cashTotal.innerText=Math.round(cash);
deprTotal.innerText=Math.round(depr);
</script>

</body>
</html>
