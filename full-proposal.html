<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Final Business Proposal | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;margin:0;
}
.container{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
h1{text-align:center}
.meta{text-align:center;font-size:13px;color:#555;margin-bottom:15px}

.section{margin-top:28px}
.section h2{border-bottom:2px solid #e0e0e0;padding-bottom:6px}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px}
th{background:#f1f5f1}
.right{text-align:right}

.note{font-size:13px;color:#555;margin-top:8px}

.qrbox{text-align:center;margin:20px 0}
footer{
  margin-top:40px;
  text-align:center;
  font-size:13px;
  color:#555;
}

.green{color:#2e7d32;font-weight:bold}
.red{color:#c62828;font-weight:bold}

@media print{
  body{background:#fff}
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="container">

<!-- ================= TITLE ================= -->
<h1 id="bpTitle">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛</h1>
<div class="meta">
  Status : <span id="fpStatus"></span> |
  Version : v<span id="fpVersion"></span><br>
  Created : <span id="fpCreated"></span> |
  Last Edited : <span id="fpEdited"></span>
</div>

<!-- ================= QR ================= -->
<div class="qrbox">
  <div id="proposalQR"></div>
  <div class="note">ЁЯУ▒ QR Scan рдЧрд░реА Digital Proposal рдкрдвреНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ</div>
</div>

<!-- ================= EXECUTIVE SUMMARY ================= -->
<div class="section">
<h2>рдХрд╛рд░реНрдпрдХрд╛рд░реА рд╕рд╛рд░рд╛рдВрд╢</h2>
<p id="execSummary">
рдпрд╕ рдкреНрд░рд╕реНрддрд╛рд╡рдорд╛ рдкреНрд░рд╕реНрддреБрдд рд╡реНрдпрд╡рд╕рд╛рдп рдЖрд░реНрдерд┐рдХ рд░реВрдкрдорд╛ рд╕рдореНрднрд╛рд╡реНрдп, рджрд┐рдЧреЛ рд░ рджреАрд░реНрдШрдХрд╛рд▓реАрди рд▓рд╛рднрджрд╛рдпрдХ рджреЗрдЦрд┐рдиреНрдЫред
рдЖрдореНрджрд╛рдиреА, рдЦрд░реНрдЪ, рдХрд░ рддрдерд╛ рдирд╛рдлрд╛рдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдгрдХрд╛ рдЖрдзрд╛рд░рдорд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕рдлрд▓ рд╣реБрдиреЗ рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░рд┐рдПрдХреЛ рдЫред
</p>
</div>

<!-- ================= BUSINESS DETAIL ================= -->
<div class="section">
<h2>рд╡реНрдпрд╡рд╕рд╛рдп / рдкрд░рд┐рдпреЛрдЬрдирд╛рдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
<div id="detailBox"></div>
</div>

<!-- ================= ROI SUMMARY ================= -->
<div class="section">
<h2>рел рд╡рд░реНрд╖реЗ ROI рд╕рд╛рд░рд╛рдВрд╢</h2>
<table>
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th class="right">рд░рдХрдо (рд░реБ.)</th>
</tr>
<tr>
  <td>рдкрд╣рд┐рд▓реЛ рд╡рд░реНрд╖рдХреЛ рдЖрдореНрджрд╛рдиреА</td>
  <td class="right" id="roi_inc1">0</td>
</tr>
<tr>
  <td>рел рд╡рд░реНрд╖рдкрдЫрд┐ рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</td>
  <td class="right" id="roi_cum5">0</td>
</tr>
</table>

<p class="note">
тЬФя╕П рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА резрел% рд░ рдХрд░ реирел% рдХреЛ рдЖрдзрд╛рд░рдорд╛ рдЧрдгрдирд╛ рдЧрд░рд┐рдПрдХреЛ рдЫред
</p>
</div>

<!-- ================= DIVIDEND ================= -->
<div class="section">
<h2>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг (релрдФрдБ рд╡рд░реНрд╖рдХреЛ рдХрд░ рдкрдЫрд┐рдХреЛ рдирд╛рдлрд╛ рдЖрдзрд╛рд░рдорд╛)</h2>

<table>
<tr>
  <th>рд╡рд┐рдзрд╛</th>
  <th class="right">%</th>
  <th class="right">рд░рдХрдо (рд░реБ.)</th>
</tr>
<tbody id="dividendBody"></tbody>
<tfoot>
<tr>
  <th>рдХреБрд▓</th>
  <th class="right" id="divPct">0%</th>
  <th></th>
</tr>
</tfoot>
</table>
</div>

<footer>
┬й Business Proposal тАУ BPMS<br>
Digital & Print Ready
</footer>

</div>

<!-- ================= QR LIB ================= -->
<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

<script>
/* ================= LOAD PROJECT ================= */
let key = localStorage.getItem("activeProject");
let p = JSON.parse(localStorage.getItem(key) || "{}");

/* ================= META ================= */
fpStatus.innerText  = p.status || "Draft";
fpVersion.innerText = p.version || "1.0";
fpCreated.innerText = p.createdAt || "";
fpEdited.innerText  = p.lastEdited || "";

/* ================= TITLE ================= */
bpTitle.innerText = p.shortInfo?.bp_name || "рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛";

/* ================= BUSINESS DETAIL ================= */
let dbox = document.getElementById("detailBox");
(p.businessDetail||[]).forEach(d=>{
  dbox.innerHTML += `<h3>${d.topic}</h3><p>${d.content}</p>`;
});
if(!dbox.innerHTML) dbox.innerHTML="<i>(рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди)</i>";

/* ================= ROI SUMMARY (FROM ROI PAGE DATA) ================= */
let roi = p.roiSummary || {};
roi_inc1.innerText = roi.year1Income || "тАФ";
roi_cum5.innerText = roi.cumulative5 || "тАФ";

/* ================= DIVIDEND ================= */
let dividends = [
  {title:"рд╕реНрд╡рд╛рдореА / рд╕рд╛рдЭреЗрджрд╛рд░", pct:60},
  {title:"рдкреБрдирдГ рд▓рдЧрд╛рдиреА", pct:40}
];

let finalNet = Number(roi.finalNetProfit || 0);
let totalPct = 0;
dividendBody.innerHTML="";

dividends.forEach(d=>{
  totalPct += d.pct;
  let amt = finalNet>0 ? Math.round(finalNet*d.pct/100) : 0;
  dividendBody.innerHTML += `
    <tr>
      <td>${d.title}</td>
      <td class="right">${d.pct}%</td>
      <td class="right">${amt}</td>
    </tr>`;
});
divPct.innerText = totalPct+"%";
divPct.style.color = totalPct===100 ? "#2e7d32" : "#c62828";

/* ================= QR ================= */
new QRious({
  element: document.getElementById("proposalQR"),
  value: window.location.href,
  size: 140,
  level: "H"
});
</script>

</body>
</html>
