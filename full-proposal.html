<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>व्यवसाय प्रस्ताव</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  font-family:"Noto Sans Devanagari",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.page{
  max-width:900px;
  margin:0 auto;
  background:#fff;
  padding:32px;
  page-break-after:always;
}
h1,h2,h3{margin-top:0;color:#2e7d32}
p,li{line-height:1.9}

/* ToC */
#toc ol{padding-left:20px}

/* Summary box */
.summary{
  border:2px solid #e0e0e0;
  background:#fafafa;
  padding:15px;
  margin:15px 0;
}
.summary div{
  display:flex;
  justify-content:space-between;
  padding:4px 0;
}

/* ===== PRINT FINAL ===== */
@media print{
  body{background:#fff}
  .no-print,button,input,select,textarea{display:none!important}
  a[href]:after{content:""!important}
  @page{size:A4;margin:20mm}
}
</style>
</head>

<body>

<!-- ================= EXECUTIVE SUMMARY ================= -->
<div class="page">
<h2>कार्यकारी सारांश</h2>

<div class="summary">
  <div><span>कुल खर्च</span><strong id="sumExpense"></strong></div>
  <div><span>कुल आम्दानी</span><strong id="sumIncome"></strong></div>
  <div><span>नाफा / नोक्सान</span><strong id="sumProfit"></strong></div>
</div>

<p id="summaryConclusion"></p>
</div>

<!-- ================= TABLE OF CONTENTS ================= -->
<div class="page" id="toc">
<h2>विषयसूची</h2>
<ol id="tocList"></ol>
</div>

<!-- ================= BUSINESS DETAIL BY TOPIC ================= -->
<div class="page">
<h2>व्यवसाय / परियोजना विवरण</h2>
<div id="businessTopics"></div>
</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let project = key ? JSON.parse(localStorage.getItem(key)) : {};

/* ===== FINANCIAL TOTALS ===== */
let totalExpense = 0, totalIncome = 0;
(project.expenseData||[]).forEach(e=>totalExpense+=Number(e.amount||0));
(project.incomeData||[]).forEach(i=>totalIncome+=Number(i.amount||0));
let profit = totalIncome - totalExpense;

function fmt(n){ return "रु. " + Number(n).toLocaleString("ne-NP"); }

sumExpense.innerText = fmt(totalExpense);
sumIncome.innerText  = fmt(totalIncome);
sumProfit.innerText  = profit>=0 ? "नाफा : "+fmt(profit) : "नोक्सान : "+fmt(Math.abs(profit));

summaryConclusion.innerText =
  profit>=0
  ? "खर्च र आम्दानीको विश्लेषण अनुसार यस व्यवसायले दीर्घकालीन रूपमा नाफामूलक हुने स्पष्ट आधार देखाएको छ। तसर्थ, यस प्रस्ताव कार्यान्वयनयोग्य रहेको निष्कर्ष निकालिएको छ।"
  : "प्रारम्भिक चरणमा खर्च बढी देखिए पनि उचित व्यवस्थापन र बजार विस्तारसँगै भविष्यमा नाफामूलक हुने सम्भावना देखिन्छ।";

/* ===== BUSINESS BY TOPIC ===== */
const box = document.getElementById("businessTopics");
if(project.businessDetail && project.businessDetail.length){
  project.businessDetail.forEach((t,i)=>{
    box.innerHTML += `
      <section style="margin-bottom:20px">
        <h3>${i+1}. ${t.topic}</h3>
        <p>${(t.content||"").replace(/\\n/g,"<br>")}</p>
      </section>`;
  });
}

/* ===== TOC WITH PAGE NO (PRINT-BASED) ===== */
document.querySelectorAll("h2").forEach((h,i)=>{
  const li = document.createElement("li");
  li.innerText = h.innerText + " ........ " + (i+1);
  tocList.appendChild(li);
});
</script>

</body>
</html>
