<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Final Business Proposal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:30px;
}
h1,h2,h3{color:#2e7d32;margin-top:0}
h1{text-align:center}

/* ===== Sections ===== */
.section{margin-top:30px}
.section h2{
  border-bottom:2px solid #e0e0e0;
  padding-bottom:6px;
}

/* ===== Tables ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
}
th{background:#f0f0f0}
.right{text-align:right}

/* ===== Notes ===== */
.note{
  font-size:13px;
  color:#555;
  margin-top:8px;
}

/* ===== ToC ===== */
.toc ul{
  list-style:none;
  padding:0;
}
.toc li{
  display:flex;
  justify-content:space-between;
  border-bottom:1px dotted #ccc;
  padding:6px 0;
}

/* ===== Print ===== */
@media print{
  a[href]:after{content:""}
  body{background:#fff}
  .page{page-break-after:always}
  footer{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    text-align:center;
    font-size:12px;
    color:#555;
  }
  footer:after{
    counter-increment:page;
    content:"рдкреГрд╖реНрда " counter(page);
  }
}
</style>
</head>

<body>
<div class="container">

<h1 id="bpTitle">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛</h1>

<!-- ===== ToC ===== -->
<div class="section page toc">
<h2>рд╡рд┐рд╖рдпрд╕реВрдЪреА</h2>
<ul>
  <li><span>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</span><span>рез</span></li>
  <li><span>реи. рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</span><span>реи</span></li>
  <li><span>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</span><span>рей</span></li>
  <li><span>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг</span><span>рек</span></li>
  <li><span>рел. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг</span><span>рел</span></li>
  <li><span>рем. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</span><span>рем</span></li>
</ul>
</div>

<!-- ===== SHORT INFO ===== -->
<div class="section page">
<h2>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп</h2>
<table>
<tr><th>рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо</th><td id="si_name"></td></tr>
<tr><th>рд╕реНрдерд╛рди</th><td id="si_location"></td></tr>
<tr><th>рд╕рдВрд╕реНрдерд╛</th><td id="si_org"></td></tr>
<tr><th>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</th><td id="si_owner"></td></tr>
<tr><th>рд╕рдореНрдкрд░реНрдХ рдирдореНрдмрд░</th><td id="si_phone"></td></tr>
</table>
</div>

<!-- ===== BUSINESS DETAIL ===== -->
<div class="section page">
<h2>реи. рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
<div id="detailBox"></div>
</div>

<!-- ===== PRODUCTION SALES SUMMARY ===== -->
<div class="section page">
<h2>рей. рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (рд╕рд╛рд░рд╛рдВрд╢)</h2>
<table>
<tr><th>рел рдФрдВ рд╡рд░реНрд╖рдХреЛ рдмрдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td class="right" id="ps_adult"></td></tr>
<tr><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдмрдЪреНрдЪрд╛ рдмрд┐рдХреНрд░реА</th><td class="right" id="ps_kids"></td></tr>
<tr><th>рдмрдпрд╕реНрдХ рдмрд┐рдХреНрд░реА (рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди)</th><td class="right" id="ps_replace"></td></tr>
<tr><th>рдХреБрд▓ рд╡рд╛рд░реНрд╖рд┐рдХ рдмрд┐рдХреНрд░реА</th><td class="right" id="ps_total"></td></tr>
</table>
<p class="note">ЁЯУМ рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдЧрдгрдирд╛рдорд╛ рдЖрдзрд╛рд░рд┐рдд рдЫред</p>
</div>

<!-- ===== EXPENSE ===== -->
<div class="section page">
<h2>рек. рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>
<table>
<thead>
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th class="right">рд░рдХрдо</th>
</tr>
</thead>
<tbody id="expenseBody"></tbody>
<tfoot>
<tr>
  <th colspan="3" class="right">рдХреБрд▓ рдЦрд░реНрдЪ</th>
  <th class="right" id="expenseTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== INCOME ===== -->
<div class="section page">
<h2>рел. рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>
<table>
<thead>
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th class="right">рд░рдХрдо</th>
</tr>
</thead>
<tbody id="incomeBody"></tbody>
<tfoot>
<tr>
  <th colspan="3" class="right">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
  <th class="right" id="incomeTotal"></th>
</tr>
</tfoot>
</table>
</div>

<!-- ===== PROFIT ===== -->
<div class="section page">
<h2>рем. рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</h2>
<table>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="pl_income"></td></tr>
<tr><th>рдХреБрд▓ рдЦрд░реНрдЪ</th><td class="right" id="pl_expense"></td></tr>
<tr><th>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</th><td class="right" id="pl_net"></td></tr>
</table>
</div>

</div>

<footer></footer>

<script>
let key=localStorage.getItem("activeProject");
let p=JSON.parse(localStorage.getItem(key)||"{}");

/* Short Info */
let s=p.shortInfo||{};
bpTitle.innerText=s.bp_name||"рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛";
si_name.innerText=s.bp_name||"";
si_location.innerText=s.bp_location||"";
si_org.innerText=s.bp_org||"";
si_owner.innerText=s.bp_owner||"";
si_phone.innerText=s.bp_phone||"";

/* Business Detail */
let box=document.getElementById("detailBox");
(p.businessDetail||[]).forEach(d=>{
  box.innerHTML+=`<h3>${d.topic}</h3><p>${d.content}</p>`;
});
if(!box.innerHTML) box.innerHTML="<i>рд╡рд┐рд╡рд░рдг рдЙрдкрд▓рдмреНрдз рдЫреИрди</i>";

/* Production Sales Summary */
(function(){
  let raw=localStorage.getItem("productionSalesPlan");
  if(!raw) return;
  let d=JSON.parse(raw),adult=d.adult;
  let kids=0,rep=0,last=0;
  for(let y=1;y<=5;y++){
    let alive=(adult*d.breedRate/100*d.kids)*(100-d.death)/100;
    let female=alive*(100-d.maleRate)/100;
    let keepF=female*d.keepFemale/100;
    let replace=adult*d.replacement/100;
    if(y===5){last=adult;kids=alive-keepF;rep=replace;}
    adult+=keepF;
  }
  ps_adult.innerText=Math.round(last);
  ps_kids.innerText=Math.round(kids);
  ps_replace.innerText=Math.round(rep);
  ps_total.innerText=Math.round(kids+rep);
})();

/* Expense Category-wise */
let eTotal=0,emap={};
(p.expenseData||[]).forEach(e=>{
  if(!emap[e.category]) emap[e.category]={t:0,i:[]};
  emap[e.category].t+=e.amount;
  emap[e.category].i.push(e);
  eTotal+=e.amount;
});
Object.keys(emap).forEach(c=>{
  expenseBody.innerHTML+=`<tr style="font-weight:bold;background:#f9f9f9"><td colspan="4">${c}</td></tr>`;
  emap[c].i.forEach(e=>{
    expenseBody.innerHTML+=`
    <tr>
      <td>${e.title}</td>
      <td>${e.qty}</td>
      <td>${e.rate}</td>
      <td class="right">${e.amount}</td>
    </tr>`;
  });
  expenseBody.innerHTML+=`
  <tr style="font-weight:bold">
    <td colspan="3" class="right">рдЙрдктАУрдХреБрд▓</td>
    <td class="right">${emap[c].t}</td>
  </tr>`;
});
expenseTotal.innerText=eTotal;

/* Income */
let iT=0;
(p.incomeData||[]).forEach(i=>{
  iT+=i.amount;
  incomeBody.innerHTML+=`
  <tr>
    <td>${i.title}</td>
    <td>${i.qty}</td>
    <td>${i.rate}</td>
    <td class="right">${i.amount}</td>
  </tr>`;
});
incomeTotal.innerText=iT;

/* Profit */
pl_income.innerText=iT;
pl_expense.innerText=eTotal;
pl_net.innerText=(iT-eTotal)>=0?"рдирд╛рдлрд╛ : "+(iT-eTotal):"рдиреЛрдХреНрд╕рд╛рди : "+Math.abs(iT-eTotal);
</script>

</body>
</html>
