<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>ROI | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
header a,footer a{
  text-decoration:none;
  font-weight:700;
  color:#2e7d32
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px
}
h2,h3{color:#2e7d32;margin:8px 0}
.small{font-size:13px;color:#555}

.section{
  background:#fff;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px
}

table{
  width:100%;
  border-collapse:collapse
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px
}
th{background:#eef5ee}
.right{text-align:right}

.highlight{
  background:#e8f5e9;
  font-weight:700
}

.roiBox{
  text-align:center;
  padding:18px;
  border-radius:14px;
  margin-top:14px;
  font-size:20px;
  font-weight:700
}

.roiPositive{
  background:#e8f5e9;
  color:#2e7d32
}
.roiWarn{
  background:#fff8e1;
  color:#f57f17
}
.roiNegative{
  background:#fdecea;
  color:#c62828
}

.badge{
  display:inline-block;
  padding:4px 12px;
  border-radius:20px;
  font-size:13px;
  margin-left:6px
}
.badge-good{background:#2e7d32;color:#fff}
.badge-warn{background:#f9a825;color:#000}
.badge-bad{background:#c62828;color:#fff}

.breakEven{
  margin-top:10px;
  font-size:15px;
  font-weight:700
}

.footerNav{
  display:flex;
  justify-content:space-between;
  width:100%
}

@media print{
  header, footer, .badge, button{display:none}
  body{background:#fff}
}
</style>
</head>

<body>

<!-- TOP NAV -->
<header>
  <a href="income-allocation.html">‚¨ÖÔ∏è Income Allocation</a>
  <strong>üìê ROI Analysis</strong>
  <a href="full-proposal-print.html">‚û°Ô∏è Full Proposal</a>
</header>

<div class="container">

<h2>‡§≤‡§ó‡§æ‡§®‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§´‡§≤ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (ROI)</h2>
<p class="small">
‚ÑπÔ∏è ‡§Ø‡•ã ROI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ Income ‡§∞ Expense ‡§°‡§æ‡§ü‡§æ‡§ï‡•ã ‡§Ü‡§ß‡§æ‡§∞‡§Æ‡§æ
‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™‡§Æ‡§æ ‡§ó‡§£‡§®‡§æ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§π‡•ã‡•§
</p>

<!-- ROI TABLE -->
<div class="section">
<table>
<tr>
  <th>‡§∏‡•Ç‡§ö‡§ï</th>
  <th class="right">‡§Æ‡§æ‡§®</th>
</tr>
<tr class="highlight">
  <th>‡§ï‡•Å‡§≤ ‡§≤‡§ó‡§æ‡§®‡•Ä (‡§ñ‡§∞‡•ç‡§ö)</th>
  <th class="right" id="totalInvestment">0</th>
</tr>
<tr class="highlight">
  <th>‡§∂‡•Å‡§¶‡•ç‡§ß ‡§®‡§æ‡§´‡§æ</th>
  <th class="right" id="netProfit">0</th>
</tr>
<tr class="highlight">
  <th>ROI (%)</th>
  <th class="right" id="roiPercent">0</th>
</tr>
</table>

<div id="roiBox" class="roiBox"></div>
</div>

</div>

<!-- FOOTER -->
<footer>
  <div class="footerNav">
    <a href="income-allocation.html">‚¨ÖÔ∏è Income Allocation</a>
    <span class="small">FarmerBase BP Engine ‚Äì ROI Module</span>
    <a href="full-proposal-print.html">‚û°Ô∏è Full Proposal</a>
  </div>
</footer>

<script>
/* ===============================
   ROI ‚Äì FINAL
   =============================== */

const key = localStorage.getItem("activeProject");
if(!key){ alert("Active ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§≠‡•á‡§ü‡§ø‡§è‡§®"); }

const project = JSON.parse(localStorage.getItem(key)) || {};

/* --- totals --- */
const expenses = project.expenses || [];
const incomes = project.income || [];

let investment = 0;
expenses.forEach(e=>{
  investment += e.amount || 0;
});

let incomeTotal = 0;
incomes.forEach(i=>{
  incomeTotal += (i.sellingRate||0) * (i.qty||0);
});

const netProfit = incomeTotal - investment;
const roi = investment > 0 ? (netProfit / investment) * 100 : 0;

/* --- display numbers --- */
totalInvestment.innerText = investment.toLocaleString();
netProfit.innerText = netProfit.toLocaleString();
roiPercent.innerText = roi.toFixed(2);

/* --- ROI interpretation --- */
const box = document.getElementById("roiBox");

if(roi >= 30){
  box.className = "roiBox roiPositive";
  box.innerHTML = `
    üü¢ ROI : ${roi.toFixed(2)} %
    <span class="badge badge-good">‡§â‡§§‡•ç‡§§‡§Æ</span>
    <div class="breakEven">‚úîÔ∏è ‡§≤‡§ó‡§æ‡§®‡•Ä ‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§≠‡§á‡§∏‡§ï‡•á‡§ï‡•ã ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ</div>
  `;
}
else if(roi >= 10){
  box.className = "roiBox roiWarn";
  box.innerHTML = `
    üü° ROI : ${roi.toFixed(2)} %
    <span class="badge badge-warn">‡§∏‡§®‡•ç‡§§‡•ã‡§∑‡§ú‡§®‡§ï</span>
    <div class="breakEven">‚è≥ Break-even ‡§®‡§ú‡§ø‡§ï</div>
  `;
}
else{
  box.className = "roiBox roiNegative";
  box.innerHTML = `
    üî¥ ROI : ${roi.toFixed(2)} %
    <span class="badge badge-bad">‡§ú‡•ã‡§ñ‡§ø‡§Æ‡§™‡•Ç‡§∞‡•ç‡§£</span>
    <div class="breakEven">‚ùó Break-even ‡§®‡§™‡•Å‡§ó‡•á‡§ï‡•ã</div>
  `;
}
</script>

</body>
</html>
