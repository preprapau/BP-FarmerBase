<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Production Plan | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
header a,footer a{
  text-decoration:none;
  font-weight:700;
  color:#2e7d32
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px
}
h2,h3{color:#2e7d32;margin-bottom:6px}
.small{font-size:13px;color:#555}

.section{
  background:#fff;
  padding:14px;
  border-radius:10px;
  margin-bottom:14px
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:8px
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px
}
th{background:#eef5ee}
input,select,textarea{
  width:100%;
  padding:6px;
  box-sizing:border-box
}
textarea{resize:vertical}

.btn{
  padding:8px 14px;
  background:#2e7d32;
  color:#fff;
  border:none;
  cursor:pointer;
  margin-top:6px
}
.del{color:#c62828;font-weight:700;cursor:pointer}

.totalBox{
  font-size:16px;
  font-weight:700;
  color:#2e7d32;
  margin-top:10px
}

.reportBar{
  margin-top:16px;
  display:flex;
  gap:10px;
  flex-wrap:wrap
}
.reportBar a{
  background:#fff;
  border:2px solid #2e7d32;
  padding:8px 12px;
  font-weight:700;
  color:#2e7d32;
  text-decoration:none
}
</style>
</head>

<body>

<header>
  <a href="index.html">ЁЯПа Home</a>
  <strong>ЁЯУж Production Plan</strong>
  <a href="expense-demo.html">тЮбя╕П Expense</a>
</header>

<div class="container">

<h2>рдЙрддреНрдкрд╛рджрди рдпреЛрдЬрдирд╛ (Production Plan)</h2>
<p class="small">
рдпрд╣рд╛рдБ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдЙрддреНрдкрд╛рджрди рд╡рд┐рд╡рд░рдг Expense, Income, ROI рддрдерд╛ Proposal рдХреЛ рдЖрдзрд╛рд░ рд╣реЛред
</p>

<!-- CATEGORY MANAGER -->
<div class="section">
<h3>ЁЯУВ рдЙрддреНрдкрд╛рджрдирдХрд╛ рдкреНрд░рдХрд╛рд░</h3>
<div id="typeBox"></div>
<input id="newType" placeholder="рдирдпрд╛рдБ рдкреНрд░рдХрд╛рд░ (рдЬрд╕реНрддреИ: рдлрд▓рдлреВрд▓)">
<button class="btn" onclick="addType()">тЮХ рдкреНрд░рдХрд╛рд░ рдердкреНрдиреБрд╣реЛрд╕реН</button>
</div>

<!-- TABLE NARRATION -->
<div class="section">
<h3>ЁЯУЭ рд╕рдордЧреНрд░ рдЙрддреНрдкрд╛рджрди Narration</h3>
<textarea rows="3" id="tableNarration"
 placeholder="рд╕рдордЧреНрд░ рдЙрддреНрдкрд╛рджрди рдпреЛрдЬрдирд╛рдХреЛ рд╡рд┐рд╡рд░рдг рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН..."></textarea>
</div>

<!-- GROUPED TABLES -->
<div id="tables"></div>

<button class="btn" onclick="addRow()">тЮХ рдирдпрд╛рдБ рдЙрддреНрдкрд╛рджрди рдердкреНрдиреБрд╣реЛрд╕реН</button>

<div class="totalBox">
  рдХреБрд▓ рдЙрддреНрдкрд╛рджрди рдореВрд▓реНрдп: рд░реБ <span id="grandTotal">0</span>
</div>

<!-- REPORT LINKS -->
<div class="reportBar">
  <a href="production-report.html" target="_blank">ЁЯУК Production Report</a>
  <a href="production-chart.html" target="_blank">ЁЯУИ Production Chart</a>
  <a href="production-income-link.html" target="_blank">ЁЯФЧ Prod тЖТ Income</a>
  <a href="production-narrative.html" target="_blank">ЁЯУЭ Production Narrative</a>
</div>

</div>

<footer>
  <span class="small">FarmerBase BP Engine тАУ Production Core</span>
</footer>

<script>
/* =====================================
   PRODUCTION PLAN тАУ PROJECT BASED
   ===================================== */

const key = localStorage.getItem("activeProject");
if(!key){
  alert("Active рдпреЛрдЬрдирд╛ рднреЗрдЯрд┐рдПрди ред index рдмрд╛рдЯ рдпреЛрдЬрдирд╛ рд╕реБрд░реБ рдЧрд░реНрдиреБрд╣реЛрд╕реНред");
}

let project = JSON.parse(localStorage.getItem(key)) || {};

project.production = project.production || {
  types:["рдкрд╢реБ","рддрд░рдХрд╛рд░реА","рджреБрдЧреНрдз","рдЕрдиреНрдп"],
  items:[],
  narration:""
};

const TYPES = project.production.types;
const ITEMS = project.production.items;

tableNarration.value = project.production.narration || "";
tableNarration.oninput = ()=>{
  project.production.narration = tableNarration.value;
  save();
};

function save(){
  localStorage.setItem(key,JSON.stringify(project));
  render();
}

/* ---------- TYPE MANAGER ---------- */
function renderTypes(){
  typeBox.innerHTML="";
  TYPES.forEach((t,i)=>{
    typeBox.innerHTML+=`
      <div>
        <input value="${t}" oninput="editType(${i},this.value)">
        <span class="del" onclick="delType(${i})">тЬЦ</span>
      </div>`;
  });
}
function addType(){
  if(!newType.value) return;
  TYPES.push(newType.value);
  newType.value="";
  save();
}
function editType(i,v){
  TYPES[i]=v;
  save();
}
function delType(i){
  if(!confirm("рдпреЛ рдкреНрд░рдХрд╛рд░ рд╣рдЯрд╛рдЙрдиреЗ ?")) return;
  const t=TYPES[i];
  TYPES.splice(i,1);
  project.production.items =
    project.production.items.filter(p=>p.type!==t);
  save();
}

/* ---------- TABLES ---------- */
function render(){
  renderTypes();
  tables.innerHTML="";
  let grand=0;

  TYPES.forEach(type=>{
    const rows = ITEMS.filter(p=>p.type===type);
    if(rows.length===0) return;

    let subtotal=0;
    let html=`<div class="section">
      <h3>${type}</h3>
      <table>
      <tr>
        <th>рдЙрддреНрдкрд╛рджрди</th>
        <th>рдЗрдХрд╛рдИ</th>
        <th>рджрд░</th>
        <th>рдкрд░рд┐рдорд╛рдг</th>
        <th>рд░рдХрдо</th>
        <th>рдХреИрдлрд┐рдпрдд</th>
        <th></th>
      </tr>`;

    rows.forEach(p=>{
      p.amount=(Number(p.rate)||0)*(Number(p.qty)||0);
      subtotal+=p.amount;
      grand+=p.amount;

      html+=`
      <tr>
        <td><input value="${p.name}" oninput="edit('${p.id}','name',this.value)"></td>
        <td><input value="${p.unit}" oninput="edit('${p.id}','unit',this.value)"></td>
        <td><input type="number" value="${p.rate}" oninput="edit('${p.id}','rate',this.value)"></td>
        <td><input type="number" value="${p.qty}" oninput="edit('${p.id}','qty',this.value)"></td>
        <td>рд░реБ ${p.amount.toLocaleString()}</td>
        <td><input value="${p.note||""}" oninput="edit('${p.id}','note',this.value)"></td>
        <td class="del" onclick="remove('${p.id}')">тЬЦ</td>
      </tr>`;
    });

    html+=`
      <tr>
        <th colspan="4">рдЙрдктАУрдЬрдореНрдорд╛</th>
        <th colspan="3">рд░реБ ${subtotal.toLocaleString()}</th>
      </tr>
      </table></div>`;

    tables.innerHTML+=html;
  });

  grandTotal.innerText = grand.toLocaleString();
}

/* ---------- CRUD ---------- */
function addRow(){
  ITEMS.push({
    id:Date.now(),
    name:"",
    type:TYPES[0],
    unit:"",
    rate:0,
    qty:0,
    note:""
  });
  save();
}
function edit(id,f,v){
  let p=ITEMS.find(x=>x.id==id);
  if(!p) return;
  p[f]=(f==="rate"||f==="qty")?Number(v)||0:v;
  save();
}
function remove(id){
  if(!confirm("рдпреЛ рдЙрддреНрдкрд╛рджрди рд╣рдЯрд╛рдЙрдиреЗ ?")) return;
  project.production.items =
    project.production.items.filter(x=>x.id!=id);
  save();
}

render();
</script>

</body>
</html>
