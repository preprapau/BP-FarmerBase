<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>‡§ñ‡§∞‡•ç‡§ö ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#fff;
  margin:20px;
}
h2{
  color:#2e7d32;
  margin-bottom:6px;
}
.small{
  font-size:13px;
  color:#555;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th, td{
  border:1px solid #000;
  padding:6px;
  font-size:13px;
}
th{
  background:#f0f0f0;
  text-align:left;
}
.total{
  font-weight:700;
  background:#fafafa;
}
@media print{
  button{ display:none }
}
</style>
</head>

<body>

<button onclick="window.print()">üñ®Ô∏è Print</button>

<h2>üí∞ ‡§ñ‡§∞‡•ç‡§ö ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h2>
<div class="small">
  ‡§Ø‡•ã‡§ú‡§®‡§æ: <span id="planName"></span><br>
  ‡§Æ‡§ø‡§§‡§ø: <span id="today"></span>
</div>

<table id="summaryTable">
<thead>
<tr>
  <th>‡§ñ‡§∞‡•ç‡§ö ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th>
  <th>‡§¨‡§∞‡•ç‡§ó</th>
  <th style="text-align:right">‡§∞‡§ï‡§Æ (‡§∞‡•Å)</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
/* ===== Load Active Project ===== */
const key = localStorage.getItem("activeProject");
if(!key){
  alert("Active plan ‡§≠‡•á‡§ü‡§ø‡§è‡§®");
}
const project = JSON.parse(localStorage.getItem(key)) || {};
const expenses = project.expenses || [];

/* Meta */
planName.innerText = project.name || "";
today.innerText = new Date().toLocaleDateString();

/* ===== Render ===== */
let grandTotal = 0;
const tbody = document.querySelector("#summaryTable tbody");

expenses.forEach(e=>{
  const amt = Number(e.amount) || 0;
  grandTotal += amt;

  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td>${e.title || ""}</td>
    <td>${e.category || ""}</td>
    <td style="text-align:right">${amt.toFixed(2)}</td>
  `;

  /* üîë Hidden budget code for future */
  tr.dataset.budgetCode = e.budgetCode || "";

  tbody.appendChild(tr);
});

/* Total Row */
const trTotal = document.createElement("tr");
trTotal.className = "total";
trTotal.innerHTML = `
  <td colspan="2">‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</td>
  <td style="text-align:right">${grandTotal.toFixed(2)}</td>
`;
tbody.appendChild(trTotal);
</script>

</body>
</html>
