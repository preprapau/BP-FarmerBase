<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit / Loss | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== TOP MENU ===== */
.top-menu{
  background:#2e7d32;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
}
.top-menu a{
  color:#fff;
  text-decoration:none;
  font-weight:bold;
}

/* ===== CONTENT ===== */
.wrap{
  max-width:950px;
  margin:20px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}

h2{color:#2e7d32;margin-top:0}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#f0f0f0;text-align:left}
.right{text-align:right}
.big{font-size:18px;font-weight:700}
.green{background:#e8f5e9}
.blue{background:#e3f2fd}
input{padding:6px;width:90px}

/* ===== BOTTOM MENU ===== */
.bottom-menu{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#2e7d32;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
}
.bottom-menu a{
  background:#fff;
  color:#2e7d32;
  padding:8px 16px;
  border-radius:6px;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- ===== TOP MENU (VISIBLE ALWAYS) ===== -->
<div class="top-menu">
  <a href="income-demo.html">тмЕ Income</a>
  <a href="five-year-roi.html">ROI тЮб</a>
</div>

<div class="wrap">
<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг</h2>

<table>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="income">0</td></tr>
<tr><th>рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</th><td class="right" id="cash">0</td></tr>
<tr><th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</th><td class="right" id="depr">0</td></tr>
<tr>
  <th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th>
  <td class="right"><input id="interest" value="0"></td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкреВрд░реНрд╡ рдирд╛рдлрд╛</th>
  <td class="right" id="pbt">0</td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ (%)</th>
  <td class="right"><input id="taxRate" value="0"></td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ рд░рдХрдо</th>
  <td class="right" id="taxAmt">0</td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкрд╢реНрдЪрд╛рдд рдирд╛рдлрд╛</th>
  <td class="right" id="netProfit">0</td>
</tr>
</table>

<h3 style="margin-top:25px;color:#2e7d32">ЁЯТ░ рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>

<table class="blue">
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th class="right">%</th>
  <th class="right">рд░рдХрдо</th>
</tr>
<tr>
  <td>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</td>
  <td class="right"><input id="divRate" value="0"></td>
  <td class="right" id="divAmt">0</td>
</tr>
<tr class="big">
  <td>рд╡реНрдпрд╡рд╕рд╛рдпрдорд╛ рдкреБрдирдГ рд▓рдЧрд╛рдиреА</td>
  <td></td>
  <td class="right" id="retained">0</td>
</tr>
</table>
</div>

<!-- ===== BOTTOM MENU (FIXED) ===== -->
<div class="bottom-menu">
  <a href="income-demo.html">тмЕ Income</a>
  <a href="five-year-roi.html">ROI тЮб</a>
</div>

<script>
/* SAFE DATA LOAD (NO CRASH) */
let income=0, cash=0, depr=0;
try{
  let key=localStorage.getItem("activeProject");
  if(key){
    let p=JSON.parse(localStorage.getItem(key));
    (p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));
    (p.expenseData||[]).forEach(e=>{
      if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")
        depr+=e.amount*0.15;
      else cash+=e.amount;
    });
  }
}catch(e){}

function calc(){
  let interest=Number(document.getElementById("interest").value||0);
  let taxRate=Number(document.getElementById("taxRate").value||0);
  let divRate=Number(document.getElementById("divRate").value||0);

  let pbt=income-cash-depr-interest;
  let tax=pbt>0?pbt*(taxRate/100):0;
  let net=pbt-tax;
  let div=net>0?net*(divRate/100):0;

  incomeEl.innerText=income;
  cashEl.innerText=cash;
  deprEl.innerText=Math.round(depr);
  pbtEl.innerText=Math.round(pbt);
  taxAmtEl.innerText=Math.round(tax);
  netProfitEl.innerText=Math.round(net);
  divAmtEl.innerText=Math.round(div);
  retainedEl.innerText=Math.round(net-div);
}

const incomeEl=document.getElementById("income");
const cashEl=document.getElementById("cash");
const deprEl=document.getElementById("depr");
const pbtEl=document.getElementById("pbt");
const taxAmtEl=document.getElementById("taxAmt");
const netProfitEl=document.getElementById("netProfit");
const divAmtEl=document.getElementById("divAmt");
const retainedEl=document.getElementById("retained");

["interest","taxRate","divRate"].forEach(id=>{
  document.getElementById(id).addEventListener("input",calc);
});
calc();
</script>

</body>
</html>
