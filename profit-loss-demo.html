<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit / Loss | FarmerBase BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{margin-top:0;color:#2e7d32}

.progress{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.bar{height:8px;background:#2e7d32;width:71%;border-radius:6px;margin-top:8px}

.box{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-bottom:15px;
}
.green{background:#e8f5e9}
.blue{background:#e3f2fd}
.gray{background:#fafafa}
.big{font-size:22px;font-weight:700}
.right{text-align:right}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px}
th{background:#f0f0f0}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}

@media print{
  button,.progress{display:none}
}
</style>
</head>

<body>

<div class="container">

<div class="progress">
  <b>рдЪрд░рдг рел / рен (ренрез%)</b><br>
  Short Info тЖТ Detail тЖТ Expense тЖТ Income тЖТ <b>Profit/Loss</b> тЖТ ROI тЖТ Proposal
  <div class="bar"></div>
</div>

<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╢реНрд▓реЗрд╖рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<!-- SUMMARY -->
<div class="box gray">
<table>
<tr>
  <th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
  <td class="right" id="totalIncome">0</td>
</tr>
<tr>
  <th>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</th>
  <td class="right" id="cashExpense">0</td>
</tr>
<tr>
  <th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (Depreciation)</th>
  <td class="right" id="depreciation">0</td>
</tr>
<tr>
  <th>рдХреБрд▓ рдЦрд░реНрдЪ</th>
  <td class="right" id="totalExpense">0</td>
</tr>
</table>
</div>

<!-- FINAL PROFIT -->
<div id="profitBox" class="box green">
  <div>тЬФ рдирд╛рдлрд╛ (Final)</div>
  <div class="big" id="netProfit">0</div>
</div>

<!-- DIVIDEND SECTION -->
<div class="box blue">
  <b>ЁЯФ╣ рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг (Profit Utilization)</b>
  <table style="margin-top:10px">
    <tr>
      <th>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг %</th>
      <td class="right" id="divPercent">0%</td>
    </tr>
    <tr>
      <th>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг рд░рдХрдо</th>
      <td class="right" id="divAmount">0</td>
    </tr>
    <tr>
      <th>рдмрдЪрдд / рд╕рдЮреНрдЪрд┐рдд рдирд╛рдлрд╛</th>
      <td class="right" id="retainedProfit">0</td>
    </tr>
  </table>
</div>

<div class="box">
  <b>рдиреЛрдЯ:</b>
  <ul>
    <li>рдирд╛рдлрд╛ = рдЖрдореНрджрд╛рдиреА тИТ (рдЪрд╛рд▓реБ рдЦрд░реНрдЪ + рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА)</li>
    <li>рд▓рд╛рднрд╛рдВрд╢ рдирд╛рдлрд╛рдмрд╛рдЯ рд╡рд┐рддрд░рдг рдЧрд░рд┐рдПрдХреЛ рд░рдХрдо рд╣реЛ</li>
    <li>рдпрд╕ рдкреЗрдЬрдорд╛ рдХреБрдиреИ рдкрдирд┐ edit рдЧрд░реНрди рдорд┐рд▓реНрджреИрди</li>
  </ul>
</div>

<div class="nav">
  <button onclick="location.href='income-demo.html'">тмЕ Previous</button>
  <button onclick="location.href='five-year-roi.html'">Next тЮб</button>
</div>

</div>

<script>
let key = localStorage.getItem("activeProject");
if(!key){
  alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key));

/* INCOME */
let income = 0;
(p.incomeData||[]).forEach(i=> income += Number(i.amount||0));

/* EXPENSE */
let cash = 0;
let depr = 0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА"){
    depr += Number(e.amount||0) * 0.10;
  }else{
    cash += Number(e.amount||0);
  }
});

/* PROFIT */
let profit = income - (cash + depr);

/* DIVIDEND */
let percent = Number(p.dividendPercent||0);
let divAmt = profit>0 ? profit*(percent/100) : 0;
let retained = profit - divAmt;

/* DISPLAY */
totalIncome.innerText = income;
cashExpense.innerText = cash;
depreciation.innerText = Math.round(depr);
totalExpense.innerText = Math.round(cash + depr);
netProfit.innerText = profit>=0 ? "рд░реБ. "+Math.round(profit) : "рдиреЛрдХреНрд╕рд╛рди : рд░реБ. "+Math.abs(Math.round(profit));

divPercent.innerText = percent+"%";
divAmount.innerText = Math.round(divAmt);
retainedProfit.innerText = Math.round(retained);

/* SAVE SNAPSHOT */
p.profitLoss = {
  income, cash, depreciation:Math.round(depr),
  profit:Math.round(profit),
  dividend:Math.round(divAmt),
  retained:Math.round(retained)
};
localStorage.setItem(key, JSON.stringify(p));
</script>

</body>
</html>
