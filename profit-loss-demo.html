<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit / Loss | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{margin-top:0;color:#2e7d32}

/* ===== PROGRESS ===== */
.progress-wrap{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.progress-title{font-weight:700;margin-bottom:6px}
.steps{font-size:13px}
.steps span{padding:3px 6px;border-radius:10px;background:#eee}
.steps .active{background:#2e7d32;color:#fff}
.steps .done{background:#a5d6a7}
.bar-wrap{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:8px}
.bar{height:100%;background:#2e7d32;width:71%}

/* ===== BOX ===== */
.box{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-bottom:15px;
}
.box.green{background:#e8f5e9}
.box.red{background:#ffebee}
.big{font-size:20px;font-weight:700}
.right{text-align:right}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px}
th{background:#f0f0f0}

/* ===== NAV ===== */
.nav{display:flex;justify-content:space-between;margin-top:30px}
button{
  padding:8px 16px;border:none;border-radius:6px;
  cursor:pointer;background:#2e7d32;color:#fff
}

@media print{
  button,.progress-wrap{display:none}
}
</style>
</head>

<body>

<div class="container">

<!-- ===== PROGRESS ===== -->
<div class="progress-wrap">
  <div class="progress-title">‡§ö‡§∞‡§£ ‡•´ / ‡•≠ (‡•≠‡•ß%)</div>
  <div class="steps">
    <span class="done">Short Info</span> ‚Üí
    <span class="done">Detail</span> ‚Üí
    <span class="done">Expense</span> ‚Üí
    <span class="done">Income</span> ‚Üí
    <span class="active">Profit/Loss</span> ‚Üí
    <span>ROI</span> ‚Üí
    <span>Proposal</span>
  </div>
  <div class="bar-wrap"><div class="bar"></div></div>
</div>

<h2>üìä ‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</h2>

<!-- ===== SUMMARY ===== -->
<div class="box">
<table>
<tr>
  <th>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</th>
  <td class="right" id="totalIncome">0</td>
</tr>
<tr>
  <th>‡§ö‡§æ‡§≤‡•Å ‡§ñ‡§∞‡•ç‡§ö (Cash Expense)</th>
  <td class="right" id="cashExpense">0</td>
</tr>
<tr>
  <th>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä (Depreciation)</th>
  <td class="right" id="deprExpense">0</td>
</tr>
<tr>
  <th>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</th>
  <td class="right" id="totalExpense">0</td>
</tr>
<tr>
  <th>‡§≤‡§æ‡§≠‡§æ‡§Ç‡§∂ ‡§µ‡§ø‡§§‡§∞‡§£</th>
  <td class="right" id="dividendAmt">0</td>
</tr>
</table>
</div>

<!-- ===== RESULT ===== -->
<div id="resultBox" class="box green">
  <div>‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</div>
  <div class="big" id="profitText">0</div>
</div>

<!-- ===== NOTE ===== -->
<div class="box">
  <b>‡§®‡•ã‡§ü:</b>
  <ul>
    <li>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä Expense ‡§™‡•á‡§ú‡§¨‡§æ‡§ü ‡§∏‡•ç‡§µ‡§§‡§É ‡§Ü‡§è‡§ï‡•ã ‡§π‡•ã‡•§</li>
    <li>‡§≤‡§æ‡§≠‡§æ‡§Ç‡§∂ ‡§µ‡§ø‡§§‡§∞‡§£ % Income ‡§™‡•á‡§ú‡§¨‡§æ‡§ü ‡§Ü‡§è‡§ï‡•ã ‡§π‡•ã‡•§</li>
    <li>‡§Ø‡§∏ ‡§™‡•á‡§ú‡§Æ‡§æ edit ‡§ó‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•ç‡§¶‡•à‡§®‡•§</li>
  </ul>
</div>

<div class="nav">
  <button onclick="goPrev()">‚¨Ö Previous</button>
  <button onclick="goNext()">Next ‚û°</button>
</div>

</div>

<script>
/* ===== SAFETY ===== */
let activeKey = localStorage.getItem("activeProject");
if(!activeKey){
  alert("‡§™‡§π‡§ø‡§≤‡•á Home ‡§¨‡§æ‡§ü Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(activeKey));

/* ===== INCOME ===== */
let totalIncome = 0;
(project.incomeData||[]).forEach(i=>{
  totalIncome += Number(i.amount||0);
});

/* ===== EXPENSE ===== */
let cashExpense = 0;
let depreciation = 0;

(project.expenseData||[]).forEach(e=>{
  if(e.category==="‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä"){
    depreciation += Number(e.amount||0) * 0.10;   // 10% depreciation
  }else{
    cashExpense += Number(e.amount||0);
  }
});

/* ===== DIVIDEND ===== */
let divPercent = Number(project.dividendPercent||0);
let profitBeforeDiv = totalIncome - (cashExpense + depreciation);
let dividendAmount = profitBeforeDiv > 0 ? profitBeforeDiv * (divPercent/100) : 0;

/* ===== NET ===== */
let netProfit = profitBeforeDiv - dividendAmount;

/* ===== DISPLAY ===== */
totalIncome.innerText = totalIncome;
cashExpense.innerText = cashExpense;
deprExpense.innerText = Math.round(depreciation);
totalExpense.innerText = Math.round(cashExpense + depreciation);
dividendAmt.innerText = Math.round(dividendAmount);

let box = document.getElementById("resultBox");
let txt = document.getElementById("profitText");

if(netProfit >= 0){
  box.className = "box green";
  txt.innerText = "‡§®‡§æ‡§´‡§æ : ‡§∞‡•Å. " + Math.round(netProfit);
}else{
  box.className = "box red";
  txt.innerText = "‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® : ‡§∞‡•Å. " + Math.abs(Math.round(netProfit));
}

/* ===== SAVE SNAPSHOT ===== */
project.profitLoss = {
  income: totalIncome,
  cashExpense: cashExpense,
  depreciation: Math.round(depreciation),
  dividend: Math.round(dividendAmount),
  net: Math.round(netProfit)
};
project.lastEdited = new Date().toLocaleString("ne-NP");
localStorage.setItem(activeKey, JSON.stringify(project));

/* ===== NAV ===== */
function goPrev(){location.href="income-demo.html";}
function goNext(){location.href="five-year-roi.html";}
</script>

</body>
</html>
