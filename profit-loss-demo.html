<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:950px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{
  color:#2e7d32;
  margin-top:0;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{
  background:#f0f0f0;
  text-align:left;
}
.right{text-align:right}
.big{font-size:18px;font-weight:700}
.green{background:#e8f5e9}
.blue{background:#e3f2fd}
input{
  padding:6px;
  width:90px;
}
.note{
  font-size:13px;
  color:#555;
  margin-top:8px;
}
.nav{
  max-width:950px;
  margin:0 auto 30px auto;
  display:flex;
  justify-content:space-between;
}
button{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}
button:hover{opacity:.9}
</style>
</head>

<body>

<div class="wrap">

<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг (Profit & Loss Statement)</h2>

<!-- ================= PROFIT & LOSS ================= -->
<table>
<tr>
  <th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th>
  <td class="right" id="income">0</td>
</tr>
<tr>
  <th>рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</th>
  <td class="right" id="cash">0</td>
</tr>
<tr>
  <th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</th>
  <td class="right" id="depr">0</td>
</tr>
<tr>
  <th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th>
  <td class="right">
    <input id="interest" value="0">
  </td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкреВрд░реНрд╡ рдирд╛рдлрд╛ (Profit Before Tax)</th>
  <td class="right" id="pbt">0</td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ (%)</th>
  <td class="right">
    <input id="taxRate" value="0">
  </td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ рд░рдХрдо</th>
  <td class="right" id="taxAmt">0</td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкрд╢реНрдЪрд╛рдд рдирд╛рдлрд╛ (Net Profit)</th>
  <td class="right" id="netProfit">0</td>
</tr>
</table>

<!-- ================= DIVIDEND ================= -->
<h3 style="margin-top:25px;color:#2e7d32">ЁЯТ░ рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>

<table class="blue">
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th class="right">%</th>
  <th class="right">рд░рдХрдо</th>
</tr>
<tr>
  <td>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</td>
  <td class="right">
    <input id="divRate" value="0">
  </td>
  <td class="right" id="divAmt">0</td>
</tr>
<tr class="big">
  <td>рд╡реНрдпрд╡рд╕рд╛рдпрдорд╛ рдкреБрдирдГ рд▓рдЧрд╛рдиреА (Retained Profit)</td>
  <td></td>
  <td class="right" id="retained">0</td>
</tr>
</table>

<div class="note">
тЬФя╕П рд▓рд╛рднрд╛рдВрд╢ рдирд╛рдлрд╛ рдирд┐рд╕реНрдХрд┐рдПрдкрдЫрд┐ рдорд╛рддреНрд░ рдЧрдгрдирд╛ рд╣реБрдиреНрдЫ<br>
тЬФя╕П % рдкрд░рд┐рд╡рд░реНрддрди рдЧрд░реНрджрд╛ рд░рдХрдо рд╕реНрд╡рддрдГ рдЕрдкрдбреЗрдЯ рд╣реБрдиреНрдЫ
</div>

</div> <!-- wrap end -->

<!-- ================= NAVIGATION MENU ================= -->
<div class="nav">
  <button onclick="location.href='income-demo.html'">тмЕ Previous</button>
  <button onclick="location.href='five-year-roi.html'">Next тЮб</button>
</div>

<script>
/* ================= LOAD PROJECT ================= */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key));

/* ================= INCOME ================= */
let income = 0;
(p.incomeData || []).forEach(i=>{
  income += Number(i.amount || 0);
});

/* ================= EXPENSE ================= */
let cash = 0, depr = 0;
(p.expenseData || []).forEach(e=>{
  if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐" || e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг"){
    depr += e.amount * 0.15;   // depreciation
  }else{
    cash += e.amount;         // cash expense
  }
});

/* ================= CALCULATION ================= */
const incomeEl = document.getElementById("income");
const cashEl = document.getElementById("cash");
const deprEl = document.getElementById("depr");
const pbtEl = document.getElementById("pbt");
const taxAmtEl = document.getElementById("taxAmt");
const netProfitEl = document.getElementById("netProfit");
const divAmtEl = document.getElementById("divAmt");
const retainedEl = document.getElementById("retained");

const interestEl = document.getElementById("interest");
const taxRateEl = document.getElementById("taxRate");
const divRateEl = document.getElementById("divRate");

function calculate(){
  const interest = Number(interestEl.value || 0);
  const taxRate = Number(taxRateEl.value || 0);
  const divRate = Number(divRateEl.value || 0);

  const pbt = income - cash - depr - interest;
  const tax = pbt > 0 ? pbt * (taxRate/100) : 0;
  const net = pbt - tax;
  const dividend = net > 0 ? net * (divRate/100) : 0;
  const retained = net - dividend;

  incomeEl.textContent = income.toLocaleString();
  cashEl.textContent = cash.toLocaleString();
  deprEl.textContent = Math.round(depr).toLocaleString();
  pbtEl.textContent = Math.round(pbt).toLocaleString();
  taxAmtEl.textContent = Math.round(tax).toLocaleString();
  netProfitEl.textContent = Math.round(net).toLocaleString();
  divAmtEl.textContent = Math.round(dividend).toLocaleString();
  retainedEl.textContent = Math.round(retained).toLocaleString();
}

/* ================= BIND ================= */
[interestEl, taxRateEl, divRateEl].forEach(el=>{
  el.addEventListener("input", calculate);
});

/* INIT */
calculate();
</script>

</body>
</html>
