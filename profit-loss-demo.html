<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
}
h2{color:#2e7d32;margin-top:0}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border-bottom:1px solid #ddd;
  padding:10px;
}
th{text-align:left;background:#f1f5f1}
.right{text-align:right}

.green{color:#2e7d32;font-weight:bold}
.red{color:#c62828;font-weight:bold}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}
button{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}

@media print{
  button,.nav{display:none}
  a[href]:after{content:""}
}
</style>
</head>

<body>

<div class="wrap">

<h2>üìä ‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</h2>

<table>
<tr><th>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th><th class="right">‡§∞‡§ï‡§Æ (‡§∞‡•Å.)</th></tr>

<tr><td>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</td><td class="right" id="inc">0</td></tr>
<tr><td>‡§ö‡§æ‡§≤‡•Å ‡§ñ‡§∞‡•ç‡§ö</td><td class="right" id="cash">0</td></tr>
<tr><td>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä (‡•ß‡•´%)</td><td class="right" id="depr">0</td></tr>
<tr><td>‡§¨‡•à‡§Ç‡§ï ‡§¨‡•ç‡§Ø‡§æ‡§ú</td><td class="right" id="int">0</td></tr>

<tr><th>‡§ï‡§∞ ‡§Ö‡§ò‡§ø‡§ï‡•ã ‡§®‡§æ‡§´‡§æ (PBT)</th><th class="right" id="pbt">0</th></tr>
<tr><td>‡§ï‡§∞ (‡•®‡•´%)</td><td class="right" id="taxEl">0</td></tr>
<tr>
  <th>‡§ñ‡•Å‡§¶ ‡§®‡§æ‡§´‡§æ (PAT)</th>
  <th class="right green" id="profit">0</th>
</tr>
</table>

<div class="nav">
  <button onclick="location.href='income-demo.html'">‚¨Ö Income</button>
  <button onclick="location.href='five-year-roi.html'">Next ‚û° ROI</button>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("Project ‡§≠‡•á‡§ü‡§ø‡§è‡§®");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key)) || {};

/* ===== TOTAL INCOME ===== */
let totalIncome = 0;
(p.incomeData || []).forEach(i=>{
  totalIncome += Number(i.amount || 0);
});

/* ===== EXPENSE BREAKDOWN ===== */
let operatingExpense = 0;
let depreciation = 0;
let interest = 0;

(p.expenseData || []).forEach(e=>{
  let amt = Number(e.amount || 0);
  let cat = (e.category || "").toLowerCase();
  let title = (e.title || "").toLowerCase();

  /* üî¥ BANK INTEREST */
  if(title.includes("‡§¨‡•ç‡§Ø‡§æ‡§ú") || cat.includes("‡§¨‡•ç‡§Ø‡§æ‡§ú")){
    interest += amt;
    return;
  }

  /* üîµ DEPRECIATION ITEMS */
  if(
    cat.includes("‡§Æ‡•á‡§∂‡§ø‡§®") ||
    cat.includes("‡§î‡§ú‡§æ‡§∞") ||
    cat.includes("‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞") ||
    cat.includes("‡§≠‡§µ‡§®")
  ){
    depreciation += amt * 0.15;
    return;
  }

  /* üü¢ OPERATING EXPENSE */
  operatingExpense += amt;
});

/* ===== PROFIT CALC ===== */
let PBT = totalIncome - operatingExpense - depreciation - interest;
let taxRate = Number(p.taxRate || 25);
let tax = PBT > 0 ? (PBT * taxRate / 100) : 0;
let PAT = PBT - tax;

/* ===== RENDER ===== */
inc.innerText   = Math.round(totalIncome);
cash.innerText  = Math.round(operatingExpense);
depr.innerText  = Math.round(depreciation);
int.innerText   = Math.round(interest);
pbt.innerText   = Math.round(PBT);
taxEl.innerText = Math.round(tax);
profit.innerText= Math.round(PAT);
</script>

</body>
</html>
