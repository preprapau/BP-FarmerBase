<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдирд╛рдлрд╛тАУрдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг | Farmerbase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px
}
header a,footer a{
  text-decoration:none;
  color:#2e7d32;
  font-weight:600
}
.wrap{
  max-width:1000px;
  margin:18px auto;
  background:#fff;
  padding:22px;
  border-radius:12px
}
h2{color:#2e7d32;margin-top:0}
h3{color:#1565c0;margin-bottom:6px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:right
}
th{background:#eef5ee}
.left{text-align:left}
.sum{background:#fafafa;font-weight:700}

input{
  width:100%;
  padding:6px;
  box-sizing:border-box
}
button{
  padding:6px 12px;
  border:none;
  background:#2e7d32;
  color:#fff;
  border-radius:6px;
  cursor:pointer
}
.del{
  background:#c62828
}
.note{font-size:13px;color:#555}
</style>
</head>

<body>

<!-- ЁЯФЭ TOP NAV -->
<header>
  <a href="index.html">ЁЯПа Back to Home</a>
  <div>
    <a href="expense-demo.html">тЧАя╕П Expense</a> |
    <a href="five-year-roi.html">ROI тЦ╢я╕П</a>
  </div>
</header>

<div class="wrap">

<h2>ЁЯТ╣ рдирд╛рдлрд╛тАУрдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<!-- ================= SUMMARY ================= -->
<table>
<tr><th class="left">рд╡рд┐рд╡рд░рдг</th><th>рд░рдХрдо</th></tr>
<tr><td class="left">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td><td id="incomeTotal">0</td></tr>
<tr><td class="left">рдХреБрд▓ рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</td><td id="expenseTotal">0</td></tr>
<tr class="sum"><td class="left">рд╕рдЮреНрдЪрд╛рд▓рди рдирд╛рдлрд╛</td><td id="operatingProfit">0</td></tr>
</table>

<hr>

<!-- ================= PROFIT ALLOCATION ================= -->
<h3>ЁЯУК рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>

<table>
<thead>
<tr>
  <th class="left">рд╢реАрд░реНрд╖рдХ</th>
  <th>%</th>
  <th></th>
</tr>
</thead>
<tbody id="allocBody"></tbody>
<tfoot>
<tr class="sum">
  <td class="left">рдЬрдореНрдорд╛</td>
  <td id="allocPct">100%</td>
  <td></td>
</tr>
</tfoot>
</table>

<div style="margin-top:8px">
  <input id="allocTitle" placeholder="рдирдпрд╛рдБ рд╢реАрд░реНрд╖рдХ">
  <input id="allocRate" placeholder="%" type="number">
  <button onclick="addAlloc()">+ Add</button>
</div>

<p class="note">
тЬФя╕П рдкреНрд░рддрд┐рд╢рддрдХреЛ рдЬрдореНрдорд╛ 100% рд╣реБрдиреБрдкрд░реНрдЫ<br>
тЬФя╕П Save рд╕реНрд╡рддрдГ рд╣реБрдиреНрдЫ
</p>

</div>

<!-- ЁЯФ╗ BOTTOM NAV -->
<footer>
  <a href="expense-demo.html">тЧАя╕П Previous</a>
  <a href="index.html">ЁЯПа Home</a>
  <a href="five-year-roi.html">Next тЦ╢я╕П</a>
</footer>

<script>
/* ================= LOAD PROJECT ================= */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(key)) || {};

/* ================= INCOME ================= */
let income=0;
(project.incomeData||[]).forEach(i=>{
  income+=Number(i.amount)||0;
});
incomeTotal.innerText=Math.round(income);

/* ================= EXPENSE ================= */
let expense=0;
(project.expenseData||[]).forEach(e=>{
  if(e.mainCat==="рдЪрд╛рд▓реБ рдЦрд░реНрдЪ"){
    expense+=Number(e.amount)||0;
  }
});
expenseTotal.innerText=Math.round(expense);

/* ================= PROFIT ================= */
let profit=income-expense;
operatingProfit.innerText=Math.round(profit);

/* ================= ALLOCATION ================= */
project.profitAllocation = project.profitAllocation || [
  {id:1,title:"рдкреБрдирдГ рд▓рдЧрд╛рдиреА",pct:50},
  {id:2,title:"рдШрд░рд╛рдпрд╕реА рдЦрд░реНрдЪ",pct:30},
  {id:3,title:"рдмрдЪрдд",pct:20}
];

function renderAlloc(){
  allocBody.innerHTML="";
  let tot=0;

  project.profitAllocation.forEach(a=>{
    tot+=Number(a.pct)||0;
    allocBody.innerHTML+=`
      <tr>
        <td class="left">${a.title}</td>
        <td>${a.pct}</td>
        <td><button class="del" onclick="delAlloc(${a.id})">тЭМ</button></td>
      </tr>
    `;
  });

  allocPct.innerText=tot+"%";
  localStorage.setItem(key,JSON.stringify(project));
}

function addAlloc(){
  if(!allocTitle.value||!allocRate.value) return;
  project.profitAllocation.push({
    id:Date.now(),
    title:allocTitle.value,
    pct:Number(allocRate.value)
  });
  allocTitle.value="";
  allocRate.value="";
  renderAlloc();
}

function delAlloc(id){
  project.profitAllocation=
    project.profitAllocation.filter(a=>a.id!==id);
  renderAlloc();
}

/* INIT */
renderAlloc();
</script>

</body>
</html>
