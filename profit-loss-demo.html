<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit / Loss ‚Äì FarmerBase BPMS</title>
<style>
body{font-family:system-ui;background:#f4f7f6;margin:0}
.wrap{max-width:1100px;margin:auto;padding:20px}

/* MENU */
.nav{
  display:flex;gap:8px;flex-wrap:wrap;
  background:#e9f5ea;padding:12px;border-radius:12px
}
.nav a{
  padding:8px 14px;border-radius:20px;
  text-decoration:none;color:#000;background:#dff0e1
}
.nav a.active{background:#2e7d32;color:#fff}

/* PROGRESS */
.progress-box{
  background:#e9f5ea;border-radius:12px;padding:14px;margin:18px 0
}
.progress-bar{
  height:10px;background:#ddd;border-radius:10px;overflow:hidden
}
.progress-bar span{
  display:block;height:100%;width:71%;
  background:#2e7d32
}

/* CARD */
.card{background:#fff;border-radius:14px;padding:20px;margin-top:20px}
table{width:100%;border-collapse:collapse}
td,th{padding:10px;border-bottom:1px solid #ddd}
th{text-align:left;background:#f1f5f1}

/* DIVIDEND */
input[type=number]{width:80px;padding:6px}
.total{font-weight:bold}
.green{color:#2e7d32}
.red{color:#c62828}
</style>
</head>
<body>

<div class="wrap">

<!-- MENU -->
<div class="nav">
  <a href="short-info.html">Short Info</a>
  <a href="business-detail.html">Detail</a>
  <a href="expense-demo.html">Expense</a>
  <a href="income-demo.html">Income</a>
  <a class="active">Profit / Loss</a>
  <a href="five-year-roi.html">5-Year ROI</a>
  <a href="full-proposal.html">Proposal</a>
</div>

<!-- PROGRESS -->
<div class="progress-box">
  <b>‡§ö‡§∞‡§£ ‡•´ / ‡•≠ (‡•≠‡•ß%)</b>
  <div class="progress-bar"><span></span></div>
</div>

<!-- PROFIT LOSS -->
<div class="card">
<h2>üìä ‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</h2>

<table>
<tr><th>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th><th>‡§∞‡§ï‡§Æ (‡§∞‡•Å.)</th></tr>
<tr><td>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</td><td id="inc">0</td></tr>
<tr><td>‡§ö‡§æ‡§≤‡•Å ‡§ñ‡§∞‡•ç‡§ö</td><td id="cash">0</td></tr>
<tr><td>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä</td><td id="depr">0</td></tr>
<tr><td>‡§¨‡•à‡§Ç‡§ï ‡§¨‡•ç‡§Ø‡§æ‡§ú</td><td id="int">0</td></tr>
<tr class="total">
  <td>‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®</td>
  <td id="profit">0</td>
</tr>
</table>
</div>

<!-- DIVIDEND -->
<div class="card">
<h3>üí∞ ‡§≤‡§æ‡§≠‡§æ‡§Ç‡§∂ ‡§µ‡§ø‡§§‡§∞‡§£</h3>

<table>
<tr>
  <th>‡§µ‡§ø‡§ß‡§æ</th>
  <th>%</th>
  <th>‡§∞‡§ï‡§Æ</th>
</tr>
<tr>
  <td>‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä / ‡§∏‡§æ‡§ù‡•á‡§¶‡§æ‡§∞</td>
  <td><input type="number" id="d1" value="60"></td>
  <td id="a1">0</td>
</tr>
<tr>
  <td>‡§™‡•Å‡§®‡§É ‡§≤‡§ó‡§æ‡§®‡•Ä</td>
  <td><input type="number" id="d2" value="40"></td>
  <td id="a2">0</td>
</tr>
</table>
</div>

</div>

<script>
let key = localStorage.getItem("activeProject");
let p = JSON.parse(localStorage.getItem(key)) || {};

let income = 0;
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));

let cash=0,depr=0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="‡§Æ‡•á‡§∂‡•Ä‡§® ‡§î‡§ú‡§æ‡§∞ / ‡§™‡•ç‡§∞‡§µ‡§ø‡§ß‡§ø" || e.category==="‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£"){
    depr += Number(e.amount||0)*0.15;
  }else{
    cash += Number(e.amount||0);
  }
});

let interest = Number(p.loanInterest||0);
let profit = income - cash - depr - interest;

inc.innerText=income;
cash.innerText=cash;
depr.innerText=Math.round(depr);
int.innerText=interest;
profitEl = document.getElementById("profit");
profitEl.innerText=Math.round(profit);
profitEl.className = profit>=0?"green":"red";

function calcDividend(){
  let p1=Number(d1.value||0),p2=Number(d2.value||0);
  a1.innerText=Math.round(profit*p1/100);
  a2.innerText=Math.round(profit*p2/100);
}
d1.oninput=d2.oninput=calcDividend;
calcDividend();
</script>

</body>
</html>
