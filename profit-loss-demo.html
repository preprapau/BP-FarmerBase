<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let p = JSON.parse(localStorage.getItem(key)||"{}");

/* ===== CALCULATE INCOME ===== */
let income = 0;
(p.incomeData||[]).forEach(i=>{
  income += Number(i.amount||0);
});

/* ===== CALCULATE EXPENSE (KEYWORD BASED) ===== */
let cash = 0;
let depr = 0;
let interest = 0;

(p.expenseData||[]).forEach(e=>{
  let amt = Number(e.amount||0);
  let cat = (e.category || "").toLowerCase();
  let title = (e.title || "").toLowerCase();
  let source = (e.source || "").toLowerCase(); // लगानीको स्रोत

  /* --- BANK INTEREST --- */
  if(
    cat.includes("ब्याज") ||
    title.includes("ब्याज") ||
    source.includes("ब्याज") ||
    title.includes("interest") ||
    title.includes("loan") ||
    source.includes("bank") ||
    source.includes("loan")
  ){
    interest += amt;
  }

  /* --- DEPRECIATION (15%) --- */
  else if(
    cat.includes("मेसिन") ||
    cat.includes("मेशीन") ||
    cat.includes("machine") ||
    cat.includes("प्रविधि") ||
    cat.includes("पूर्वाधार") ||
    cat.includes("भवन") ||
    cat.includes("केज") ||
    cat.includes("shed")
  ){
    depr += amt * 0.15;
  }

  /* --- CASH EXPENSE --- */
  else{
    cash += amt;
  }
});

/* ===== PROFIT ===== */
let profit = income - cash - depr - interest;

/* ===== DISPLAY ===== */
inc.innerText = income;
cash.innerText = Math.round(cash);
depr.innerText = Math.round(depr);
interestEl = document.getElementById("interest");
interestEl.innerText = Math.round(interest);

let profitEl = document.getElementById("profit");
profitEl.innerText = Math.round(profit);
profitEl.className = profit>=0 ? "green" : "red";
</script>
