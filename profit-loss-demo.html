<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди тАУ BPMS</title>

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
.wrap{max-width:1000px;margin:auto;padding:20px}

h2{color:#2e7d32;margin-top:0}

.card{
  background:#fff;border-radius:14px;
  padding:20px;margin-top:20px
}

table{
  width:100%;border-collapse:collapse
}
th,td{
  padding:10px;border-bottom:1px solid #ddd
}
th{background:#f1f5f1;text-align:left}

.total{font-weight:bold}
.green{color:#2e7d32}
.red{color:#c62828}

@media print{
  body{background:#fff}
}
</style>
</head>

<body>

<div class="wrap">

<div class="card">
<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<table>
<tr><th>рд╢реАрд░реНрд╖рдХ</th><th>рд░рдХрдо (рд░реБ.)</th></tr>

<tr><td>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td><td id="inc">0</td></tr>
<tr><td>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</td><td id="cash">0</td></tr>
<tr><td>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (резрел%)</td><td id="depr">0</td></tr>
<tr><td>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</td><td id="int">0</td></tr>

<tr class="total">
  <td>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</td>
  <td id="profit">0</td>
</tr>
</table>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let p = JSON.parse(localStorage.getItem(key) || "{}");

/* ===== ELEMENTS ===== */
let incEl = document.getElementById("inc");
let cashEl = document.getElementById("cash");
let deprEl = document.getElementById("depr");
let intEl  = document.getElementById("int");
let profitEl = document.getElementById("profit");

/* ===== TOTAL INCOME ===== */
let income = 0;
(p.incomeData || []).forEach(i=>{
  income += Number(i.amount || 0);
});

/* ===== EXPENSE BREAKDOWN ===== */
let cash = 0;
let depr = 0;
let interest = 0;

(p.expenseData || []).forEach(e=>{
  let amt = Number(e.amount || 0);
  let cat = (e.category || "").toLowerCase();
  let title = (e.title || "").toLowerCase();
  let source = (e.source || "").toLowerCase();

  /* BANK INTEREST */
  if(
    cat.includes("рдмреНрдпрд╛рдЬ") ||
    title.includes("рдмреНрдпрд╛рдЬ") ||
    source.includes("рдмреНрдпрд╛рдЬ") ||
    title.includes("interest") ||
    source.includes("loan") ||
    source.includes("bank")
  ){
    interest += amt;
  }

  /* DEPRECIATION (CAPITAL ITEMS) */
  else if(
    cat.includes("рдореЗрд╕рд┐рди") ||
    cat.includes("рдореЗрд╢реАрди") ||
    cat.includes("machine") ||
    cat.includes("рдкреНрд░рд╡рд┐рдзрд┐") ||
    cat.includes("рдкреВрд░реНрд╡рд╛рдзрд╛рд░") ||
    cat.includes("рднрд╡рди") ||
    cat.includes("рдХреЗрдЬ") ||
    cat.includes("shed")
  ){
    depr += amt * 0.15;
  }

  /* CASH EXPENSE */
  else{
    cash += amt;
  }
});

/* ===== PROFIT ===== */
let profit = income - cash - depr - interest;

/* ===== DISPLAY ===== */
incEl.innerText = income;
cashEl.innerText = Math.round(cash);
deprEl.innerText = Math.round(depr);
intEl.innerText = Math.round(interest);
profitEl.innerText = Math.round(profit);
profitEl.className = profit >= 0 ? "green" : "red";
</script>

</body>
</html>
