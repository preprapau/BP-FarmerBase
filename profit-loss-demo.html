<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit тАУ Loss (Final) | Farmerbase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between
}
header a,footer a{
  color:#2e7d32;
  font-weight:600;
  text-decoration:none
}
.wrap{
  max-width:900px;
  margin:18px auto;
  background:#fff;
  padding:22px;
  border-radius:12px
}
h2,h3{color:#2e7d32;margin-top:0}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:right}
th{background:#eef5ee}
.left{text-align:left}
.sum{font-weight:700;background:#fafafa}
.pos{color:#2e7d32;font-weight:700}
.neg{color:#c62828;font-weight:700}
input{width:100%;padding:6px;box-sizing:border-box}
.small{font-size:13px;color:#2e7d32}
</style>
</head>

<body>

<header>
  <a href="income-demo.html">тЧАя╕П Income</a>
  <a href="index.html">ЁЯПа Home</a>
</header>

<div class="wrap">

<h2>ЁЯУК рдирд╛рдлрд╛ тАУ рдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<!-- ================= INCOME ================= -->
<h3>ЁЯТ░ рдЖрдореНрджрд╛рдиреА</h3>
<table>
<tr>
  <th class="left">рд╡рд┐рд╡рд░рдг</th>
  <th>рд░рдХрдо</th>
</tr>
<tr>
  <td class="left">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td>
  <td id="totalIncome">0</td>
</tr>
</table>

<!-- ================= OPERATING COST ================= -->
<h3>ЁЯТ╕ рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</h3>
<table>
<tr>
  <th class="left">рд╡рд┐рд╡рд░рдг</th>
  <th>рд░рдХрдо</th>
</tr>
<tr>
  <td class="left">рдХреБрд▓ рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</td>
  <td id="totalOperating">0</td>
</tr>
</table>

<!-- ================= GROSS PROFIT ================= -->
<h3>ЁЯУИ рд╕рдХрд▓ рдирд╛рдлрд╛</h3>
<table>
<tr class="sum">
  <td class="left">рд╕рдХрд▓ рдирд╛рдлрд╛ (рдЖрдореНрджрд╛рдиреА тИТ рдЪрд╛рд▓реБ рдЦрд░реНрдЪ)</td>
  <td id="grossProfit">0</td>
</tr>
</table>

<!-- ================= DEPRECIATION ================= -->
<h3>ЁЯПЧя╕П рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (Depreciation)</h3>
<table>
<tr>
  <th class="left">рд╡рд┐рд╡рд░рдг</th>
  <th>рджрд░ %</th>
  <th>рд░рдХрдо</th>
</tr>
<tr>
  <td class="left">рд╡рд╛рд░реНрд╖рд┐рдХ рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (рд╕реНрдерд┐рд░ рдЦрд░реНрдЪрдорд╛)</td>
  <td>
    <input type="number" id="depRate" value="10" oninput="recalc()">
  </td>
  <td id="depreciation">0</td>
</tr>
</table>

<!-- ================= PROFIT BEFORE TAX ================= -->
<h3>ЁЯз╛ рдХрд░-рдкреВрд░реНрд╡ рдирд╛рдлрд╛</h3>
<table>
<tr class="sum">
  <td class="left">рдХрд░-рдкреВрд░реНрд╡ рдирд╛рдлрд╛ (рд╕рдХрд▓ рдирд╛рдлрд╛ тИТ рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА)</td>
  <td id="profitBeforeTax">0</td>
</tr>
</table>

<!-- ================= TAX ================= -->
<h3>ЁЯПЫя╕П рдЖрдореНрджрд╛рдиреА рдХрд░</h3>
<table>
<tr>
  <th class="left">рд╡рд┐рд╡рд░рдг</th>
  <th>рджрд░ %</th>
  <th>рд░рдХрдо</th>
</tr>
<tr>
  <td class="left">рдЖрдореНрджрд╛рдиреА рдХрд░</td>
  <td>
    <input type="number" id="taxRate" value="15" oninput="recalc()">
  </td>
  <td id="incomeTax">0</td>
</tr>
</table>

<!-- ================= NET PROFIT ================= -->
<h3>тЬЕ рдЦреБрдж рдирд╛рдлрд╛ (рдХрд░рдкрдЫрд┐)</h3>
<table>
<tr class="sum">
  <td class="left">рдХрд░-рдкрдЫрд┐рдХреЛ рдЦреБрдж рдирд╛рдлрд╛</td>
  <td id="netProfit">0</td>
</tr>
</table>

<p class="small">
тЬФя╕П рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА рд░ рдХрд░ рджреБрд╡реИ editable рдЫрдиреН  
| тЬФя╕П рдирд╛рдлрд╛ тЙд 0 рднрдП рдХрд░ рд╕реНрд╡рддрдГ 0 рд╣реБрдиреНрдЫ
</p>

</div>

<footer>
  <a href="income-demo.html">тЧАя╕П Income</a>
  <a href="index.html">ЁЯПа Home</a>
</footer>

<script>
/* =====================================================
   LOAD PROJECT
   ===================================================== */
const projectKey = localStorage.getItem("activeProject");
if(!projectKey){
  alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}

let project = JSON.parse(localStorage.getItem(projectKey)) || {};
const expenses = project.expenses || [];
const totalIncome = Number(project.totalIncome) || 0;

/* =====================================================
   BASE COST CALCULATION
   ===================================================== */
let operatingCost = 0;
let fixedCost = 0;

expenses.forEach(e=>{
  if(e.costType === "operating"){
    operatingCost += Number(e.amount)||0;
  }
  if(e.costType === "fixed"){
    fixedCost += Number(e.amount)||0;
  }
});

/* =====================================================
   RECALC FUNCTION
   ===================================================== */
function recalc(){

  const depRate = Number(depRateEl.value)||0;
  const taxRate = Number(taxRateEl.value)||0;

  const grossProfit = totalIncome - operatingCost;
  const depreciation = fixedCost * depRate / 100;
  const profitBeforeTax = grossProfit - depreciation;

  const incomeTax = profitBeforeTax > 0
    ? profitBeforeTax * taxRate / 100
    : 0;

  const netProfit = profitBeforeTax - incomeTax;

  // Render
  totalIncomeEl.innerText = totalIncome.toFixed(2);
  totalOperatingEl.innerText = operatingCost.toFixed(2);
  grossProfitEl.innerText = grossProfit.toFixed(2);
  depreciationEl.innerText = depreciation.toFixed(2);
  profitBeforeTaxEl.innerText = profitBeforeTax.toFixed(2);
  incomeTaxEl.innerText = incomeTax.toFixed(2);
  netProfitEl.innerText = netProfit.toFixed(2);

  grossProfitEl.className = grossProfit >= 0 ? "pos" : "neg";
  profitBeforeTaxEl.className = profitBeforeTax >= 0 ? "pos" : "neg";
  netProfitEl.className = netProfit >= 0 ? "pos" : "neg";

  // Save for ROI / Proposal
  project.profitLoss = {
    totalIncome,
    operatingCost,
    fixedCost,
    grossProfit,
    depreciation,
    profitBeforeTax,
    incomeTax,
    netProfit,
    depRate,
    taxRate
  };

  localStorage.setItem(projectKey, JSON.stringify(project));
}

/* =====================================================
   INIT
   ===================================================== */
const totalIncomeEl = document.getElementById("totalIncome");
const totalOperatingEl = document.getElementById("totalOperating");
const grossProfitEl = document.getElementById("grossProfit");
const depreciationEl = document.getElementById("depreciation");
const profitBeforeTaxEl = document.getElementById("profitBeforeTax");
const incomeTaxEl = document.getElementById("incomeTax");
const netProfitEl = document.getElementById("netProfit");
const depRateEl = document.getElementById("depRate");
const taxRateEl = document.getElementById("taxRate");

recalc();
</script>

</body>
</html>
