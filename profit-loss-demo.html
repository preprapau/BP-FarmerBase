<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit / Loss тАУ FarmerBase BPMS</title>

<style>
body{font-family:system-ui;background:#f4f7f6;margin:0}
.wrap{max-width:1100px;margin:auto;padding:20px}

/* MENU */
.nav{
  display:flex;gap:8px;flex-wrap:wrap;
  background:#e9f5ea;padding:12px;border-radius:12px
}
.nav a{
  padding:8px 14px;border-radius:20px;
  text-decoration:none;color:#000;background:#dff0e1
}
.nav a.active{background:#2e7d32;color:#fff}

/* PROGRESS */
.progress-box{
  background:#e9f5ea;border-radius:12px;padding:14px;margin:18px 0
}
.progress-bar{
  height:10px;background:#ddd;border-radius:10px;overflow:hidden
}
.progress-bar span{
  display:block;height:100%;width:71%;
  background:#2e7d32
}

/* CARD */
.card{background:#fff;border-radius:14px;padding:20px;margin-top:20px}
table{width:100%;border-collapse:collapse}
td,th{padding:10px;border-bottom:1px solid #ddd}
th{text-align:left;background:#f1f5f1}

input[type=number], input[type=text]{padding:6px;width:90px}

/* COLORS */
.total{font-weight:bold}
.green{color:#2e7d32}
.red{color:#c62828}

button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}
button.del{background:#c62828}
.note{font-size:13px;color:#555;margin-top:8px}
</style>
</head>

<body>
<div class="wrap">

<!-- MENU -->
<div class="nav">
  <a href="short-info.html">Short Info</a>
  <a href="business-detail.html">Detail</a>
  <a href="expense-demo.html">Expense</a>
  <a href="income-demo.html">Income</a>
  <a class="active">Profit / Loss</a>
  <a href="five-year-roi.html">5-Year ROI</a>
  <a href="full-proposal.html">Proposal</a>
</div>

<!-- PROGRESS -->
<div class="progress-box">
  <b>рдЪрд░рдг рел / рен (ренрез%)</b>
  <div class="progress-bar"><span></span></div>
</div>

<!-- PROFIT LOSS -->
<div class="card">
<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<table>
<tr><th>рд╢реАрд░реНрд╖рдХ</th><th>рд░рдХрдо (рд░реБ.)</th></tr>
<tr><td>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td><td id="inc">0</td></tr>
<tr><td>рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</td><td id="cash">0</td></tr>
<tr><td>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (15%)</td><td id="depr">0</td></tr>
<tr><td>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</td><td id="interest">0</td></tr>
<tr class="total">
  <td>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди</td>
  <td id="profit">0</td>
</tr>
</table>
</div>

<!-- DIVIDEND -->
<div class="card">
<h3>ЁЯТ░ рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>

<table>
<thead>
<tr>
  <th>рд╡рд┐рдзрд╛</th>
  <th>%</th>
  <th>рд░рдХрдо</th>
  <th></th>
</tr>
</thead>
<tbody id="divBody"></tbody>
<tfoot>
<tr class="total">
  <td>рдХреБрд▓</td>
  <td id="divTotal">0%</td>
  <td></td>
  <td></td>
</tr>
</tfoot>
</table>

<button onclick="addDividend()">тЮХ рдердкреНрдиреБрд╣реЛрд╕реН</button>

<p class="note">
ЁЯУМ рдХреБрд▓ % = 100 рд╣реБрдиреБрдкрд░реНрдЫред рдиреЛрдХреНрд╕рд╛рди рднрдП рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг рд╣реБрдБрджреИрдиред
</p>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let p = JSON.parse(localStorage.getItem(key)||"{}");

/* ===== PROFIT / LOSS ===== */
let income = 0;
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));

let cash=0, depr=0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐" || e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг"){
    depr += Number(e.amount||0) * 0.15;
  }else{
    cash += Number(e.amount||0);
  }
});

let interest = Number(p.loanInterest||0);
let profit = income - cash - depr - interest;

inc.innerText = income;
cash.innerText = cash;
depr.innerText = Math.round(depr);
interest.innerText = interest;

let profitEl = document.getElementById("profit");
profitEl.innerText = Math.round(profit);
profitEl.className = profit>=0 ? "green" : "red";

/* ===== DIVIDEND SYSTEM ===== */
let dividends = [
  {title:"рд╕реНрд╡рд╛рдореА / рд╕рд╛рдЭреЗрджрд╛рд░", pct:60},
  {title:"рдкреБрдирдГ рд▓рдЧрд╛рдиреА", pct:40}
];

function renderDividend(){
  divBody.innerHTML="";
  let totalPct = 0;

  dividends.forEach((d,i)=>{
    totalPct += d.pct;
    let amt = profit>0 ? Math.round(profit*d.pct/100) : "тАФ";

    divBody.innerHTML += `
    <tr>
      <td><input type="text" value="${d.title}"
          onchange="dividends[${i}].title=this.value"></td>
      <td><input type="number" value="${d.pct}"
          onchange="dividends[${i}].pct=Number(this.value);renderDividend()"></td>
      <td>${amt}</td>
      <td><button class="del" onclick="removeDividend(${i})">тЬЦ</button></td>
    </tr>`;
  });

  divTotal.innerText = totalPct + "%";
  divTotal.style.color = (totalPct===100) ? "#2e7d32" : "#c62828";
}

function addDividend(){
  dividends.push({title:"рдирдпрд╛рдБ рд╡рд┐рдзрд╛", pct:0});
  renderDividend();
}

function removeDividend(i){
  dividends.splice(i,1);
  renderDividend();
}

renderDividend();
</script>

</body>
</html>
