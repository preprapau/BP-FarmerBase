<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
  padding-bottom:80px; /* menu space */
}

/* MAIN CARD */
.wrap{
  max-width:950px;
  margin:20px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#f0f0f0;text-align:left}
.right{text-align:right}
.big{font-size:18px;font-weight:700}
.green{background:#e8f5e9}
.blue{background:#e3f2fd}
input{padding:6px;width:90px}

/* FIXED MENU */
.navbar{
  position:fixed;
  left:0;
  bottom:0;
  width:100%;
  background:#2e7d32;
  display:flex;
  justify-content:space-between;
  padding:12px 20px;
  box-sizing:border-box;
}
.navbar button{
  background:#fff;
  color:#2e7d32;
  border:none;
  padding:8px 18px;
  border-radius:6px;
  font-size:14px;
  cursor:pointer;
}
.navbar button:hover{opacity:.9}

h2{color:#2e7d32;margin-top:0}
.note{font-size:13px;color:#555;margin-top:8px}
</style>
</head>

<body>

<div class="wrap">
<h2>ЁЯУК рдирд╛рдлрд╛ / рдиреЛрдХреНрд╕рд╛рди рд╡рд┐рд╡рд░рдг (Profit & Loss)</h2>

<table>
<tr><th>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</th><td class="right" id="income">0</td></tr>
<tr><th>рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</th><td class="right" id="cash">0</td></tr>
<tr><th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</th><td class="right" id="depr">0</td></tr>
<tr>
  <th>рдмреИрдВрдХ рдмреНрдпрд╛рдЬ</th>
  <td class="right"><input id="interest" value="0"></td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкреВрд░реНрд╡ рдирд╛рдлрд╛</th>
  <td class="right" id="pbt">0</td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ (%)</th>
  <td class="right"><input id="taxRate" value="0"></td>
</tr>
<tr>
  <th>рдЖрдореНрджрд╛рдиреА рдХрд░ рд░рдХрдо</th>
  <td class="right" id="taxAmt">0</td>
</tr>
<tr class="green big">
  <th>рдХрд░ рдкрд╢реНрдЪрд╛рдд рдирд╛рдлрд╛</th>
  <td class="right" id="netProfit">0</td>
</tr>
</table>

<h3 style="margin-top:25px;color:#2e7d32">ЁЯТ░ рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</h3>

<table class="blue">
<tr>
  <th>рд╡рд┐рд╡рд░рдг</th>
  <th class="right">%</th>
  <th class="right">рд░рдХрдо</th>
</tr>
<tr>
  <td>рд▓рд╛рднрд╛рдВрд╢ рд╡рд┐рддрд░рдг</td>
  <td class="right"><input id="divRate" value="0"></td>
  <td class="right" id="divAmt">0</td>
</tr>
<tr class="big">
  <td>рд╡реНрдпрд╡рд╕рд╛рдпрдорд╛ рдкреБрдирдГ рд▓рдЧрд╛рдиреА</td>
  <td></td>
  <td class="right" id="retained">0</td>
</tr>
</table>

<div class="note">
тЬФя╕П Expense page рдмрд╛рдЯ рд╕реНрд╡рддрдГ рдбрд╛рдЯрд╛ рдЖрдПрдХреЛ<br>
тЬФя╕П Menu рддрд▓ рд╕реНрдерд┐рд░ (always visible)
</div>
</div>

<!-- ===== FIXED NAV MENU (100% VISIBLE) ===== -->
<div class="navbar">
  <button onclick="location.href='income-demo.html'">тмЕ Income</button>
  <button onclick="location.href='five-year-roi.html'">ROI тЮб</button>
</div>

<script>
/* LOAD PROJECT */
let key=localStorage.getItem("activeProject");
if(!key){alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");location.href="index.html";}
let p=JSON.parse(localStorage.getItem(key));

/* INCOME */
let income=0;
(p.incomeData||[]).forEach(i=>income+=Number(i.amount||0));

/* EXPENSE */
let cash=0,depr=0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")
    depr+=e.amount*0.15;
  else cash+=e.amount;
});

/* CALC */
function calc(){
  const interest=Number(interestEl.value||0);
  const taxRate=Number(taxRateEl.value||0);
  const divRate=Number(divRateEl.value||0);

  const pbt=income-cash-depr-interest;
  const tax=pbt>0?pbt*(taxRate/100):0;
  const net=pbt-tax;
  const div=net>0?net*(divRate/100):0;

  incomeEl.innerText=income.toLocaleString();
  cashEl.innerText=cash.toLocaleString();
  deprEl.innerText=Math.round(depr).toLocaleString();
  pbtEl.innerText=Math.round(pbt).toLocaleString();
  taxAmtEl.innerText=Math.round(tax).toLocaleString();
  netProfitEl.innerText=Math.round(net).toLocaleString();
  divAmtEl.innerText=Math.round(div).toLocaleString();
  retainedEl.innerText=Math.round(net-div).toLocaleString();
}

/* BIND */
const incomeEl=income, cashEl=cash;
const incomeEl2=document.getElementById("income");
const cashEl2=document.getElementById("cash");
const deprEl=document.getElementById("depr");
const pbtEl=document.getElementById("pbt");
const taxAmtEl=document.getElementById("taxAmt");
const netProfitEl=document.getElementById("netProfit");
const divAmtEl=document.getElementById("divAmt");
const retainedEl=document.getElementById("retained");
const interestEl=document.getElementById("interest");
const taxRateEl=document.getElementById("taxRate");
const divRateEl=document.getElementById("divRate");

function sync(){
  incomeEl2.innerText=income.toLocaleString();
  cashEl2.innerText=cash.toLocaleString();
  calc();
}
[interestEl,taxRateEl,divRateEl].forEach(i=>i.oninput=calc);
sync();
</script>

</body>
</html>
