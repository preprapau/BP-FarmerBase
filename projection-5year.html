<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>5-Year Projection | Farmerbase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between
}
header a,footer a{
  color:#2e7d32;
  font-weight:600;
  text-decoration:none
}
.wrap{
  max-width:1100px;
  margin:18px auto;
  background:#fff;
  padding:22px;
  border-radius:12px
}
h2{color:#2e7d32;margin-top:0}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:right;
  font-size:14px
}
th{background:#eef5ee}
.left{text-align:left}
.sum{font-weight:700;background:#fafafa}
input{
  width:80px;
  padding:4px;
  text-align:right
}
.note{font-size:13px;color:#2e7d32}
</style>
</head>

<body>

<header>
  <a href="roi.html">‚óÄÔ∏è ROI</a>
  <a href="index.html">üè† Home</a>
</header>

<div class="wrap">

<h2>üìà 5-Year Financial Projection</h2>

<p class="note">
‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§®‡§æ‡§´‡§æ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§¶‡§∞ (%):
<input type="number" id="growthRate" value="5" oninput="recalc()"> %
</p>

<table>
<thead>
<tr>
  <th class="left">‡§µ‡§∞‡•ç‡§∑</th>
  <th>‡§ï‡§∞-‡§™‡•Ç‡§∞‡•ç‡§µ ‡§®‡§æ‡§´‡§æ</th>
  <th>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä</th>
  <th>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§ï‡§∞</th>
  <th>‡§ï‡§∞-‡§™‡§õ‡§ø‡§ï‡•ã ‡§®‡§æ‡§´‡§æ</th>
  <th>‡§ï‡•Å‡§≤ ‡§®‡§æ‡§´‡§æ (‡§ú‡§Æ‡•ç‡§Æ‡§æ)</th>
  <th>ROI %</th>
</tr>
</thead>
<tbody id="body"></tbody>
<tfoot>
<tr class="sum">
  <td class="left">5 ‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§ï‡•Å‡§≤ ‡§®‡§æ‡§´‡§æ</td>
  <td colspan="6" id="total5y">0</td>
</tr>
</tfoot>
</table>

<p class="note">
‚úîÔ∏è Year-1 actual data ‡§¨‡§æ‡§ü projection  
| ‚úîÔ∏è Straight-line depreciation  
| ‚úîÔ∏è Tax automatically applied
</p>

</div>

<footer>
  <a href="roi.html">‚óÄÔ∏è Back</a>
  <a href="index.html">üè† Home</a>
</footer>

<script>
/* =====================================================
   LOAD PROJECT DATA
   ===================================================== */
const projectKey = localStorage.getItem("activeProject");
if(!projectKey){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}

const project = JSON.parse(localStorage.getItem(projectKey)) || {};
const pl = project.profitLoss || {};
const roiBase = project.roi || {};

/* Base values from Year-1 */
const baseNetProfit = Number(pl.netProfit) || 0;
const depreciation = Number(pl.depreciation) || 0;
const taxRate = Number(pl.taxRate) || 0;
const fixedInvestment = Number(pl.fixedCost) || 0;

/* =====================================================
   RECALC FUNCTION
   ===================================================== */
function recalc(){

  const growth = Number(growthRate.value) || 0;

  body.innerHTML = "";
  let cumulative = 0;
  let total5 = 0;

  for(let y=1; y<=5; y++){

    const factor = Math.pow(1 + growth/100, y-1);

    const netProfit = baseNetProfit * factor;
    const profitBeforeTax = netProfit + depreciation;
    const tax = profitBeforeTax > 0
      ? profitBeforeTax * taxRate / 100
      : 0;

    const finalNet = profitBeforeTax - tax;

    cumulative += finalNet;
    total5 += finalNet;

    const roiPercent = fixedInvestment > 0
      ? (cumulative / fixedInvestment) * 100
      : 0;

    body.innerHTML += `
    <tr>
      <td class="left">Year ${y}</td>
      <td>${profitBeforeTax.toFixed(2)}</td>
      <td>${depreciation.toFixed(2)}</td>
      <td>${tax.toFixed(2)}</td>
      <td>${finalNet.toFixed(2)}</td>
      <td>${cumulative.toFixed(2)}</td>
      <td>${roiPercent.toFixed(2)}</td>
    </tr>`;
  }

  total5y.innerText = total5.toFixed(2);

  /* Save for proposal */
  project.projection5y = {
    growthRate: growth,
    total5YearProfit: total5
  };
  localStorage.setItem(projectKey, JSON.stringify(project));
}

/* =====================================================
   INIT
   ===================================================== */
recalc();
</script>

</body>
</html>
