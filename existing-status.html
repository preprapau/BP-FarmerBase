<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Existing Status | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:950px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2,h3{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

label{font-weight:600}
input,textarea{
  width:100%;
  padding:8px;
  margin-top:6px;
  margin-bottom:12px;
  font-family:inherit;
}
textarea{min-height:90px}

button{
  background:#2e7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:6px 14px;
  cursor:pointer;
}
.del{background:#c62828}
.edit{background:#0277bd}

.card{
  background:#f9fdf9;
  border:1px solid #dceddc;
  border-radius:8px;
  padding:12px;
  margin-top:12px;
}
.card img{
  max-width:100%;
  border-radius:6px;
  margin-top:8px;
}

.checklistBox{
  background:#f6f6f6;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
}
.checkItem{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:4px 0;
}
.checkItem label{
  font-weight:normal;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
</style>
</head>

<body>

<div class="wrap">

<h2>üìÇ Existing Status (‡§π‡§æ‡§≤‡§∏‡§Æ‡•ç‡§Æ‡§ï‡•ã ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ)</h2>
<p class="small">
‡§Ø‡§∏‡§Ö‡§ò‡§ø ‡§ó‡§∞‡§ø‡§è‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§π‡§∞‡•Ç ‡§∞ ‡§π‡§æ‡§≤‡§ï‡•ã ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞/‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§
</p>

<!-- ================= EXISTING WORK ================= -->
<h3>üîπ ‡§Ø‡§∏‡§Ö‡§ò‡§ø ‡§ó‡§∞‡§ø‡§è‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§π‡§∞‡•Ç</h3>

<label>‡§µ‡§ø‡§∑‡§Ø (Topic)</label>
<input id="workTopic" placeholder="‡§ú‡§∏‡•ç‡§§‡•à: ‡§ï‡•É‡§∑‡§ø ‡§§‡§æ‡§≤‡§ø‡§Æ, ‡§∏‡§°‡§ï ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£">

<label>‡§µ‡§ø‡§µ‡§∞‡§£ (Content)</label>
<textarea id="workContent" placeholder="‡§ï‡•á ‡§ï‡§æ‡§Æ ‡§ó‡§∞‡§ø‡§Ø‡•ã, ‡§ï‡§π‡§ø‡§≤‡•á, ‡§ï‡§∏‡§∞‡•Ä, ‡§ï‡§§‡§ø ‡§ú‡§®‡§æ‡§≤‡•á ‡§≤‡§æ‡§≠ ‡§≤‡§ø‡§è..."></textarea>

<label>Photo URL (optional)</label>
<input id="workPhoto" placeholder="https://example.com/photo.jpg">

<button onclick="addWork()">‚ûï Add</button>

<div id="workList"></div>

<hr>

<!-- ================= CHECKLIST ================= -->
<h3>‚úÖ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞ / ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ Checklist</h3>

<label>‡§®‡§Ø‡§æ‡§Å Checklist Item</label>
<input id="checkText" placeholder="‡§ú‡§∏‡•ç‡§§‡•à: ‡§´‡§∞‡•ç‡§Æ‡§∏‡§Æ‡•ç‡§Æ ‡§Æ‡•ã‡§ü‡§∞‡§¨‡§æ‡§ü‡•ã ‡§õ">

<button onclick="addCheck()">‚ûï Add Checklist</button>

<div class="checklistBox" id="checkList"></div>

<!-- ================= NAV ================= -->
<div class="nav">
  <button onclick="location.href='short-info.html'">‚¨Ö Previous</button>
  <button onclick="location.href='business-detail.html'">Next ‚û°</button>
</div>

</div>

<script>
/* ================= EXISTING STATUS ‚Äì FULL AUTOSAVE ================= */

const key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}

const project = JSON.parse(localStorage.getItem(key)) || {};

// init structure
project.existingStatus = project.existingStatus || {
  works: [],
  checklist: []
};

/* ---------- EXISTING WORK ---------- */
function addWork(){
  if(!workTopic.value || !workContent.value){
    alert("‡§µ‡§ø‡§∑‡§Ø ‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§õ");
    return;
  }
  project.existingStatus.works.push({
    topic: workTopic.value,
    content: workContent.value,
    photo: workPhoto.value
  });
  workTopic.value="";
  workContent.value="";
  workPhoto.value="";
  save(renderWorks);
}

function deleteWork(i){
  if(confirm("‡§Ø‡•ã ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§π‡§ü‡§æ‡§â‡§®‡•á ?")){
    project.existingStatus.works.splice(i,1);
    save(renderWorks);
  }
}

function renderWorks(){
  workList.innerHTML="";
  if(project.existingStatus.works.length===0){
    workList.innerHTML="<i>‡§Ö‡§π‡§ø‡§≤‡•á‡§∏‡§Æ‡•ç‡§Æ ‡§ï‡•Å‡§®‡•à ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§õ‡•à‡§®</i>";
    return;
  }
  project.existingStatus.works.forEach((w,i)=>{
    workList.innerHTML+=`
      <div class="card">
        <h4>${i+1}. ${w.topic}</h4>
        <p>${w.content.replace(/\\n/g,"<br>")}</p>
        ${w.photo ? `<img src="${w.photo}">` : ""}
        <br>
        <button class="del" onclick="deleteWork(${i})">üóë Delete</button>
      </div>
    `;
  });
}

/* ---------- CHECKLIST ---------- */
function addCheck(){
  if(!checkText.value) return;
  project.existingStatus.checklist.push({
    text: checkText.value,
    checked: false
  });
  checkText.value="";
  save(renderChecklist);
}

function toggleCheck(i){
  project.existingStatus.checklist[i].checked =
    !project.existingStatus.checklist[i].checked;
  save();
}

function editCheck(i){
  const n = prompt("Checklist ‡§∏‡§ö‡•ç‡§Ø‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç", project.existingStatus.checklist[i].text);
  if(n){
    project.existingStatus.checklist[i].text = n;
    save(renderChecklist);
  }
}

function deleteCheck(i){
  if(confirm("‡§Ø‡•ã Checklist ‡§π‡§ü‡§æ‡§â‡§®‡•á ?")){
    project.existingStatus.checklist.splice(i,1);
    save(renderChecklist);
  }
}

function renderChecklist(){
  checkList.innerHTML="";
  if(project.existingStatus.checklist.length===0){
    checkList.innerHTML="<i>Checklist ‡§õ‡•à‡§®</i>";
    return;
  }
  project.existingStatus.checklist.forEach((c,i)=>{
    checkList.innerHTML+=`
      <div class="checkItem">
        <label>
          <input type="checkbox" ${c.checked?"checked":""}
            onchange="toggleCheck(${i})">
          ${c.text}
        </label>
        <span>
          <button class="edit" onclick="editCheck(${i})">‚úèÔ∏è</button>
          <button class="del" onclick="deleteCheck(${i})">üóë</button>
        </span>
      </div>
    `;
  });
}

/* ---------- SAVE ---------- */
function save(cb){
  localStorage.setItem(key, JSON.stringify(project));
  if(cb) cb();
}

/* init render */
renderWorks();
renderChecklist();
</script>

</body>
</html>
