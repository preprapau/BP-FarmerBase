<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Existing Status | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:1100px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2,h3{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

/* TOP BAR */
.topBar{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  margin-bottom:15px;
}
.topBar .left{text-align:left}
.topBar .center{text-align:center}
.topBar .right{text-align:right}

/* buttons */
button{
  border:none;
  border-radius:6px;
  padding:6px 14px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}
.previewBtn{background:#0277bd}
.edit{background:#0277bd}
.del{background:#c62828}

/* form */
label{font-weight:600}
input,textarea{
  width:100%;
  padding:8px;
  margin-top:6px;
}
textarea{min-height:80px}

/* cards */
.card{
  background:#f9fdf9;
  border:1px solid #dceddc;
  border-radius:8px;
  padding:12px;
  margin-top:12px;
}

/* checklist */
.checkBox{
  background:#f6f6f6;
  border-radius:8px;
  padding:12px;
  margin-top:10px;
}
.checkItem{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:4px 0;
}

/* preview */
.preview input,
.preview textarea,
.preview button:not(.previewBtn){
  pointer-events:none;
  background:#f3f3f3;
}
.previewNote{
  background:#fff3cd;
  padding:6px 10px;
  border-radius:6px;
  font-size:13px;
  margin-bottom:10px;
}

/* bottom nav */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
</style>
</head>

<body>

<div class="wrap" id="page">

<!-- ===== TOP BAR ===== -->
<div class="topBar">
  <div class="left">
    <button onclick="goPrev()">‚¨Ö Short Info</button>
  </div>
  <div class="center">
    <button class="previewBtn" onclick="togglePreview()">üëÅ Preview / ‚úèÔ∏è Edit</button>
  </div>
  <div class="right">
    <button onclick="goNext()">Next ‚û°</button>
  </div>
</div>

<div id="previewNote" class="previewNote" style="display:none">
üëÅ Preview Mode (Read-only)
</div>

<h2>üìÇ Existing Status (‡§π‡§æ‡§≤‡§∏‡§Æ‡•ç‡§Æ‡§ï‡•ã ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ)</h2>

<!-- ===== EXISTING WORKS ===== -->
<h3>üîπ ‡§Ø‡§∏‡§Ö‡§ò‡§ø ‡§ó‡§∞‡§ø‡§è‡§ï‡§æ ‡§ï‡§æ‡§Æ‡§π‡§∞‡•Ç</h3>

<label>‡§µ‡§ø‡§∑‡§Ø</label>
<input id="workTopic">

<label>‡§µ‡§ø‡§µ‡§∞‡§£</label>
<textarea id="workContent"></textarea>

<label>Photo URL</label>
<input id="workPhoto">

<button onclick="addWork()">‚ûï Add Work</button>

<div id="workList"></div>

<hr>

<!-- ===== CHECKLIST ===== -->
<h3>‚úÖ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ / ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞</h3>

<label>‡§®‡§Ø‡§æ‡§Å Checklist</label>
<input id="checkText">

<button onclick="addCheck()">‚ûï Add Checklist</button>

<div class="checkBox" id="checkList"></div>

<!-- ===== BOTTOM NAV ===== -->
<div class="nav">
  <button onclick="goPrev()">‚¨Ö Previous</button>
  <button onclick="goNext()">Next ‚û°</button>
</div>

</div>

<script>
/* ===== SAFETY LOAD ===== */
const key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Home ‡§¨‡§æ‡§ü Project ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
const project = JSON.parse(localStorage.getItem(key));
project.existingStatus ??= { works:[], checklist:[] };

let preview=false;

/* ===== NAVIGATION (FIXED) ===== */
function goPrev(){
  location.href = "short-info.html";
}
function goNext(){
  location.href = "short-analysis.html";
}

/* ===== WORKS ===== */
function addWork(){
  if(!workTopic.value || !workContent.value) return alert("‡§∏‡§¨‡•à field ‡§≠‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  project.existingStatus.works.push({
    topic:workTopic.value,
    content:workContent.value,
    photo:workPhoto.value
  });
  workTopic.value=workContent.value=workPhoto.value="";
  save(renderWorks);
}

function renderWorks(){
  workList.innerHTML="";
  project.existingStatus.works.forEach((w,i)=>{
    workList.innerHTML+=`
      <div class="card">
        <b>${i+1}. ${w.topic}</b>
        <p>${w.content}</p>
        ${w.photo?`<img src="${w.photo}" style="max-width:100%">`:""}
      </div>`;
  });
}

/* ===== CHECKLIST ===== */
function addCheck(){
  if(!checkText.value) return;
  project.existingStatus.checklist.push({text:checkText.value,checked:false});
  checkText.value="";
  save(renderChecklist);
}
function toggleCheck(i){
  project.existingStatus.checklist[i].checked=!project.existingStatus.checklist[i].checked;
  save();
}
function renderChecklist(){
  checkList.innerHTML="";
  project.existingStatus.checklist.forEach((c,i)=>{
    checkList.innerHTML+=`
      <div class="checkItem">
        <label>
          <input type="checkbox" ${c.checked?"checked":""}
           onchange="toggleCheck(${i})"> ${c.text}
        </label>
      </div>`;
  });
}

/* ===== SAVE ===== */
function save(cb){
  localStorage.setItem(key,JSON.stringify(project));
  if(cb) cb();
}

/* ===== PREVIEW ===== */
function togglePreview(){
  preview=!preview;
  page.classList.toggle("preview",preview);
  previewNote.style.display=preview?"block":"none";
}

/* init */
renderWorks();
renderChecklist();
</script>

</body>
</html>
