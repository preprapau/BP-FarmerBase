<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Existing Status | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2,h3{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

/* form */
label{font-weight:600}
input,textarea{
  width:100%;
  padding:8px;
  margin-top:6px;
  margin-bottom:12px;
  font-family:inherit;
}
textarea{min-height:90px}

button{
  background:#2e7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:8px 16px;
  cursor:pointer;
}
.del{
  background:#c62828;
}

/* cards */
.card{
  background:#f9fdf9;
  border:1px solid #dceddc;
  border-radius:8px;
  padding:12px;
  margin-top:12px;
}
.card img{
  max-width:100%;
  border-radius:6px;
  margin-top:8px;
}

/* checklist */
.checklist{
  background:#f6f6f6;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
}
.checklist label{
  font-weight:normal;
  display:block;
  margin:4px 0;
}

/* nav */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}
</style>
</head>

<body>

<div class="wrap">

<h2>ЁЯУВ Existing Status (рд╣рд╛рд▓рд╕рдореНрдо рднрдПрдХрд╛ рдХрд╛рд░реНрдпрд╣рд░реВ)</h2>
<p class="small">
рд╕рдВрд╕реНрдерд╛рд▓реЗ/рдлрд░реНрдорд▓реЗ рдпрд╕рдЕрдШрд┐ рдЧрд░реЗрдХрд╛ рдХрд╛рдорд╣рд░реВ, рдкреВрд░реНрд╡рд╛рдзрд╛рд░, рдЕрдиреБрднрд╡ рд░ рдЕрд╡рд╕реНрдерд╛рд▓рд╛рдИ рдпрд╣рд╛рдБ рдкреНрд░рд╕реНрддреБрдд рдЧрд░реНрдиреБрд╣реЛрд╕реНред
</p>

<!-- ================= EXISTING WORK SECTION ================= -->
<h3>ЁЯФ╣ рдпрд╕рдЕрдШрд┐ рдЧрд░рд┐рдПрдХрд╛ рдХрд╛рд░реНрдпрд╣рд░реВ</h3>

<label>рд╡рд┐рд╖рдп (Topic)</label>
<input id="workTopic" placeholder="рдЬрд╕реНрддреИ: рдХреГрд╖рд┐ рддрд╛рд▓рд┐рдо, рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг">

<label>рд╡рд┐рд╡рд░рдг (Content)</label>
<textarea id="workContent" placeholder="рдХреЗ рдХрд╛рдо рдЧрд░рд┐рдпреЛ, рдХрд╣рд┐рд▓реЗ, рдХрд╕рд░реА, рдХрддрд┐ рдЬрдирд╛рд▓реЗ рд▓рд╛рдн рд▓рд┐рдП..."></textarea>

<label>Photo URL (optional)</label>
<input id="workPhoto" placeholder="https://example.com/photo.jpg">

<button onclick="addWork()">тЮХ Add</button>

<div id="workList"></div>

<hr>

<!-- ================= CHECKLIST SECTION ================= -->
<h3>тЬЕ рдкреВрд░реНрд╡рд╛рдзрд╛рд░ / рдЕрд╡рд╕реНрдерд╛ Checklist</h3>
<p class="small">
рд▓рд╛рдЧреВ рд╣реБрдиреЗ рд╕рдмреИ рд╡рд┐рдХрд▓реНрдк рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН (рдПрдХрднрдиреНрджрд╛ рдмрдвреА рд╣реБрди рд╕рдХреНрдЫ)ред
</p>

<div class="checklist">
  <label><input type="checkbox" value="road"> рдлрд░реНрдорд╕рдореНрдо рдореЛрдЯрд░рдмрд╛рдЯреЛ рдЫ</label>
  <label><input type="checkbox" value="trail"> рдлрд░реНрдорд╕рдореНрдо рдкреИрджрд▓ рдмрд╛рдЯреЛ (рдЯреНрд░реЗрдХ) рдЫ</label>
  <label><input type="checkbox" value="electricity"> рдмрд┐рдЬреБрд▓реА рд╕реБрд╡рд┐рдзрд╛ рдЫ</label>
  <label><input type="checkbox" value="water"> рдЦрд╛рдиреЗрдкрд╛рдиреА / рд╕рд┐рдБрдЪрд╛рдЗ рд╕реБрд╡рд┐рдзрд╛ рдЫ</label>
  <label><input type="checkbox" value="internet"> рдЗрдиреНрдЯрд░рдиреЗрдЯ рд╕реБрд╡рд┐рдзрд╛ рдЫ</label>
  <label><input type="checkbox" value="market"> рдирдЬрд┐рдХреИ рдмрдЬрд╛рд░ рдкрд╣реБрдБрдЪ рдЫ</label>
  <label><input type="checkbox" value="training"> рдпрд╕рдЕрдШрд┐ рддрд╛рд▓рд┐рдо рдкреНрд░рд╛рдкреНрдд</label>
</div>

<!-- ================= NAV ================= -->
<div class="nav">
  <button onclick="location.href='short-info.html'">тмЕ Previous</button>
  <button onclick="location.href='business-detail.html'">Next тЮб</button>
</div>

</div>

<script>
/* ================= EXISTING STATUS тАУ AUTOSAVE ================= */

const key = localStorage.getItem("activeProject");
if(!key){
  alert("рдкрд╣рд┐рд▓реЗ Project рд╕реБрд░реБ рдЧрд░реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}

const project = JSON.parse(localStorage.getItem(key)) || {};

// init
project.existingStatus = project.existingStatus || {
  works: [],
  checklist: []
};

/* ---------- EXISTING WORK ---------- */
function addWork(){
  if(!workTopic.value || !workContent.value){
    alert("рд╡рд┐рд╖рдп рд░ рд╡рд┐рд╡рд░рдг рдЕрдирд┐рд╡рд╛рд░реНрдп рдЫ");
    return;
  }
  project.existingStatus.works.push({
    topic: workTopic.value,
    content: workContent.value,
    photo: workPhoto.value
  });
  workTopic.value="";
  workContent.value="";
  workPhoto.value="";
  save();
}

function deleteWork(i){
  if(confirm("рдпреЛ рд╡рд┐рд╡рд░рдг рд╣рдЯрд╛рдЙрдиреЗ ?")){
    project.existingStatus.works.splice(i,1);
    save();
  }
}

function renderWorks(){
  workList.innerHTML="";
  if(project.existingStatus.works.length===0){
    workList.innerHTML="<i>рдЕрд╣рд┐рд▓реЗрд╕рдореНрдо рдХреБрдиреИ рд╡рд┐рд╡рд░рдг рдердкрд┐рдПрдХреЛ рдЫреИрди</i>";
    return;
  }
  project.existingStatus.works.forEach((w,i)=>{
    workList.innerHTML+=`
      <div class="card">
        <h4>${i+1}. ${w.topic}</h4>
        <p>${w.content.replace(/\\n/g,"<br>")}</p>
        ${w.photo ? `<img src="${w.photo}" alt="photo">` : ""}
        <br>
        <button class="del" onclick="deleteWork(${i})">ЁЯЧС Delete</button>
      </div>
    `;
  });
}

/* ---------- CHECKLIST ---------- */
document.querySelectorAll('.checklist input').forEach(cb=>{
  cb.checked = project.existingStatus.checklist.includes(cb.value);
  cb.onchange = ()=>{
    if(cb.checked){
      if(!project.existingStatus.checklist.includes(cb.value))
        project.existingStatus.checklist.push(cb.value);
    }else{
      project.existingStatus.checklist =
        project.existingStatus.checklist.filter(v=>v!==cb.value);
    }
    save(false);
  };
});

/* ---------- SAVE ---------- */
function save(refresh=true){
  localStorage.setItem(key, JSON.stringify(project));
  if(refresh) renderWorks();
}

renderWorks();
</script>

</body>
</html>
