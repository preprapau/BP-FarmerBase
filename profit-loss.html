<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit ‚Äì Loss | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
header a,footer a{
  text-decoration:none;
  font-weight:700;
  color:#2e7d32
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px
}
h2,h3{color:#2e7d32;margin:8px 0}
.small{font-size:13px;color:#555}

.box{
  background:#fff;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px
}

table{
  width:100%;
  border-collapse:collapse
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px
}
th{background:#eef5ee}
.right{text-align:right}

.highlight{
  background:#e8f5e9;
  font-weight:700
}

.resultBox{
  font-size:20px;
  text-align:center;
  padding:18px;
  border-radius:14px;
  margin-top:10px
}
.profit{
  background:#e8f5e9;
  color:#2e7d32;
  font-weight:700
}
.loss{
  background:#fdecea;
  color:#c62828;
  font-weight:700
}

.badge{
  display:inline-block;
  padding:4px 12px;
  border-radius:20px;
  font-size:13px;
  margin-left:6px
}
.badge-profit{background:#2e7d32;color:#fff}
.badge-loss{background:#c62828;color:#fff}

.footerNav{
  display:flex;
  justify-content:space-between;
  width:100%
}

@media print{
  header, footer, .badge{display:none}
  body{background:#fff}
}
</style>
</head>

<body>

<!-- TOP NAV -->
<header>
  <a href="income-demo.html">‚¨ÖÔ∏è Income</a>
  <strong>üìä Profit ‚Äì Loss</strong>
  <a href="income-allocation.html">‚û°Ô∏è Income Allocation</a>
</header>

<div class="container">

<h2>‡§®‡§æ‡§´‡§æ ‚Äì ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§® ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h2>
<p class="small">
‚ÑπÔ∏è Income ‡§∞ Expense ‡§°‡§æ‡§ü‡§æ‡§ï‡•ã ‡§Ü‡§ß‡§æ‡§∞‡§Æ‡§æ
‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™‡§Æ‡§æ ‡§ó‡§£‡§®‡§æ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§®‡§§‡§ø‡§ú‡§æ‡•§
</p>

<!-- INCOME SUMMARY -->
<div class="box">
<h3>üí∞ ‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</h3>
<table>
<tr>
  <th>‡§µ‡§ø‡§µ‡§∞‡§£</th>
  <th class="right">‡§∞‡§ï‡§Æ (‡§∞‡•Å)</th>
</tr>
<tbody id="incomeRows"></tbody>
<tr class="highlight">
  <th>‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</th>
  <th class="right" id="totalIncome">0</th>
</tr>
</table>
</div>

<!-- EXPENSE SUMMARY -->
<div class="box">
<h3>üí∏ ‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</h3>
<table>
<tr>
  <th>‡§µ‡§ø‡§µ‡§∞‡§£</th>
  <th class="right">‡§∞‡§ï‡§Æ (‡§∞‡•Å)</th>
</tr>
<tbody id="expenseRows"></tbody>
<tr class="highlight">
  <th>‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§ñ‡§∞‡•ç‡§ö</th>
  <th class="right" id="totalExpense">0</th>
</tr>
</table>
</div>

<!-- RESULT -->
<div class="box">
<h3>üìà ‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§®‡§§‡§ø‡§ú‡§æ</h3>
<table>
<tr>
  <td>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</td>
  <td class="right" id="pIncome">0</td>
</tr>
<tr>
  <td>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</td>
  <td class="right" id="pExpense">0</td>
</tr>
<tr class="highlight">
  <th>‡§∂‡•Å‡§¶‡•ç‡§ß ‡§®‡§æ‡§´‡§æ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®</th>
  <th class="right" id="netResult">0</th>
</tr>
</table>

<div id="resultBox" class="resultBox"></div>
</div>

</div>

<!-- FOOTER -->
<footer>
  <div class="footerNav">
    <a href="income-demo.html">‚¨ÖÔ∏è Income</a>
    <span class="small">
      FarmerBase BP Engine ‚Äì Profit Analysis
    </span>
    <a href="income-allocation.html">‚û°Ô∏è Income Allocation</a>
  </div>
</footer>

<script>
/* ===============================
   PROFIT ‚Äì LOSS (FINAL)
   =============================== */

const key = localStorage.getItem("activeProject");
if(!key){ alert("Active ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§≠‡•á‡§ü‡§ø‡§è‡§®"); }

const project = JSON.parse(localStorage.getItem(key)) || {};

// -------- INCOME --------
const incomes = project.income || [];
let incomeTotal = 0;

incomes.forEach(i=>{
  const amt = (i.sellingRate||0) * (i.qty||0);
  incomeTotal += amt;

  incomeRows.innerHTML += `
  <tr>
    <td>${i.product || "Income"}</td>
    <td class="right">${amt.toLocaleString()}</td>
  </tr>`;
});

totalIncome.innerText = incomeTotal.toLocaleString();
pIncome.innerText = incomeTotal.toLocaleString();

// -------- EXPENSE --------
const expenses = project.expenses || [];
let expenseTotal = 0;

expenses.forEach(e=>{
  expenseTotal += e.amount||0;

  expenseRows.innerHTML += `
  <tr>
    <td>${e.head || "Expense"}</td>
    <td class="right">${(e.amount||0).toLocaleString()}</td>
  </tr>`;
});

totalExpense.innerText = expenseTotal.toLocaleString();
pExpense.innerText = expenseTotal.toLocaleString();

// -------- NET RESULT --------
const net = incomeTotal - expenseTotal;
netResult.innerText = net.toLocaleString();

const box = document.getElementById("resultBox");
if(net >= 0){
  box.className="resultBox profit";
  box.innerHTML = `
    üü¢ ‡§∂‡•Å‡§¶‡•ç‡§ß ‡§®‡§æ‡§´‡§æ<br>
    ‡§∞‡•Å ${net.toLocaleString()}
    <span class="badge badge-profit">Profit</span>
  `;
}else{
  box.className="resultBox loss";
  box.innerHTML = `
    üî¥ ‡§∂‡•Å‡§¶‡•ç‡§ß ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®<br>
    ‡§∞‡•Å ${Math.abs(net).toLocaleString()}
    <span class="badge badge-loss">Loss</span>
  `;
}
</script>

</body>
</html>
