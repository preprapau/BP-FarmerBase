<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Letterhead тАУ рдирд┐рд╡реЗрджрди</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  font-family:"Noto Sans Devanagari",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.page{
  max-width:900px;
  margin:0 auto;
  background:#fff;
  padding:40px 50px;
  min-height:100vh;
  position:relative;
}

/* Header */
.header{text-align:center}
.header h1{margin:0;font-size:24px}
.header p{margin:4px 0;font-size:14px}
.hr{margin:12px 0 20px;border-bottom:2px solid #000}

/* Meta */
.meta{
  display:flex;justify-content:space-between;gap:20px;
  font-size:14px;margin-bottom:18px
}
.to{max-width:60%}

/* Body */
.body{font-size:15px;line-height:1.9}
.body p{margin:8px 0}

/* Attachments */
h4{margin:22px 0 8px}
ol{line-height:1.8}

/* Signature */
.signature{margin-top:34px;text-align:right}
.signature img{max-height:80px;display:none}

/* Footer */
.footer{
  position:absolute;left:0;right:0;bottom:24px;
  text-align:center;font-size:13px;color:#444
}

/* ===== FINAL PRINT MODE (LOCKED) ===== */
@media print{
  body{background:#fff!important}
  .no-print,button,input,select,textarea{display:none!important}
  a[href]:after{content:""!important}
  @page{size:A4;margin:20mm}
}
</style>
</head>

<body>

<div class="page">

  <!-- HEADER -->
  <div class="header">
    <h1 id="orgName">рд╕рдВрд╕реНрдерд╛рдХреЛ рдирд╛рдо</h1>
    <p id="orgAddress">рдареЗрдЧрд╛рдирд╛</p>
    <p>рджрд░реНрддрд╛ рдирдВ: <span id="regNo">XXXX</span> | рдкрд╛рди рдирдВ: <span id="panNo">XXXXX</span></p>
  </div>

  <div class="hr"></div>

  <!-- META -->
  <div class="meta">
    <div class="to">
      <strong>рд╢реНрд░реА ..................................</strong><br>
      <span id="receiverOffice">Self Office / рдХрд╛рд░реНрдпрд╛рд▓рдпрдХреЛ рдирд╛рдо</span><br>
      <span id="receiverAddress">рдареЗрдЧрд╛рдирд╛</span>
    </div>
    <div>
      рдорд┐рддрд┐: <span id="nepDate"></span>
    </div>
  </div>

  <!-- BODY -->
  <div class="body">
    <p><strong>рд╡рд┐рд╖рдп:</strong> рд╡реНрдпрд╡рд╕рд╛рдп рдкреНрд░рд╕реНрддрд╛рд╡ рд╕рдореНрдмрдиреНрдзрдорд╛ ред</p>
    <p>рдорд╣реЛрджрдп,</p>

    <p>
      рдпрд╕ рд╕рдВрд╕реНрдерд╛рдорд╛рд░реНрдлрдд рдкреНрд░рд╕реНрддреБрдд рдЧрд░рд┐рдПрдХреЛ рдмрдЩреНрдЧреБрд░ рдкрд╛рд▓рди рд╡реНрдпрд╡рд╕рд╛рдп рд╕рдореНрдмрдиреНрдзреА
      рдкреНрд░рд╕реНрддрд╛рд╡рд▓рд╛рдИ рдЕрдзреНрдпрдпрди рдЧрд░реА рдЖрд╡рд╢реНрдпрдХ рд╕рд╣рдпреЛрдЧ / рд╕рд╣рдЬреАрдХрд░рдг рдЧрд░рд┐рджрд┐рдиреБрд╣реБрди
      рд╡рд┐рдирдореНрд░ рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫреБред рдпрд╕ рдкреНрд░рд╕реНрддрд╛рд╡рдорд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛рдХреЛ рдЙрджреНрджреЗрд╢реНрдп,
      рдЖрд░реНрдерд┐рдХ рдЕрд╡рд╕реНрдерд╛, рд╕рдореНрднрд╛рд╡реНрдпрддрд╛ рддрдерд╛ рдХрд╛рд░реНрдпрдпреЛрдЬрдирд╛ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░рд┐рдПрдХреЛ рдЫред
    </p>

    <p>
      рддрд╕рд░реНрде, рдпрд╕ рд╡реНрдпрд╡рд╕рд╛рдп рдкреНрд░рд╕реНрддрд╛рд╡рд▓рд╛рдИ рд╕реНрд╡реАрдХреГрддрд┐ рдкреНрд░рджрд╛рди рдЧрд░реА рдЖрд╡рд╢реНрдпрдХ
      рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдЧрд╛рдбрд┐ рдмрдврд╛рдЗрджрд┐рдиреБрд╣реБрди рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫреБред
    </p>

    <!-- PROPOSAL LINK (screen only) -->
    <p class="no-print">
      ЁЯУД <a id="proposalLink" href="#" target="_blank">рдкреВрд░реНрдг рд╡реНрдпрд╡рд╕рд╛рдп рдкреНрд░рд╕реНрддрд╛рд╡ рд╣реЗрд░реНрдиреБрд╣реЛрд╕реН</a>
    </p>

    <!-- ATTACHMENTS -->
    <hr>
    <h4>рдирд┐рд╡реЗрджрдирдХрд╛ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдХрд╛рдЧрдЬрдкрддреНрд░рд╣рд░реВ:</h4>
    <ol id="attachmentList"></ol>

    <div class="no-print" style="margin-top:10px">
      <input type="text" id="attachInput" placeholder="рдХрд╛рдЧрдЬрдкрддреНрд░рдХреЛ рдирд╛рдо рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН"
             style="width:70%;padding:6px">
      <button onclick="addAttachment()">Add</button>
    </div>
  </div>

  <!-- SIGNATORY TOGGLE (screen only) -->
  <div class="no-print" style="margin:14px 0">
    <label>
      <input type="radio" name="signMode" value="owner" checked onchange="setSignatory('owner')">
      рдирд┐рд╡реЗрджрдХ / Proprietor
    </label>
    &nbsp;&nbsp;
    <label>
      <input type="radio" name="signMode" value="auth" onchange="setSignatory('auth')">
      Authorized Signatory
    </label>
  </div>

  <!-- SIGNATURE -->
  <div class="signature">
    <p>рднрд╡рджреАрдп,</p>

    <img id="signImg"><br>

    <input type="file" accept="image/*" class="no-print" onchange="loadSignature(event)">

    <p>
      <span id="sigName">.................................</span><br>
      <span id="sigPost">рдирд┐рд╡реЗрджрдХ / Proprietor</span><br>
      <span id="sigOrg">рд╕рдВрд╕реНрдерд╛рдХреЛ рдирд╛рдо</span>
    </p>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    рд╕рдореНрдкрд░реНрдХ рдирдВ: <span id="contact">98XXXXXXXX</span> |
    рдИрдореЗрд▓: <span id="email">example@email.com</span>
  </div>

</div>

<script>
/* ===== PROJECT LOAD ===== */
let key = localStorage.getItem("activeProject");
let project = key ? JSON.parse(localStorage.getItem(key)) : {};

/* ===== AUTO PROPOSAL LINK ===== */
document.getElementById("proposalLink").href =
  location.href.replace("letterhead.html","proposal.html");

/* ===== NEPALI DATE (simple) ===== */
function getNepaliDate(){
  const d=new Date();
  let y=d.getFullYear()+56, m=d.getMonth()+9, day=d.getDate();
  if(m>12){m-=12;y+=1}
  return `${y}/${String(m).padStart(2,"0")}/${String(day).padStart(2,"0")}`;
}
document.getElementById("nepDate").innerText = getNepaliDate();

/* ===== ATTACHMENTS ===== */
if(!project.attachments) project.attachments=[];
function renderAttachments(){
  const list=document.getElementById("attachmentList");
  list.innerHTML="";
  project.attachments.forEach((a,i)=>{
    const li=document.createElement("li");
    li.innerHTML = `${a}
      <span class="no-print" style="color:red;cursor:pointer;margin-left:8px"
            onclick="removeAttachment(${i})">тЬЦ</span>`;
    list.appendChild(li);
  });
}
function addAttachment(){
  const inp=document.getElementById("attachInput");
  const val=inp.value.trim(); if(!val) return;
  project.attachments.push(val);
  localStorage.setItem(key, JSON.stringify(project));
  inp.value=""; renderAttachments();
}
function removeAttachment(i){
  project.attachments.splice(i,1);
  localStorage.setItem(key, JSON.stringify(project));
  renderAttachments();
}
renderAttachments();

/* ===== AUTHORIZED SIGNATORY TOGGLE ===== */
const SIGN_KEY="LETTER_SIGNATORY_MODE";
const signatoryData={
  owner:{name:".................................",post:"рдирд┐рд╡реЗрджрдХ / Proprietor",org:"рд╕рдВрд╕реНрдерд╛рдХреЛ рдирд╛рдо",signKey:"SIGN_OWNER"},
  auth:{name:".................................",post:"Authorized Signatory",org:"рд╕рдВрд╕реНрдерд╛рдХреЛ рдирд╛рдо",signKey:"SIGN_AUTH"}
};
function setSignatory(mode){
  localStorage.setItem(SIGN_KEY,mode);
  applySignatory(mode);
}
function applySignatory(mode){
  const d=signatoryData[mode]||signatoryData.owner;
  sigName.innerText=d.name; sigPost.innerText=d.post; sigOrg.innerText=d.org;
  const saved=localStorage.getItem(d.signKey);
  if(saved){signImg.src=saved;signImg.style.display="block"}else{signImg.style.display="none"}
  document.querySelectorAll('input[name="signMode"]').forEach(r=>r.checked=(r.value===mode));
}
function loadSignature(e){
  const file=e.target.files[0]; if(!file) return;
  const mode=localStorage.getItem(SIGN_KEY)||"owner";
  const keyS=signatoryData[mode].signKey;
  const r=new FileReader();
  r.onload=()=>{signImg.src=r.result;signImg.style.display="block";localStorage.setItem(keyS,r.result)};
  r.readAsDataURL(file);
}
applySignatory(localStorage.getItem(SIGN_KEY)||"owner");
</script>

</body>
</html>

