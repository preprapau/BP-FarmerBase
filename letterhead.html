<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>औपचारिक निवेदन पत्र</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0;
}
.page{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:40px;
}
.header{
  text-align:center;
  border-bottom:2px solid #000;
  padding-bottom:10px;
  margin-bottom:25px;
}
.header h2{margin:0}
.small{font-size:14px;color:#333}

.row{margin:12px 0}
label{font-weight:600}
input,textarea{
  width:100%;
  padding:8px;
  margin-top:5px;
  font-family:inherit;
  font-size:15px;
}
textarea{min-height:140px}

.flex{
  display:flex;
  justify-content:space-between;
  gap:20px;
  margin-top:15px;
}

.attach-list li{margin:4px 0}

button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}
.del{background:#c62828}

/* ================= PRINT MODE ================= */
@media print{
  body{background:#fff}
  button{display:none}
  input,textarea{
    border:none;
    padding:0;
  }
  textarea{
    resize:none;
  }
  label{display:none}
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="page">

<!-- ===== HEADER ===== -->
<div class="header">
  <h2 id="orgName">संस्थाको नाम</h2>
  <div class="small" id="orgAddress">ठेगाना</div>
  <div class="small">
    दर्ता नं: <span id="regNo">—</span> |
    PAN: <span id="panNo">—</span> |
    सम्पर्क: <span id="contact">—</span>
  </div>
</div>

<!-- ===== META ===== -->
<div class="flex">
  <div style="flex:1">
    <label>प्रति :</label>
    <input id="toOffice" placeholder="कार्यालय / निकायको नाम">
  </div>
  <div style="width:200px">
    <label>मिति :</label>
    <input id="letterDate">
  </div>
</div>

<div class="row">
  <label>विषय :</label>
  <input id="subject" placeholder="निवेदनको विषय">
</div>

<div class="row">
  <label>निवेदनको व्यहोरा :</label>
  <textarea id="description" placeholder="यहाँ निवेदनको सम्पूर्ण व्यहोरा लेख्नुहोस्…"></textarea>
</div>

<!-- ===== ATTACHMENTS ===== -->
<div class="row">
  <label>संलग्न कागजातहरू :</label>
  <div style="display:flex;gap:6px">
    <input id="attachInput" placeholder="कागजातको नाम">
    <button onclick="addAttach()">+ Add</button>
  </div>
  <ul class="attach-list" id="attachList"></ul>
</div>

<!-- ===== SIGN ===== -->
<div style="margin-top:45px">
  <div>भवदीय,</div>
  <br>
  <div><b id="signName">नाम</b></div>
  <div class="small">प्रोप्राइटर / आधिकारिक हस्ताक्षरकर्ता</div>
  <div class="small" id="signOrg">संस्था</div>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let p = key ? JSON.parse(localStorage.getItem(key)) : {};
let s = p.shortInfo || {};

/* ===== AUTO HEADER ===== */
orgName.innerText = s.bp_org || "संस्थाको नाम";
orgAddress.innerText = s.bp_location || "ठेगाना";
regNo.innerText = s.reg_no || "—";
panNo.innerText = s.pan_no || "—";
contact.innerText = s.bp_phone || "—";

/* ===== SIGN ===== */
signName.innerText = s.bp_owner || "नाम";
signOrg.innerText = s.bp_org || "";

/* ===== DATE ===== */
letterDate.value = new Date().toLocaleDateString("ne-NP");

/* ===== ATTACHMENTS ===== */
let attachments = [];

function addAttach(){
  if(!attachInput.value) return;
  attachments.push(attachInput.value);
  attachInput.value="";
  renderAttach();
}
function delAttach(i){
  attachments.splice(i,1);
  renderAttach();
}
function renderAttach(){
  attachList.innerHTML="";
  attachments.forEach((a,i)=>{
    attachList.innerHTML+=`
      <li>${i+1}. ${a}
        <button class="del" onclick="delAttach(${i})">✖</button>
      </li>`;
  });
}
</script>

</body>
</html>
