<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Growth Assumptions | BP-FarmerBase</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2,h3{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

/* top bar */
.topBar{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  margin-bottom:15px;
}
.topBar .left{text-align:left}
.topBar .center{text-align:center}
.topBar .right{text-align:right}

/* inputs */
label{font-weight:600}
input,select{
  width:100%;
  padding:6px;
  margin-top:6px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
th{background:#eef5ee}

button{
  border:none;
  border-radius:6px;
  padding:8px 16px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}
.toggleBtn{background:#0277bd}

.hidden{display:none}
</style>
</head>

<body>

<div class="wrap">

<!-- ===== TOP BAR ===== -->
<div class="topBar">
  <div class="left">
    <button onclick="location.href='income-demo.html'">‚¨Ö Income</button>
  </div>
  <div class="center">
    <strong>üìà Growth Assumptions</strong>
  </div>
  <div class="right">
    <button onclick="location.href='projection-5year.html'">Next ‚û°</button>
  </div>
</div>

<h2>üìà ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® (Growth Assumptions)</h2>
<p class="small">
Year-1 ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§Ü‡§ß‡§æ‡§∞ ‡§µ‡§∞‡•ç‡§∑ ‡§π‡•ã‡•§  
Year-2 ‡§¶‡•á‡§ñ‡§ø ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§∞ ‡§ñ‡§∞‡•ç‡§ö‡§Æ‡§æ ‡§π‡•Å‡§®‡•á ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§Ø‡§π‡§æ‡§Å ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§ó‡§∞‡§ø‡§®‡•ç‡§õ‡•§
</p>

<hr>

<!-- ===== MODE SELECT ===== -->
<label>‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§Æ‡•ã‡§°</label>
<select id="mode" onchange="changeMode()">
  <option value="same">‡§∏‡§¨‡•à ‡§µ‡§∞‡•ç‡§∑ ‡§è‡§â‡§ü‡•à %</option>
  <option value="yearwise">‡§π‡§∞‡•á‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§´‡§∞‡§ï %</option>
</select>

<hr>

<!-- ===== SAME MODE ===== -->
<div id="sameBox">
  <h3>üîÅ ‡§∏‡§¨‡•à ‡§µ‡§∞‡•ç‡§∑ ‡§è‡§â‡§ü‡•à ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</h3>

  <label>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</label>
  <input type="number" id="sameRev">

  <label>‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</label>
  <input type="number" id="sameExp">
</div>

<!-- ===== YEAR WISE MODE ===== -->
<div id="yearBox" class="hidden">
  <h3>üìä ‡§µ‡§∞‡•ç‡§∑ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</h3>

  <table>
    <thead>
      <tr>
        <th>‡§µ‡§∞‡•ç‡§∑</th>
        <th>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</th>
        <th>‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø %</th>
      </tr>
    </thead>
    <tbody id="yearRows"></tbody>
  </table>
</div>

<hr>

<button class="toggleBtn" onclick="save()">üíæ Save</button>

</div>

<script>
/* ===== LOAD PROJECT ===== */
const key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
const project = JSON.parse(localStorage.getItem(key));

/* ===== INIT STRUCTURE ===== */
project.growthAssumptions ??= {
  mode:"same",
  same:{ revenue:0, expense:0 },
  years:[
    {revenue:0,expense:0},
    {revenue:0,expense:0},
    {revenue:0,expense:0},
    {revenue:0,expense:0}
  ]
};

/* ===== LOAD ===== */
mode.value = project.growthAssumptions.mode || "same";
sameRev.value = project.growthAssumptions.same.revenue || 0;
sameExp.value = project.growthAssumptions.same.expense || 0;

function renderYears(){
  yearRows.innerHTML="";
  project.growthAssumptions.years.forEach((y,i)=>{
    yearRows.innerHTML+=`
      <tr>
        <td>Year ${i+2}</td>
        <td><input type="number" value="${y.revenue}"
          onchange="updateYear(${i},'revenue',this.value)"></td>
        <td><input type="number" value="${y.expense}"
          onchange="updateYear(${i},'expense',this.value)"></td>
      </tr>`;
  });
}

renderYears();
changeMode();

/* ===== MODE SWITCH ===== */
function changeMode(){
  project.growthAssumptions.mode = mode.value;
  sameBox.classList.toggle("hidden", mode.value!=="same");
  yearBox.classList.toggle("hidden", mode.value!=="yearwise");
  save(false);
}

/* ===== UPDATE ===== */
function updateYear(i,f,v){
  project.growthAssumptions.years[i][f] = Number(v)||0;
  save(false);
}

/* ===== SAVE ===== */
function save(alertUser=true){
  project.growthAssumptions.same.revenue = Number(sameRev.value)||0;
  project.growthAssumptions.same.expense = Number(sameExp.value)||0;
  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key,JSON.stringify(project));
  if(alertUser) alert("Growth assumptions saved");
}
</script>

</body>
</html>
