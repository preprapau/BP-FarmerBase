<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Smart Dashboard | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0
}
header{
  background:#2e7d32;
  color:#fff;
  padding:18px;
  text-align:center
}
.wrap{
  max-width:420px;
  margin:20px auto;
  padding:10px
}
.card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.08)
}
h3{
  color:#2e7d32;
  margin-top:0
}
.progress{
  background:#eee;
  border-radius:10px;
  overflow:hidden;
  height:10px;
  margin:8px 0
}
.bar{
  background:#2e7d32;
  height:100%;
  width:0%
}
.stat{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin:6px 0
}
.btn{
  display:block;
  text-align:center;
  padding:14px;
  margin-top:10px;
  background:#2e7d32;
  color:#fff;
  text-decoration:none;
  border-radius:14px;
  font-size:16px
}
.btn.secondary{background:#558b2f}
.small{font-size:13px;color:#555}
.warn{color:#c62828;font-weight:600}
.ok{color:#2e7d32;font-weight:600}
</style>
</head>

<body>

<header>
  <h2>ЁЯУК Smart Dashboard</h2>
</header>

<div class="wrap">

<!-- ACTIVE PLAN -->
<div class="card" id="planCard"></div>

<!-- PROGRESS -->
<div class="card">
  <h3>ЁЯУИ рдпреЛрдЬрдирд╛ рдкреНрд░рдЧрддрд┐</h3>
  <div class="progress">
    <div class="bar" id="progressBar"></div>
  </div>
  <div id="progressText" class="small"></div>
</div>

<!-- KEY STATS -->
<div class="card">
  <h3>ЁЯТб рдореБрдЦреНрдп рддрдереНрдп</h3>
  <div class="stat">
    <span>рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</span>
    <span id="income">тАФ</span>
  </div>
  <div class="stat">
    <span>рдЦреБрдж рдирд╛рдлрд╛</span>
    <span id="profit">тАФ</span>
  </div>
  <div class="stat">
    <span>ROI</span>
    <span id="roi">тАФ</span>
  </div>
</div>

<!-- ACTIONS -->
<div class="card">
  <h3>тЪб рдЫрд┐рдЯреЛ рдХрд╛рдо</h3>
  <a href="#" id="continueBtn" class="btn">тЮбя╕П рдпреЛрдЬрдирд╛ рдЬрд╛рд░реА рд░рд╛рдЦреНрдиреБрд╣реЛрд╕реН</a>
  <a href="full-proposal-print.html" class="btn secondary">
    ЁЯУД Proposal (PDF)
  </a>
</div>

<!-- STATUS -->
<div class="card">
  <h3>ЁЯзн рдкреНрд░рдгрд╛рд▓реА рд╕рдиреНрджреЗрд╢</h3>
  <div id="statusMsg" class="small"></div>
</div>

</div>

<script>
/* =====================================================
   LOAD ACTIVE PROJECT
   ===================================================== */
const key = localStorage.getItem("activeProject");
if(!key){
  location.href="index.html";
}

const project = JSON.parse(localStorage.getItem(key)) || {};

/* =====================================================
   CHECK COMPLETION
   ===================================================== */
let steps = [
  {name:"рдЙрддреНрдкрд╛рджрди", ok: (JSON.parse(localStorage.getItem("PRODUCTION_MASTER"))||[]).length>0, link:"production-sells.html"},
  {name:"рдЦрд░реНрдЪ", ok: (project.expenses||[]).length>0, link:"operating-cost-engine.html"},
  {name:"рдЖрдореНрджрд╛рдиреА", ok: project.totalIncome>0, link:"income-demo.html"},
  {name:"рдирд╛рдлрд╛тАУрдиреЛрдХреНрд╕рд╛рди", ok: project.profitLoss && project.profitLoss.netProfit!=null, link:"profit-loss-demo.html"},
  {name:"ROI", ok: project.roi && project.roi.roiPercent!=null, link:"roi.html"}
];

let completed = steps.filter(s=>s.ok).length;
let percent = Math.round((completed/steps.length)*100);

/* =====================================================
   RENDER PLAN CARD
   ===================================================== */
planCard.innerHTML = `
<h3>ЁЯУМ Active Plan</h3>
<p><strong>${project.name||"рдирд╛рдо рдирднрдПрдХреЛ рдпреЛрдЬрдирд╛"}</strong></p>
<p class="small">Created: ${new Date(project.createdAt).toLocaleDateString()}</p>
`;

/* =====================================================
   PROGRESS
   ===================================================== */
progressBar.style.width = percent+"%";
progressText.innerText = percent+"% рдкреВрд░рд╛ рднрдПрдХреЛ рдЫ";

/* =====================================================
   KEY STATS
   ===================================================== */
income.innerText = project.totalIncome
  ? "рд░реБ "+project.totalIncome.toFixed(2)
  : "тАФ";

profit.innerText = project.profitLoss && project.profitLoss.netProfit!=null
  ? "рд░реБ "+project.profitLoss.netProfit.toFixed(2)
  : "тАФ";

roi.innerText = project.roi && project.roi.roiPercent!=null
  ? project.roi.roiPercent.toFixed(2)+" %"
  : "тАФ";

/* =====================================================
   NEXT ACTION
   ===================================================== */
let next = steps.find(s=>!s.ok);
if(next){
  continueBtn.innerText = "тЮбя╕П "+next.name+" рдкреВрд░рд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН";
  continueBtn.href = next.link;
  statusMsg.innerHTML =
    `<span class="warn">тЪая╕П ${next.name} рдЪрд░рдг рдмрд╛рдБрдХреА рдЫ</span>`;
}else{
  continueBtn.innerText = "тЬЕ рдпреЛрдЬрдирд╛ рдкреВрд░рд╛ рднрдпреЛ";
  continueBtn.href = "full-proposal-print.html";
  statusMsg.innerHTML =
    `<span class="ok">ЁЯОЙ рд╕рдмреИ рдЪрд░рдг рдкреВрд░рд╛ рднрдЗрд╕рдХреЗрдХрд╛ рдЫрдиреН</span>`;
}
</script>

</body>
</html>
