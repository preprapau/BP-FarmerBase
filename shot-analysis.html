<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Short Analysis | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2,h3{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

textarea{
  width:100%;
  min-height:150px;
  padding:10px;
  font-family:inherit;
  margin-top:8px;
}

button{
  background:#2e7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:8px 16px;
  cursor:pointer;
}
.autoBtn{
  background:#0277bd;
  margin-top:8px;
}

.box{
  background:#f9fdf9;
  border:1px solid #dceddc;
  border-radius:8px;
  padding:12px;
  margin-top:12px;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
</style>
</head>

<body>

<div class="wrap">

<h2>ЁЯза Short Analysis (рдЫреЛрдЯреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг)</h2>
<p class="small">
рдпрд╕ рднрд╛рдЧрдорд╛ рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд░реНрддрдорд╛рди рдЕрд╡рд╕реНрдерд╛, рд╕рдореНрднрд╛рд╡рдирд╛ рд░ рдирд┐рд╖реНрдХрд░реНрд╖рд▓рд╛рдИ
рдЫреЛрдЯреЛ, рд╕реНрдкрд╖реНрдЯ рд░ рдирд┐рд░реНрдгрдп-рдореИрддреНрд░реА рд╢реИрд▓реАрдорд╛ рдкреНрд░рд╕реНрддреБрдд рдЧрд░рд┐рдиреНрдЫред
</p>

<!-- AUTO INSIGHT -->
<div class="box">
<h3>ЁЯУМ Auto Insights (рд╕рд╣рдпреЛрдЧреА рдмреБрдБрджрд╛)</h3>
<ul id="autoPoints" class="small"></ul>
</div>

<!-- ANALYSIS TEXT -->
<h3>тЬНя╕П Short Analysis рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН</h3>
<textarea id="analysisText"
  placeholder="рдпрд╣рд╛рдБ 3тАУ5 рд╡рд╛рдХреНрдпрдорд╛ рдЫреЛрдЯреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН..."></textarea>

<button class="autoBtn" onclick="generateAuto()">
тЪб Auto-Generate Draft
</button>

<!-- NAV -->
<div class="nav">
  <button onclick="location.href='existing-status.html'">тмЕ Previous</button>
  <button onclick="location.href='business-detail.html'">Next тЮб</button>
</div>

</div>

<script>
/* ================= SHORT ANALYSIS тАУ AUTOSAVE ================= */

const key = localStorage.getItem("activeProject");
if(!key){
  alert("рдкрд╣рд┐рд▓реЗ Project рд╕реБрд░реБ рдЧрд░реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}

const project = JSON.parse(localStorage.getItem(key)) || {};
project.shortAnalysis = project.shortAnalysis || "";

// load saved
analysisText.value = project.shortAnalysis;

// autosave
analysisText.oninput = ()=>{
  project.shortAnalysis = analysisText.value;
  localStorage.setItem(key, JSON.stringify(project));
};

// -------- AUTO INSIGHTS --------
function loadInsights(){
  autoPoints.innerHTML="";

  const works = project.existingStatus?.works || [];
  const checklist = project.existingStatus?.checklist || [];

  if(works.length>0){
    autoPoints.innerHTML+=`<li>рд╕рдВрд╕реНрдерд╛рд▓реЗ рдпрд╕рдЕрдШрд┐ ${works.length} рд╡рдЯрд╛ рдХрд╛рд░реНрдп/рдЕрдиреБрднрд╡ рд╣рд╛рд╕рд┐рд▓ рдЧрд░рд┐рд╕рдХреЗрдХреЛ рдЫред</li>`;
  }

  const checked = checklist.filter(c=>c.checked);
  if(checked.length>0){
    autoPoints.innerHTML+=`<li>${checked.length} рд╡рдЯрд╛ рдЖрдзрд╛рд░рднреВрдд рд╕реБрд╡рд┐рдзрд╛/рдЕрд╡рд╕реНрдерд╛ рдЙрдкрд▓рдмреНрдз рдЫрдиреНред</li>`;
  }

  if(project.shortInfo?.location){
    autoPoints.innerHTML+=`<li>рд╡реНрдпрд╡рд╕рд╛рдп ${project.shortInfo.location} рдХреНрд╖реЗрддреНрд░рдорд╛ рдЕрд╡рд╕реНрдерд┐рдд рдЫред</li>`;
  }

  if(autoPoints.innerHTML===""){
    autoPoints.innerHTML="<li>рдердк рд╡рд┐рд╡рд░рдг рднрд░реЗрдкрдЫрд┐ auto insights рджреЗрдЦрд┐рдиреНрдЫред</li>";
  }
}

// -------- AUTO GENERATE --------
function generateAuto(){
  let text = "";

  const works = project.existingStatus?.works || [];
  const checklist = project.existingStatus?.checklist || [];
  const checked = checklist.filter(c=>c.checked);

  text += "рд╡реНрдпрд╡рд╕рд╛рдпрд▓реЗ рд╣рд╛рд▓рд╕рдореНрдо рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд╕реНрддрд░рдХрд╛ рдЧрддрд┐рд╡рд┐рдзрд┐рд╣рд░реВ рд╕рдЮреНрдЪрд╛рд▓рди рдЧрд░рд┐рд╕рдХреЗрдХреЛ рдЫред ";

  if(works.length>0){
    text += `рдпрд╕рдЕрдШрд┐ ${works.length} рдкреНрд░рдХрд╛рд░рдХрд╛ рдХрд╛рд░реНрдп/рдЕрдиреБрднрд╡ рд╣рд╛рд╕рд┐рд▓ рдЧрд░рд┐рдПрдХрд╛ рдЫрдиреНред `;
  }

  if(checked.length>0){
    text += `рдЖрдзрд╛рд░рднреВрдд рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рддрдерд╛ рд╕реБрд╡рд┐рдзрд╛ ${checked.length} рд╢реАрд░реНрд╖рдХрдорд╛ рдЙрдкрд▓рдмреНрдз рдЫрдиреНред `;
  }

  text += "рдпрд╕рд▓реЗ рд╡реНрдпрд╡рд╕рд╛рдп рд╡рд┐рд╕реНрддрд╛рд░рдХреЛ рд╕рдореНрднрд╛рд╡рдирд╛ рджреЗрдЦрд╛рдЙрдБрдЫред ";

  text += "рддрд░ рдердк рд▓рдЧрд╛рдиреА, рдкреНрд░рд╡рд┐рдзрд┐ рд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реБрдзрд╛рд░ рдЖрд╡рд╢реНрдпрдХ рджреЗрдЦрд┐рдиреНрдЫред ";

  text += "рдЙрдЪрд┐рдд рдпреЛрдЬрдирд╛ рд░ рд╕реНрд░реЛрдд рдкрд░рд┐рдЪрд╛рд▓рдирдХрд╛ рд╕рд╛рде рд╡реНрдпрд╡рд╕рд╛рдп рджрд┐рдЧреЛ рд░ рдирд╛рдлрд╛рдореБрдЦреА рдмрдиреНрди рд╕рдХреНрдЫред";

  analysisText.value = text;
  project.shortAnalysis = text;
  localStorage.setItem(key, JSON.stringify(project));
}

loadInsights();
</script>

</body>
</html>
