<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Create Letters | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Nirmala UI",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:1000px;
  margin:20px auto;
  background:#fff;
  padding:22px;
  border-radius:12px;
}
h2{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

/* form */
label{font-weight:600}
input,select,textarea{
  width:100%;
  padding:8px;
  margin:6px 0 12px;
}
textarea{min-height:180px}

/* buttons */
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}
button.gray{background:#455a64}
button.red{background:#c62828}

/* layout */
.grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:20px;
}

/* letter list */
.list{
  border-left:1px solid #ddd;
  padding-left:15px;
}
.item{
  padding:8px;
  border:1px solid #ccc;
  border-radius:6px;
  margin-bottom:8px;
  cursor:pointer;
}
.item.active{
  background:#e8f5e9;
  border-color:#2e7d32;
}
.actions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
</style>
</head>

<body>

<div class="wrap">
<h2>тЬЙя╕П Letter Generator</h2>
<p class="small">
рдпрд╣рд╛рдБрдмрд╛рдЯ рддрдкрд╛рдИрдВрд▓реЗ рд╡рд┐рднрд┐рдиреНрди рдХрд┐рд╕рд┐рдордХрд╛ рдкрддреНрд░рд╣рд░реВ рддрдпрд╛рд░ рдЧрд░реНрди, рд╕рдЪреНрдпрд╛рдЙрди рд░ рдкреНрд░рд┐рдиреНрдЯ рдЧрд░реНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫред
</p>

<div class="grid">

<!-- ================= LETTER EDITOR ================= -->
<div>
  <label>рдкрддреНрд░рдХреЛ рд╢реАрд░реНрд╖рдХ</label>
  <input id="title" placeholder="рдЬрд╕реНрддреИ: рдмреИрдВрдХ рдирд┐рд╡реЗрджрди рдкрддреНрд░">

  <label>рдкрддреНрд░рдХреЛ рдкреНрд░рдХрд╛рд░</label>
  <select id="type">
    <option>рдирд┐рд╡реЗрджрди</option>
    <option>рд╕рд┐рдлрд╛рд░рд┐рд╕</option>
    <option>рдмреИрдВрдХ рдкрддреНрд░</option>
    <option>рдЕрдиреБрджрд╛рди рдЖрд╡реЗрджрди</option>
    <option>рд╕рдореНрдЭреМрддрд╛ рдкреНрд░рд╕реНрддрд╛рд╡</option>
    <option>рдЕрдиреНрдп</option>
  </select>

  <label>рдкрддреНрд░рдХреЛ рд╕рд╛рдордЧреНрд░реА</label>
  <textarea id="content" placeholder="рдкрддреНрд░рдХреЛ рдореБрдЦреНрдп рд╕рд╛рдордЧреНрд░реА рдпрд╣рд╛рдБ рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН..."></textarea>

  <div class="actions">
    <button onclick="saveLetter()">ЁЯТ╛ Save</button>
    <button class="gray" onclick="newLetter()">тЮХ New</button>
    <button class="gray" onclick="printLetter()">ЁЯЦи Print</button>
    <button class="red" onclick="deleteLetter()">ЁЯЧС Delete</button>
  </div>
</div>

<!-- ================= LETTER LIST ================= -->
<div class="list">
  <h3>ЁЯУВ Saved Letters</h3>
  <div id="letterList"></div>
</div>

</div>
</div>

<script>
/* ===== STORAGE ===== */
const KEY = "SYSTEM_LETTERS";
let letters = JSON.parse(localStorage.getItem(KEY)) || [];
let activeId = null;

/* ===== RENDER LIST ===== */
function renderList(){
  letterList.innerHTML="";
  letters.forEach(l=>{
    const d=document.createElement("div");
    d.className="item"+(l.id===activeId?" active":"");
    d.innerHTML=`<b>${l.title}</b><br><span class="small">${l.type}</span>`;
    d.onclick=()=>loadLetter(l.id);
    letterList.appendChild(d);
  });
}

/* ===== LOAD LETTER ===== */
function loadLetter(id){
  const l = letters.find(x=>x.id===id);
  if(!l) return;
  activeId=id;
  title.value=l.title;
  type.value=l.type;
  content.value=l.content;
  renderList();
}

/* ===== SAVE ===== */
function saveLetter(){
  if(!title.value || !content.value){
    alert("рд╢реАрд░реНрд╖рдХ рд░ рд╕рд╛рдордЧреНрд░реА рдЕрдирд┐рд╡рд╛рд░реНрдп рдЫ");
    return;
  }
  if(activeId){
    const l = letters.find(x=>x.id===activeId);
    l.title=title.value;
    l.type=type.value;
    l.content=content.value;
  }else{
    letters.push({
      id:Date.now(),
      title:title.value,
      type:type.value,
      content:content.value
    });
    activeId=letters[letters.length-1].id;
  }
  localStorage.setItem(KEY,JSON.stringify(letters));
  renderList();
}

/* ===== NEW ===== */
function newLetter(){
  activeId=null;
  title.value="";
  type.value="рдирд┐рд╡реЗрджрди";
  content.value="";
  renderList();
}

/* ===== DELETE ===== */
function deleteLetter(){
  if(!activeId) return;
  if(!confirm("рдпреЛ рдкрддреНрд░ рд╣рдЯрд╛рдЙрдиреЗ?")) return;
  letters = letters.filter(l=>l.id!==activeId);
  activeId=null;
  localStorage.setItem(KEY,JSON.stringify(letters));
  newLetter();
}

/* ===== PRINT ===== */
function printLetter(){
  if(!content.value) return;
  const w = window.open("");
  w.document.write(`
    <html><head><title>${title.value}</title>
    <style>
    body{font-family:"Kalimati","Noto Sans Devanagari";padding:30px}
    </style></head>
    <body>
    <h2>${title.value}</h2>
    <pre>${content.value}</pre>
    </body></html>
  `);
  w.document.close();
  w.print();
}

/* INIT */
renderList();
</script>

</body>
</html>
