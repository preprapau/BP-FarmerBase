<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Expense Detail | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1000px;margin:25px auto;background:#fff;
  padding:25px;border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}

/* progress */
.progress{
  background:#e8f5e9;border:1px solid #c8e6c9;
  padding:12px;border-radius:8px;margin-bottom:15px
}
.steps span{
  padding:4px 8px;border-radius:10px;background:#eee;font-size:13px
}
.steps .done{background:#a5d6a7}
.steps .active{background:#2e7d32;color:#fff}
.bar{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:8px}
.bar span{display:block;height:100%;width:43%;background:#2e7d32}

/* form */
.form{
  display:grid;grid-template-columns:2fr 3fr 1fr 1fr auto;
  gap:8px;margin-bottom:10px
}
input,select{padding:8px;font-family:inherit}
.add{background:#2e7d32;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer}

/* table */
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #ccc;padding:6px;text-align:right}
th{background:#f0f0f0}
.left{text-align:left}
.cat{background:#e8f5e9;font-weight:700}
.sum{font-weight:700;background:#fafafa}
.del{background:#c62828;color:#fff;border:none;padding:4px 8px;border-radius:4px}

/* nav */
.nav{display:flex;justify-content:space-between;margin-top:25px}
button.navbtn{
  padding:8px 16px;border:none;border-radius:6px;
  background:#2e7d32;color:#fff;cursor:pointer
}
.note{font-size:13px;color:#555;margin-top:8px}
</style>
</head>

<body>
<div class="wrap">

<div class="progress">
  <b>рдЪрд░рдг рей / рен</b><br><br>
  <div class="steps">
    <span class="done">Short Info</span> тЖТ
    <span class="done">Detail</span> тЖТ
    <span class="active">Expense</span> тЖТ
    <span>Income</span> тЖТ
    <span>Profit</span> тЖТ
    <span>ROI</span> тЖТ
    <span>Proposal</span>
  </div>
  <div class="bar"><span></span></div>
</div>

<h2>ЁЯТ░ рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (рд╡рд╛рд░реНрд╖рд┐рдХ)</h2>

<div class="form">
  <select id="category">
    <option>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</option>
    <option>рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐</option>
    <option>рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг</option>
    <option>рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде</option>
    <option>рд╡рд┐рд╡рд┐рдз</option>
  </select>
  <input id="title" placeholder="рдЦрд░реНрдЪ рд╢реАрд░реНрд╖рдХ">
  <input id="qty" type="number" placeholder="рдкрд░рд┐рдорд╛рдг">
  <input id="rate" type="number" placeholder="рджрд░">
  <button class="add" onclick="addExpense()">+ Add</button>
</div>

<table>
<thead>
<tr>
  <th class="left">рд╢реАрд░реНрд╖рдХ</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th>рд░рдХрдо</th>
  <th></th>
</tr>
</thead>
<tbody id="body"></tbody>
<tfoot>
<tr class="sum">
  <td colspan="3" class="left">рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</td>
  <td id="cashTotal">0</td><td></td>
</tr>
<tr class="sum">
  <td colspan="3" class="left">рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (рд╡рд╛рд░реНрд╖рд┐рдХ)</td>
  <td id="deprTotal">0</td><td></td>
</tr>
</tfoot>
</table>

<hr>

<h3>ЁЯПж рд▓рдЧрд╛рдиреАрдХреЛ рд╕реНрд░реЛрдд</h3>
<table>
<tr>
  <th class="left">рд╕реНрд░реЛрдд</th><th>%</th><th>рд░рдХрдо</th><th>рдмреНрдпрд╛рдЬ %</th><th>рд╡рд╛рд░реНрд╖рд┐рдХ рдмреНрдпрд╛рдЬ</th>
</tr>
<tr>
  <td class="left">рд╕реНрд╡рд▓рдЧрд╛рдиреА</td>
  <td><input id="ownPct" value="40"></td>
  <td id="ownAmt">0</td><td>тАФ</td><td>тАФ</td>
</tr>
<tr>
  <td class="left">рдЕрдиреБрджрд╛рди / рдкреНрд░рд╕реНрддрд╛рд╡</td>
  <td><input id="grantPct" value="30"></td>
  <td id="grantAmt">0</td><td>тАФ</td><td>тАФ</td>
</tr>
<tr>
  <td class="left">рд╕рд╣рдХрд╛рд░реА / рдмреИрдВрдХ рдЛрдг</td>
  <td><input id="loanPct" value="30"></td>
  <td id="loanAmt">0</td>
  <td><input id="loanRate" value="12"></td>
  <td id="loanInterest">0</td>
</tr>
<tr class="sum">
  <td class="left">рдЬрдореНрдорд╛</td>
  <td id="totPct">100%</td>
  <td id="totAmt">0</td>
  <td></td>
  <td id="totInt">0</td>
</tr>
</table>

<div class="note">
тЬФя╕П рдЛрдг рдмреНрдпрд╛рдЬ ProfitтАУLoss рдорд╛ рдЦрд░реНрдЪрдорд╛ рдШрдЯрд╛рдЗрдиреНрдЫ<br>
тЬФя╕П рдореВрд▓рдзрди (principal) ROI рдорд╛ рдорд╛рддреНрд░ рджреЗрдЦрд╛рдЗрдиреНрдЫ
</div>

<div class="nav">
  <button class="navbtn" onclick="location.href='business-detail.html'">тмЕ Previous</button>
  <button class="navbtn" onclick="location.href='income-demo.html'">Next тЮб</button>
</div>

</div>

<script>
let key=localStorage.getItem("activeProject");
if(!key){alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");location.href="index.html";}
let project=JSON.parse(localStorage.getItem(key));
let expenses=project.expenseData||[];

function addExpense(){
  if(!title.value) return;
  let amt=(qty.value||0)*(rate.value||0);
  expenses.push({
    category:category.value,
    title:title.value,
    qty:qty.value||0,
    rate:rate.value||0,
    amount:amt
  });
  title.value="";qty.value="";rate.value="";
  save();
}
function del(i){expenses.splice(i,1);save();}
function save(){
  project.expenseData=expenses;
  localStorage.setItem(key,JSON.stringify(project));
  render();
}

function render(){
  body.innerHTML="";
  let groups={},cash=0,depr=0,capital=0;

  expenses.forEach(e=>{
    if(!groups[e.category]) groups[e.category]=[];
    groups[e.category].push(e);
  });

  for(let c in groups){
    body.innerHTML+=`<tr class="cat"><td colspan="5">ЁЯФ╣ ${c}</td></tr>`;
    groups[c].forEach((e,i)=>{
      if(c==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||c==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг"){
        depr+=e.amount*0.15;
        capital+=e.amount;
      }else{
        cash+=e.amount;
        if(c==="рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА") capital+=e.amount;
      }
      body.innerHTML+=`
      <tr>
        <td class="left">${e.title}</td>
        <td>${e.qty}</td>
        <td>${e.rate}</td>
        <td>${e.amount}</td>
        <td><button class="del" onclick="del(${i})">тЬЦ</button></td>
      </tr>`;
    });
  }

  cashTotal.innerText=Math.round(cash);
  deprTotal.innerText=Math.round(depr);

  /* financing */
  let op=Number(ownPct.value||0), gp=Number(grantPct.value||0),
      lp=Number(loanPct.value||0), lr=Number(loanRate.value||0);

  let oa=capital*op/100, ga=capital*gp/100, la=capital*lp/100;
  let li=la*lr/100;

  ownAmt.innerText=Math.round(oa);
  grantAmt.innerText=Math.round(ga);
  loanAmt.innerText=Math.round(la);
  loanInterest.innerText=Math.round(li);
  totPct.innerText=(op+gp+lp)+"%";
  totAmt.innerText=Math.round(capital);
  totInt.innerText=Math.round(li);

  localStorage.setItem("ANNUAL_LOAN_INTEREST",li);
}
[ownPct,grantPct,loanPct,loanRate].forEach(i=>i.oninput=render);
render();
</script>

</body>
</html>
