<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Expense Entry тАУ BPMS (Final Locked)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:system-ui,Arial;
  background:#f4f7f6;
  padding:20px;
}
h2{color:#2e7d32}
select,input,button{padding:8px;margin:4px}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:8px}
th{background:#e8f5e9}
.group-row{background:#c8e6c9;font-weight:bold}
.total-row{background:#f1f8e9;font-weight:bold}
.note{font-size:13px;color:#555;margin-top:8px}
.depr-col{text-align:right}
@media print{.no-print{display:none}}
</style>
</head>

<body>

<h2>ЁЯТ░ рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (Expense Entry)</h2>

<!-- MODE TOGGLE -->
<label class="no-print">
  <input type="checkbox" id="advancedMode">
  Advanced Mode (рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА рд╕рд╣рд┐рдд)
</label>

<br><br>

<!-- ENTRY FORM -->
<select id="category">
  <option value="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐">рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐</option>
  <option value="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг">рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг</option>
  <option value="рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА">рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</option>
  <option value="рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде">рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде</option>
  <option value="рд╡рд┐рд╡рд┐рдз">рд╡рд┐рд╡рд┐рдз</option>
  <option value="рдЪрд╛рд▓реБ рдЦрд░реНрдЪ">рдЪрд╛рд▓реБ рдЦрд░реНрдЪ</option>
</select>

<input id="title" placeholder="рдЦрд░реНрдЪ рд╢реАрд░реНрд╖рдХ">
<input id="qty" type="number" placeholder="рдкрд░рд┐рдорд╛рдг" min="1">
<input id="rate" type="number" placeholder="рджрд░ (рд░реБ.)">
<button onclick="addExpense()">тЮХ Add</button>

<div class="note">
тЬФ рд╡рд┐рдзрд╛ рдорд╛рдерд┐ Central рд░реВрдкрдорд╛ рджреЗрдЦрд┐рдиреНрдЫ<br>
тЬФ рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА <b>рдореЗрд╢реАрди рдФрдЬрд╛рд░</b> рд░ <b>рдкреВрд░реНрд╡рд╛рдзрд╛рд░</b> рдорд╛ рдорд╛рддреНрд░ (Advanced Mode)<br>
тЬФ <b>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</b> cash рдорд╛ рдЧрдирд┐рдиреНрдЫ, рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА рд╣реБрдБрджреИрди
</div>

<!-- TABLE -->
<table>
<thead>
<tr>
  <th>рд╢реАрд░реНрд╖рдХ</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th>рд░рдХрдо</th>
  <th class="depr-col">рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (рд╡рд╛рд░реНрд╖рд┐рдХ)</th>
  <th></th>
</tr>
</thead>

<tbody id="rows"></tbody>

<tfoot>
<tr class="total-row">
  <td colspan="3">рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</td>
  <td id="totalExpense">0</td>
  <td class="depr-col"></td>
  <td></td>
</tr>
<tr class="total-row">
  <td colspan="4">рдХреБрд▓ рд╡рд╛рд░реНрд╖рд┐рдХ рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</td>
  <td class="depr-col" id="totalDepr">0</td>
  <td></td>
</tr>
</tfoot>
</table>

<script>
/* ================= DATA ================= */
let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");

/* ================= DEPRECIATION RULES ================= */
const DEPR_RULES = {
  "рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐": 0.15,   // 15%
  "рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг": 0.05       // 5%
};

/* ================= MODE ================= */
let MODE = localStorage.getItem("advancedMode") || "simple";
advancedMode.checked = (MODE==="advanced");

advancedMode.addEventListener("change", e=>{
  MODE = e.target.checked ? "advanced" : "simple";
  localStorage.setItem("advancedMode", MODE);
  render();
});

/* ================= ADD ================= */
function addExpense(){
  if(!title.value || !rate.value){
    alert("рд╢реАрд░реНрд╖рдХ рд░ рджрд░ рдЕрдирд┐рд╡рд╛рд░реНрдп рдЫ");
    return;
  }

  const q = Number(qty.value || 1);
  const r = Number(rate.value);
  const amt = q * r;

  expenses.push({
    category: category.value,
    title: title.value,
    qty: q,
    rate: r,
    amount: amt
  });

  title.value=""; qty.value=""; rate.value="";
  saveAndRender();
}

/* ================= DELETE ================= */
function del(i){
  expenses.splice(i,1);
  saveAndRender();
}

/* ================= SAVE ================= */
function saveAndRender(){
  localStorage.setItem("expenses", JSON.stringify(expenses));
  render();
}

/* ================= RENDER ================= */
function render(){
  const grouped = {};
  let cashTotal = 0;
  let deprTotal = 0;

  expenses.forEach(e=>{
    if(!grouped[e.category]) grouped[e.category]=[];
    grouped[e.category].push(e);

    if(MODE==="advanced" && DEPR_RULES[e.category]){
      deprTotal += e.amount * DEPR_RULES[e.category];
    }else{
      cashTotal += e.amount;
    }
  });

  let html="";
  Object.keys(grouped).forEach(cat=>{
    html += `<tr class="group-row"><td colspan="6">тЧЖ ${cat}</td></tr>`;
    grouped[cat].forEach(e=>{
      const depr =
        (MODE==="advanced" && DEPR_RULES[e.category])
          ? Math.round(e.amount * DEPR_RULES[e.category]).toLocaleString()
          : "";
      html += `
        <tr>
          <td>${e.title}</td>
          <td>${e.qty}</td>
          <td>${e.rate.toLocaleString()}</td>
          <td>${e.amount.toLocaleString()}</td>
          <td class="depr-col">${depr}</td>
          <td><button onclick="del(${expenses.indexOf(e)})">тЭМ</button></td>
        </tr>`;
    });
  });

  rows.innerHTML = html;
  totalExpense.innerText = cashTotal.toLocaleString();
  totalDepr.innerText =
    MODE==="advanced" ? Math.round(deprTotal).toLocaleString() : "0";

  document.querySelectorAll(".depr-col").forEach(el=>{
    el.style.display = MODE==="advanced" ? "" : "none";
  });
}

/* INIT */
render();
</script>

</body>
</html>
