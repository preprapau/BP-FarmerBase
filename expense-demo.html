<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (Expense Entry)</title>

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",Arial;
  background:#f4f7f6;
  padding:20px;
}
h1{color:#2e7d32}
select,input,button{padding:8px;font-size:14px}
button{cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #cfd8dc;padding:8px;text-align:center}
th{background:#e8f5e9}
.group{background:#d9f2dc;font-weight:bold;text-align:left}
.summary{background:#f1f8e9;font-weight:bold}
.remove{background:#e53935;color:#fff;border:none;padding:4px 8px}
.note{margin-top:10px;color:#2e7d32}
</style>
</head>

<body>

<h1>ЁЯТ░ рдЦрд░реНрдЪ рд╡рд┐рд╡рд░рдг (Expense Entry)</h1>

<label>
<input type="checkbox" id="advancedMode"> Advanced Mode (рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА рд╕рд╣рд┐рдд)
</label>

<br><br>

<select id="category">
  <option value="рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА">рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА</option>
  <option value="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐">рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐</option>
  <option value="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг">рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг</option>
  <option value="рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде">рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде</option>
  <option value="рд╡рд┐рд╡рд┐рдз">рд╡рд┐рд╡рд┐рдз</option>
</select>

<input id="title" placeholder="рдЦрд░реНрдЪ рд╢реАрд░реНрд╖рдХ">
<input id="qty" type="number" placeholder="рдкрд░рд┐рдорд╛рдг">
<input id="rate" type="number" placeholder="рджрд░ (рд░реБ.)">

<button onclick="addExpense()">тЮХ Add</button>

<div class="note">
тЬФя╕П рд╡рд┐рдзрд╛ Central рд░реВрдкрдорд╛<br>
тЬФя╕П рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА = рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреВрд░реНрд╡рд╛рдзрд╛рд░ (Advanced Mode)<br>
тЬФя╕П рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рд▓рдЧрд╛рдиреА, рдХрдЪреНрдЪрд╛рдкрджрд╛рд░реНрде, рд╡рд┐рд╡рд┐рдз тЖТ Cash рдорд╛рддреНрд░
</div>

<table>
<thead>
<tr>
  <th>рд╢реАрд░реНрд╖рдХ</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th>рд░рдХрдо</th>
  <th>рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА (рд╡рд╛рд░реНрд╖рд┐рдХ)</th>
  <th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>

<tfoot>
<tr class="summary">
  <td colspan="3">рдХреБрд▓ рдЦрд░реНрдЪ (Cash)</td>
  <td id="cashTotal">0</td>
  <td></td><td></td>
</tr>
<tr class="summary">
  <td colspan="4">рдХреБрд▓ рд╡рд╛рд░реНрд╖рд┐рдХ рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА</td>
  <td id="depTotal">0</td>
  <td></td>
</tr>
</tfoot>
</table>

<script>
let data = [];

function addExpense(){
  const cat = category.value;
  const titleVal = title.value;
  const q = Number(qty.value||1);
  const r = Number(rate.value||0);
  const adv = advancedMode.checked;

  if(!titleVal || r<=0){ alert("рд╢реАрд░реНрд╖рдХ рд░ рджрд░ рдЪрд╛рд╣рд┐рдиреНрдЫ"); return; }

  const amount = q*r;
  let dep = 0;

  if(adv && (cat==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐" || cat==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")){
    dep = amount * 0.15;
  }

  data.push({cat,title:titleVal,q,r,amount,dep});
  title.value=""; qty.value=""; rate.value="";
  render();
}

function render(){
  tbody.innerHTML="";
  let cash=0, dep=0;
  let groups={};

  data.forEach(e=>{
    if(!groups[e.cat]) groups[e.cat]=[];
    groups[e.cat].push(e);
  });

  for(let g in groups){
    let gr=document.createElement("tr");
    gr.className="group";
    gr.innerHTML=`<td colspan="6">тЧЖ ${g}</td>`;
    tbody.appendChild(gr);

    groups[g].forEach((e,i)=>{
      cash+=e.amount; dep+=e.dep;
      let tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${e.title}</td>
        <td>${e.q}</td>
        <td>${e.r}</td>
        <td>${e.amount}</td>
        <td>${e.dep.toFixed(0)}</td>
        <td><button class="remove" onclick="del(${data.indexOf(e)})">тЬЦ</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  cashTotal.innerText=cash.toFixed(0);
  depTotal.innerText=dep.toFixed(0);

  localStorage.setItem("EXPENSE_CASH",cash);
  localStorage.setItem("EXPENSE_DEP",dep);
}

function del(i){ data.splice(i,1); render(); }
</script>

</body>
</html>
