<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£ | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== Global (same as other pages) ===== */
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  margin:0;
  background:#f4f7f6;
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
header a, footer a{
  text-decoration:none;
  color:#2e7d32;
  font-weight:600
}
.container{
  max-width:1000px;
  margin:0 auto;
  padding:20px
}
h2{
  color:#2e7d32;
  margin:10px 0
}

/* ===== Toggle ===== */
.toggle{
  margin:12px 0;
}
.toggle button{
  padding:8px 14px;
  margin-right:6px;
  border:1px solid #2e7d32;
  background:#fff;
  color:#2e7d32;
  cursor:pointer
}
.toggle button.active{
  background:#2e7d32;
  color:#fff
}

/* ===== Table ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff
}
th, td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px;
}
th{
  background:#eef5ee;
  text-align:left
}
input, select{
  width:100%;
  padding:6px;
  font-size:14px;
  box-sizing:border-box
}
.amount{
  text-align:right;
  font-weight:600
}
.remove{
  color:#c62828;
  cursor:pointer;
  text-align:center
}
.addBtn{
  margin-top:10px;
  padding:8px 14px;
  background:#2e7d32;
  color:#fff;
  border:none;
  cursor:pointer
}
.note{
  font-size:13px;
  color:#2e7d32;
  margin-top:8px
}
</style>
</head>

<body>

<header>
  <a href="production-sells.html">‚óÄ Production</a>
  <a href="income-demo.html">Income ‚ñ∂</a>
</header>

<div class="container">

<h2>üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£</h2>

<div class="toggle">
  <button id="btnOperating" class="active" onclick="switchType('operating')">
    ‡§ö‡§æ‡§≤‡•Å ‡§ñ‡§∞‡•ç‡§ö
  </button>
  <button id="btnFixed" onclick="switchType('fixed')">
    ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§ñ‡§∞‡•ç‡§ö
  </button>
</div>

<table>
<thead>
<tr>
  <th>Sub-Category</th>
  <th>‡§ñ‡§∞‡•ç‡§ö ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th>
  <th>‡§™‡§∞‡§ø‡§Æ‡§æ‡§£</th>
  <th>‡§á‡§ï‡§æ‡§à</th>
  <th>‡§¶‡§∞</th>
  <th>‡§∞‡§ï‡§Æ</th>
  <th>‡§≤‡§æ‡§ó‡•Ç ‡§π‡•Å‡§®‡•á ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®</th>
  <th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<button class="addBtn" onclick="addRow()">‚ûï ‡§®‡§Ø‡§æ‡§Å ‡§ñ‡§∞‡•ç‡§ö</button>

<p class="note">‚úîÔ∏è ‡§™‡§∞‡§ø‡§Æ‡§æ‡§£ ‡§µ‡§æ ‡§¶‡§∞ ‡§¨‡§¶‡§≤‡•ç‡§¶‡§æ ‡§∞‡§ï‡§Æ ‡§∏‡•ç‡§µ‡§§‡§É ‡§ó‡§£‡§®‡§æ ‡§π‡•Å‡§®‡•ç‡§õ | ‡§∏‡§¨‡•à ‡§µ‡§ø‡§µ‡§∞‡§£ Auto-Save</p>

</div>

<footer>
  <a href="production-sells.html">‚óÄ Back</a>
  <a href="income-demo.html">Next ‚ñ∂</a>
</footer>

<!-- ===== DATALISTS ===== -->
<datalist id="operatingSubs">
  <option value="‡§¶‡§æ‡§®‡§æ/‡§Ü‡§π‡§æ‡§∞">
  <option value="‡§î‡§∑‡§ß‡§ø/‡§≠‡§ø‡§ü‡§æ‡§Æ‡§ø‡§®">
  <option value="‡§Æ‡§ú‡§¶‡•Å‡§∞‡•Ä">
  <option value="‡§¨‡§ø‡§ú‡•Å‡§≤‡•Ä/‡§™‡§æ‡§®‡•Ä">
  <option value="‡§¢‡•Å‡§µ‡§æ‡§®‡•Ä">
  <option value="‡§Ö‡§®‡•ç‡§Ø">
</datalist>

<datalist id="fixedSubs">
  <option value="‡§ó‡•ã‡§†/‡§∂‡•á‡§°">
  <option value="‡§Æ‡•á‡§∏‡§ø‡§®/‡§î‡§ú‡§æ‡§∞">
  <option value="‡§™‡•ç‡§∞‡§ú‡§®‡§® ‡§™‡§∂‡•Å">
  <option value="‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ">
  <option value="‡§Ö‡§®‡•ç‡§Ø">
</datalist>

<script>
/* ===== Load Project ===== */
const key = localStorage.getItem("activeProject");
if(!key){ location.href="index.html"; }
let project = JSON.parse(localStorage.getItem(key)) || {};
project.expenses = project.expenses || [];

let costType = "operating";

/* ===== Switch Type ===== */
function switchType(type){
  costType = type;
  btnOperating.classList.toggle("active", type==="operating");
  btnFixed.classList.toggle("active", type==="fixed");
  render();
}

/* ===== Render ===== */
function render(){
  tbody.innerHTML = "";
  const list = project.expenses.filter(e=>e.costType===costType);

  list.forEach((e,i)=>{
    tbody.innerHTML += `
    <tr>
      <td>
        <input list="${costType}Subs"
          value="${e.subCategory||""}"
          oninput="update(${i},'subCategory',this.value)">
      </td>

      <td>
        <input value="${e.title||""}"
          oninput="update(${i},'title',this.value)">
      </td>

      <td>
        <input type="number" value="${e.qty||""}"
          oninput="updateQtyRate(${i},'qty',this.value)">
      </td>

      <td>
        <input value="${e.unit||""}"
          oninput="update(${i},'unit',this.value)">
      </td>

      <td>
        <input type="number" value="${e.rate||""}"
          oninput="updateQtyRate(${i},'rate',this.value)">
      </td>

      <td class="amount">
        ${(e.amount||0).toFixed(2)}
      </td>

      <td>
        <select onchange="update(${i},'appliesTo',this.value)">
          <option value="all" ${e.appliesTo==="all"?"selected":""}>‡§∏‡§¨‡•à</option>
          <option value="goat" ${e.appliesTo==="goat"?"selected":""}>‡§¨‡§æ‡§ñ‡•ç‡§∞‡§æ</option>
          <option value="pig" ${e.appliesTo==="pig"?"selected":""}>‡§¨‡§Ç‡§ó‡•Å‡§∞</option>
          <option value="veg" ${e.appliesTo==="veg"?"selected":""}>‡§§‡§∞‡§ï‡§æ‡§∞‡•Ä</option>
        </select>
      </td>

      <td class="remove" onclick="removeRow(${i})">‚ùå</td>
    </tr>`;
  });
}

/* ===== CRUD ===== */
function addRow(){
  project.expenses.push({
    costType: costType,
    subCategory:"",
    title:"",
    qty:0,
    unit:"",
    rate:0,
    amount:0,
    appliesTo:"all"
  });
  save(); render();
}

function update(i,f,v){
  const list = project.expenses.filter(e=>e.costType===costType);
  list[i][f] = v;
  save();
}

function updateQtyRate(i,f,v){
  const list = project.expenses.filter(e=>e.costType===costType);
  list[i][f] = Number(v)||0;
  list[i].amount = (list[i].qty||0) * (list[i].rate||0);
  save(); render();
}

function removeRow(i){
  const list = project.expenses.filter(e=>e.costType===costType);
  const idx = project.expenses.indexOf(list[i]);
  project.expenses.splice(idx,1);
  save(); render();
}

function save(){
  localStorage.setItem(key, JSON.stringify(project));
}

/* Init */
render();
</script>

</body>
</html>
