<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Income Detail | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}

/* ===== PROGRESS ===== */
.progress{
  background:#e8f5e9;border:1px solid #c8e6c9;
  padding:12px;border-radius:8px;margin-bottom:15px
}
.steps span{
  padding:4px 8px;border-radius:10px;background:#eee;font-size:13px
}
.steps .done{background:#a5d6a7}
.steps .active{background:#2e7d32;color:#fff}
.bar{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:8px}
.bar span{display:block;height:100%;width:57%;background:#2e7d32}

/* ===== FORM ===== */
.form{
  display:grid;
  grid-template-columns:2fr 3fr 1fr 1fr auto;
  gap:8px;
  margin-bottom:10px;
}
input,select{padding:8px;font-family:inherit}
.add{
  background:#2e7d32;color:#fff;
  border:none;border-radius:6px;
  padding:8px 14px;cursor:pointer
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:right;
}
th{background:#f0f0f0}
.left{text-align:left}
.cat{
  background:#e8f5e9;
  font-weight:700;
}
.sum{
  font-weight:700;
  background:#fafafa;
}
.edit{
  background:#0277bd;color:#fff;
  border:none;padding:4px 8px;
  border-radius:4px;cursor:pointer
}
.del{
  background:#c62828;color:#fff;
  border:none;padding:4px 8px;
  border-radius:4px;cursor:pointer
}

/* ===== NAV ===== */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}
button.navbtn{
  padding:8px 16px;
  border:none;border-radius:6px;
  background:#2e7d32;color:#fff;
  cursor:pointer
}

@media print{
  button,.nav{display:none}
  a[href]:after{content:""}
}
</style>
</head>

<body>
<div class="wrap">

<!-- ===== PROGRESS ===== -->
<div class="progress">
  <b>‡§ö‡§∞‡§£ ‡•™ / ‡•≠</b><br><br>
  <div class="steps">
    <span class="done">Short Info</span> ‚Üí
    <span class="done">Detail</span> ‚Üí
    <span class="done">Expense</span> ‚Üí
    <span class="active">Income</span> ‚Üí
    <span>Profit</span> ‚Üí
    <span>ROI</span> ‚Üí
    <span>Proposal</span>
  </div>
  <div class="bar"><span></span></div>
</div>

<h2>üìà ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</h2>

<!-- ===== ENTRY FORM ===== -->
<div class="form">
  <select id="category">
    <option>‡§™‡§∂‡•Å ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</option>
    <option>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</option>
    <option>‡§∏‡•á‡§µ‡§æ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</option>
    <option>‡§Ö‡§®‡•ç‡§Ø ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</option>
  </select>
  <input id="title" placeholder="‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï">
  <input id="qty" type="number" placeholder="‡§™‡§∞‡§ø‡§Æ‡§æ‡§£">
  <input id="rate" type="number" placeholder="‡§¶‡§∞">
  <button class="add" onclick="addIncome()">+ Add</button>
</div>

<!-- ===== TABLE ===== -->
<table>
<thead>
<tr>
  <th class="left">‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th>
  <th>‡§™‡§∞‡§ø‡§Æ‡§æ‡§£</th>
  <th>‡§¶‡§∞</th>
  <th>‡§∞‡§ï‡§Æ</th>
  <th></th>
</tr>
</thead>

<tbody id="body"></tbody>

<tfoot>
<tr class="sum">
  <td colspan="3" class="left">‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</td>
  <td id="incomeTotal">0</td>
  <td></td>
</tr>
</tfoot>
</table>

<!-- ===== NAV ===== -->
<div class="nav">
  <button class="navbtn" onclick="location.href='expense-demo.html'">‚¨Ö Previous</button>
  <button class="navbtn" onclick="location.href='profit-loss-demo.html'">Next ‚û°</button>
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(key));
let incomes = project.incomeData || [];

let editIndex = null;

/* ===== ADD / UPDATE ===== */
function addIncome(){
  if(!title.value) return;

  let amt = (qty.value||0)*(rate.value||0);

  let obj = {
    category:category.value,
    title:title.value,
    qty:Number(qty.value||0),
    rate:Number(rate.value||0),
    amount:amt
  };

  if(editIndex!==null){
    incomes[editIndex] = obj;
    editIndex = null;
  }else{
    incomes.push(obj);
  }

  title.value=""; qty.value=""; rate.value="";
  save();
}

/* ===== DELETE ===== */
function del(i){
  incomes.splice(i,1);
  save();
}

/* ===== EDIT ===== */
function edit(i){
  let e = incomes[i];
  category.value = e.category;
  title.value = e.title;
  qty.value = e.qty;
  rate.value = e.rate;
  editIndex = i;
}

/* ===== SAVE ===== */
function save(){
  project.incomeData = incomes;
  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key,JSON.stringify(project));
  render();
}

/* ===== RENDER ===== */
function render(){
  body.innerHTML="";
  let groups={}, total=0;

  incomes.forEach((e,i)=>{
    if(!groups[e.category]) groups[e.category]=[];
    groups[e.category].push({...e,index:i});
  });

  for(let c in groups){
    body.innerHTML += `
      <tr class="cat">
        <td colspan="5">üîπ ${c}</td>
      </tr>
    `;
    groups[c].forEach(e=>{
      total += e.amount;
      body.innerHTML += `
        <tr>
          <td class="left">${e.title}</td>
          <td>${e.qty}</td>
          <td>${e.rate}</td>
          <td>${e.amount}</td>
          <td>
            <button class="edit" onclick="edit(${e.index})">‚úé</button>
            <button class="del" onclick="del(${e.index})">‚úñ</button>
          </td>
        </tr>
      `;
    });
  }

  incomeTotal.innerText = Math.round(total);
}

render();
</script>

</body>
</html>
