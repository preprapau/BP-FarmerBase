<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг (Production + Other)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1000px;margin:25px auto;background:#fff;
  padding:25px;border-radius:12px;
}
h2{color:#2e7d32;margin-top:0}

/* form */
.form{
  display:grid;
  grid-template-columns:2fr 3fr 1fr 1fr auto;
  gap:8px;
  margin-bottom:12px;
}
input,select{padding:8px;font-family:inherit}
.add{
  background:#2e7d32;color:#fff;border:none;
  border-radius:6px;padding:8px 14px;cursor:pointer
}

/* table */
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:right}
th{background:#f0f0f0}
.left{text-align:left}
.cat{background:#e8f5e9;font-weight:700}
.sum{font-weight:700;background:#fafafa}
.del{background:#c62828;color:#fff;border:none;padding:4px 8px;border-radius:4px}
.edit{background:#1976d2;color:#fff;border:none;padding:4px 8px;border-radius:4px}

/* nav */
.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:25px
}
.nav a{
  text-decoration:none;
  font-weight:700;
  color:#2e7d32
}
.center-btn{
  background:#2e7d32;color:#fff;
  padding:10px 20px;border-radius:30px;
  text-decoration:none;font-weight:700
}
.note{font-size:13px;color:#555;margin-top:8px}
</style>
</head>

<body>
<div class="wrap">

<h2>ЁЯУИ рдЖрдореНрджрд╛рдиреА рд╡рд┐рд╡рд░рдг (Production + Other)</h2>

<!-- ================= ADD FORM ================= -->
<div class="form">
  <select id="category">
    <option>рдЙрддреНрдкрд╛рджрди рдмрд┐рдХреНрд░реА</option>
    <option>рдЕрдиреНрдп рдЖрдореНрджрд╛рдиреА</option>
  </select>
  <input id="title" placeholder="рдЖрдореНрджрд╛рдиреА рд╢реАрд░реНрд╖рдХ">
  <input id="qty" type="number" placeholder="рдкрд░рд┐рдорд╛рдг">
  <input id="rate" type="number" placeholder="рджрд░">
  <button class="add" onclick="addIncome()">+ Add</button>
</div>

<!-- ================= TABLE ================= -->
<table>
<thead>
<tr>
  <th class="left">рд╢реАрд░реНрд╖рдХ</th>
  <th>рдкрд░рд┐рдорд╛рдг</th>
  <th>рджрд░</th>
  <th>рд░рдХрдо</th>
  <th></th>
</tr>
</thead>
<tbody id="body"></tbody>
<tfoot>
<tr class="sum">
  <td colspan="3" class="left">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td>
  <td id="totalIncome">0</td>
  <td></td>
</tr>
</tfoot>
</table>

<div class="note">
тЬФя╕П Production page рдмрд╛рдЯ Year-1 рдмрд┐рдХреНрд░реА рд╕реНрд╡рддрдГ рддрд╛рдирд┐рдиреНрдЫ<br>
тЬФя╕П Rate/Qty edit рдЧрд░реНрди рдорд┐рд▓реНрдЫ<br>
тЬФя╕П Delete рдЧрд░реЗрдкрдЫрд┐ рдкреБрдирдГ auto-add рд╣реБрдБрджреИрди
</div>

<div class="nav">
  <a href="production.html">тЖР Production</a>
  <a class="center-btn" href="full-proposal.html">ЁЯУД Full Proposal</a>
  <a href="profit-loss-demo.html">Profit / Loss тЖТ</a>
</div>

</div>

<script>
/* ================= LOAD PROJECT ================= */
let activeKey = localStorage.getItem("activeProject");
if(!activeKey){
  alert("рдкрд╣рд┐рд▓реЗ Project рдЦреЛрд▓реНрдиреБрд╣реЛрд╕реН");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(activeKey));
let incomes = project.incomeData || [];
let editIndex = null;

/* ================= AUTO PULL FROM PRODUCTION ================= */
(function pullFromProduction(){
  let raw = localStorage.getItem("PRODUCTION_INCOME_SUMMARY");
  if(!raw) return;

  let prod = JSON.parse(raw);
  if(prod.__used) return;

  if(prod.sellKids > 0){
    incomes.push({
      category:"рдЙрддреНрдкрд╛рджрди рдмрд┐рдХреНрд░реА",
      title:"рдкрд╛рдард╛рдкрд╛рдареА рдмрд┐рдХреНрд░реА (Production)",
      qty:prod.sellKids,
      rate:30000,
      amount:prod.sellKids * 30000,
      _auto:true
    });
  }

  if(prod.sellAdults > 0){
    incomes.push({
      category:"рдЙрддреНрдкрд╛рджрди рдмрд┐рдХреНрд░реА",
      title:"рдмрдпрд╕реНрдХ рдмрд┐рдХреНрд░реА (рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди)",
      qty:prod.sellAdults,
      rate:50000,
      amount:prod.sellAdults * 50000,
      _auto:true
    });
  }

  prod.__used = true;
  project.incomeData = incomes;

  localStorage.setItem("PRODUCTION_INCOME_SUMMARY",JSON.stringify(prod));
  localStorage.setItem(activeKey,JSON.stringify(project));
})();

/* ================= ADD / EDIT ================= */
function addIncome(){
  if(!title.value) return;

  let q = Number(qty.value||0);
  let r = Number(rate.value||0);
  let amt = q*r;

  if(editIndex!==null){
    incomes[editIndex] = {
      category:category.value,
      title:title.value,
      qty:q, rate:r, amount:amt
    };
    editIndex=null;
  }else{
    incomes.push({
      category:category.value,
      title:title.value,
      qty:q, rate:r, amount:amt
    });
  }

  title.value="";qty.value="";rate.value="";
  save();
}

function editRow(i){
  let e = incomes[i];
  category.value=e.category;
  title.value=e.title;
  qty.value=e.qty;
  rate.value=e.rate;
  editIndex=i;
}

function delRow(i){
  incomes.splice(i,1);
  save();
}

/* ================= SAVE / RENDER ================= */
function save(){
  project.incomeData=incomes;
  localStorage.setItem(activeKey,JSON.stringify(project));
  render();
}

function render(){
  body.innerHTML="";
  let groups={}, total=0;

  incomes.forEach((e,i)=>{
    if(!groups[e.category]) groups[e.category]=[];
    groups[e.category].push({e,i});
  });

  for(let c in groups){
    body.innerHTML+=`<tr class="cat"><td colspan="5">тЧЖ ${c}</td></tr>`;
    groups[c].forEach(o=>{
      let e=o.e,i=o.i;
      total+=Number(e.amount||0);
      body.innerHTML+=`
      <tr>
        <td class="left">${e.title}</td>
        <td>${e.qty}</td>
        <td>${e.rate}</td>
        <td>${e.amount}</td>
        <td>
          <button class="edit" onclick="editRow(${i})">тЬПя╕П</button>
          <button class="del" onclick="delRow(${i})">тЬЦ</button>
        </td>
      </tr>`;
    });
  }
  totalIncome.innerText=Math.round(total);
}

render();
</script>

</body>
</html>
