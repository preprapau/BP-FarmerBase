<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Short Analysis | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:900px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}
.small{font-size:13px;color:#555}

/* ===== TOP BAR ===== */
.topBar{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  margin-bottom:12px;
}
.topBar .left{text-align:left}
.topBar .center{text-align:center}
.topBar .right{text-align:right}

/* textarea */
textarea{
  width:100%;
  min-height:160px;
  padding:10px;
  font-family:inherit;
}

/* buttons */
button{
  border:none;
  border-radius:6px;
  padding:8px 16px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}
.previewBtn{background:#0277bd}

/* preview */
.preview textarea{
  pointer-events:none;
  background:#f3f3f3;
}
.previewNote{
  background:#fff3cd;
  padding:6px 10px;
  border-radius:6px;
  font-size:13px;
  margin-bottom:10px;
}

/* bottom nav */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
</style>
</head>

<body>

<div class="wrap" id="page">

<!-- ===== TOP CONTROLS ===== -->
<div class="topBar">
  <div class="left">
    <button onclick="goPrev()">‚¨Ö Existing Status</button>
  </div>

  <div class="center">
    <button class="previewBtn" onclick="togglePreview()">üëÅ Preview / ‚úèÔ∏è Edit</button>
  </div>

  <div class="right">
    <button onclick="goNext()">Next ‚û°</button>
  </div>
</div>

<div id="previewNote" class="previewNote" style="display:none">
üëÅ Preview Mode (Read-only)
</div>

<h2>üß† Short Analysis (‡§õ‡•ã‡§ü‡•ã ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£)</h2>
<p class="small">
‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ, ‡§ö‡•Å‡§®‡•å‡§§‡•Ä, ‡§∏‡§Æ‡•ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§∞ ‡§®‡§ø‡§∑‡•ç‡§ï‡§∞‡•ç‡§∑‡§≤‡§æ‡§à
3‚Äì5 ‡§µ‡§æ‡§ï‡•ç‡§Ø‡§Æ‡§æ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™‡§Æ‡§æ ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§
</p>

<textarea id="analysisText"
  placeholder="‡§Ø‡§π‡§æ‡§Å ‡§õ‡•ã‡§ü‡•ã ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç..."></textarea>

<!-- ===== BOTTOM NAV ===== -->
<div class="nav">
  <button onclick="goPrev()">‚¨Ö Previous</button>
  <button onclick="goNext()">Next ‚û°</button>
</div>

</div>

<script>
/* ===== SAFETY LOAD ===== */
const key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Home ‡§¨‡§æ‡§ü Project ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
const project = JSON.parse(localStorage.getItem(key));
project.shortAnalysis ??= "";

/* ===== LOAD ===== */
analysisText.value = project.shortAnalysis;

/* ===== AUTOSAVE ===== */
analysisText.addEventListener("input",()=>{
  project.shortAnalysis = analysisText.value;
  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key,JSON.stringify(project));
});

/* ===== NAVIGATION (FIXED & SAFE) ===== */
function goPrev(){
  location.href = "existing-status.html";
}
function goNext(){
  location.href = "business-detail.html";
}

/* ===== PREVIEW ===== */
let preview=false;
function togglePreview(){
  preview=!preview;
  page.classList.toggle("preview",preview);
  previewNote.style.display = preview ? "block":"none";
}
</script>

</body>
</html>
