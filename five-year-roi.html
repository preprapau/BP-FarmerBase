<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>5-Year ROI Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.wrap{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:right;
}
th{text-align:center;background:#f0f0f0}
.left{text-align:left}
input{
  width:70px;
  padding:6px;
}
.green{background:#e8f5e9;font-weight:bold}
.note{
  font-size:13px;
  color:#555;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="wrap">
<h2>ЁЯУИ рел рд╡рд░реНрд╖реЗ ROI рд╡рд┐рд╢реНрд▓реЗрд╖рдг</h2>

<!-- ================= GROWTH INPUT ================= -->
<h3>рд╡рд╛рд░реНрд╖рд┐рдХ % рд╡реГрджреНрдзрд┐</h3>

<label>
  <input type="checkbox" id="yearWiseToggle">
  рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрд╖ рдлрд░рдХ % рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ
</label>

<table>
<tr>
  <th class="left">рд╡рд░реНрд╖</th>
  <th>рдЖрдореНрджрд╛рдиреА рд╡реГрджреНрдзрд┐ %</th>
  <th>рдЦрд░реНрдЪ рд╡реГрджреНрдзрд┐ %</th>
</tr>
<tr><td class="left">рд╡рд░реНрд╖ рез</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ реи</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рей</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рек</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рел</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
</table>

<!-- ================= ROI TABLE ================= -->
<h3 style="margin-top:25px">ROI рд╡рд┐рд╡рд░рдг</h3>

<table>
<tr>
  <th class="left">рд╡рд░реНрд╖</th>
  <th>рдЖрдореНрджрд╛рдиреА</th>
  <th>рдЦрд░реНрдЪ</th>
  <th>рдирд╛рдлрд╛</th>
  <th>рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</th>
</tr>

<tr>
  <td class="left">рд╡рд░реНрд╖ рез</td>
  <td id="inc0">0</td>
  <td id="exp0">0</td>
  <td id="profit0">0</td>
  <td id="cum0">0</td>
</tr>
<tr>
  <td class="left">рд╡рд░реНрд╖ реи</td>
  <td id="inc1">0</td>
  <td id="exp1">0</td>
  <td id="profit1">0</td>
  <td id="cum1">0</td>
</tr>
<tr>
  <td class="left">рд╡рд░реНрд╖ рей</td>
  <td id="inc2">0</td>
  <td id="exp2">0</td>
  <td id="profit2">0</td>
  <td id="cum2">0</td>
</tr>
<tr>
  <td class="left">рд╡рд░реНрд╖ рек</td>
  <td id="inc3">0</td>
  <td id="exp3">0</td>
  <td id="profit3">0</td>
  <td id="cum3">0</td>
</tr>
<tr>
  <td class="left">рд╡рд░реНрд╖ рел</td>
  <td id="inc4">0</td>
  <td id="exp4">0</td>
  <td id="profit4">0</td>
  <td id="cum4">0</td>
</tr>
</table>

<div class="note">
тЬФя╕П рдЖрдореНрджрд╛рдиреА рд░ рдЦрд░реНрдЪ Expense / Income рдкреЗрдЬрдмрд╛рдЯ рд╕реНрд╡рддрдГ рд▓рд┐рдЗрдиреНрдЫ<br>
тЬФя╕П рд╣реНрд░рд╛рд╕рдХрдЯреНрдЯреА рдЦрд░реНрдЪрдорд╛ рд╕рдорд╛рд╡реЗрд╢ рднрдЗрд╕рдХреЗрдХреЛ рдорд╛рдирд┐рдиреНрдЫ<br>
тЬФя╕П Toggle OFF = рд╕рдмреИ рд╡рд░реНрд╖ рдПрдЙрдЯреИ %<br>
тЬФя╕П Toggle ON = рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрд╖ рдлрд░рдХ %
</div>

</div>

<script>
/* ===== BASE VALUES FROM PROJECT ===== */
let baseIncome = 0;
let baseExpense = 0;
let baseDep = 0;

try{
  let key = localStorage.getItem("activeProject");
  if(key){
    let p = JSON.parse(localStorage.getItem(key));
    (p.incomeData||[]).forEach(i=>baseIncome+=Number(i.amount||0));
    (p.expenseData||[]).forEach(e=>{
      if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")
        baseDep+=e.amount*0.15;
      else
        baseExpense+=e.amount;
    });
  }
}catch(e){}

/* ===== INPUTS ===== */
const incRates=document.querySelectorAll(".incRate");
const expRates=document.querySelectorAll(".expRate");
const toggle=document.getElementById("yearWiseToggle");

/* ===== CALCULATION ===== */
function calcROI(){
  let income=baseIncome;
  let expense=baseExpense;
  let cumulative=-baseExpense;

  for(let i=0;i<5;i++){
    let ir=Number(incRates[toggle.checked?i:0].value||0);
    let er=Number(expRates[toggle.checked?i:0].value||0);

    if(i>0){
      income+=income*(ir/100);
      expense+=expense*(er/100);
    }

    let profit=income-expense-baseDep;
    cumulative+=profit;

    document.getElementById("inc"+i).innerText=Math.round(income).toLocaleString();
    document.getElementById("exp"+i).innerText=Math.round(expense).toLocaleString();
    document.getElementById("profit"+i).innerText=Math.round(profit).toLocaleString();
    document.getElementById("cum"+i).innerText=Math.round(cumulative).toLocaleString();
  }
}

/* ===== EVENTS ===== */
document.querySelectorAll("input").forEach(i=>i.addEventListener("input",calcROI));
calcROI();
</script>

</body>
</html>
