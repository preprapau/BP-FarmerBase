<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>5-Year ROI | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;margin:0;
}
.wrap{
  max-width:1000px;margin:25px auto;background:#fff;
  padding:25px;border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}

/* ===== PROGRESS ===== */
.progress{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.steps span{
  padding:4px 8px;
  border-radius:10px;
  background:#eee;
  font-size:13px;
}
.steps .done{background:#a5d6a7}
.steps .active{background:#2e7d32;color:#fff}
.bar{
  height:8px;background:#ddd;border-radius:6px;
  overflow:hidden;margin-top:8px;
}
.bar span{
  display:block;height:100%;width:85%;
  background:#2e7d32;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:right;
}
th{background:#f0f0f0;text-align:center}
.left{text-align:left}
input{width:70px;padding:6px}

/* ===== NAV ===== */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}
button{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}
.note{
  font-size:13px;color:#555;margin-top:10px;
}
</style>
</head>

<body>

<div class="wrap">

<!-- ===== PROGRESS BAR ===== -->
<div class="progress">
  <b>рдЪрд░рдг рем / рен</b><br><br>
  <div class="steps">
    <span class="done">Short Info</span> тЖТ
    <span class="done">Detail</span> тЖТ
    <span class="done">Expense</span> тЖТ
    <span class="done">Income</span> тЖТ
    <span class="done">Profit</span> тЖТ
    <span class="active">ROI</span> тЖТ
    <span>Proposal</span>
  </div>
  <div class="bar"><span></span></div>
</div>

<h2>ЁЯУИ рел рд╡рд░реНрд╖реЗ ROI рд╡рд┐рд╢реНрд▓реЗрд╖рдг</h2>

<!-- ===== GROWTH INPUT ===== -->
<label>
  <input type="checkbox" id="yearWiseToggle">
  рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрд╖ рдлрд░рдХ % рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ
</label>

<table>
<tr>
  <th class="left">рд╡рд░реНрд╖</th>
  <th>рдЖрдореНрджрд╛рдиреА рд╡реГрджреНрдзрд┐ %</th>
  <th>рдЦрд░реНрдЪ рд╡реГрджреНрдзрд┐ %</th>
</tr>
<tr><td class="left">рд╡рд░реНрд╖ рез</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ реи</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рей</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рек</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рел</td><td><input class="incRate" value="10"></td><td><input class="expRate" value="6"></td></tr>
</table>

<!-- ===== ROI TABLE ===== -->
<table>
<tr>
  <th class="left">рд╡рд░реНрд╖</th>
  <th>рдЖрдореНрджрд╛рдиреА</th>
  <th>рдЦрд░реНрдЪ</th>
  <th>рдирд╛рдлрд╛</th>
  <th>рд╕рдВрдЪрд┐рдд рдирдЧрдж рдкреНрд░рд╡рд╛рд╣</th>
</tr>
<tr><td class="left">рд╡рд░реНрд╖ рез</td><td id="inc0">0</td><td id="exp0">0</td><td id="profit0">0</td><td id="cum0">0</td></tr>
<tr><td class="left">рд╡рд░реНрд╖ реи</td><td id="inc1">0</td><td id="exp1">0</td><td id="profit1">0</td><td id="cum1">0</td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рей</td><td id="inc2">0</td><td id="exp2">0</td><td id="profit2">0</td><td id="cum2">0</td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рек</td><td id="inc3">0</td><td id="exp3">0</td><td id="profit3">0</td><td id="cum3">0</td></tr>
<tr><td class="left">рд╡рд░реНрд╖ рел</td><td id="inc4">0</td><td id="exp4">0</td><td id="profit4">0</td><td id="cum4">0</td></tr>
</table>

<div class="note">
тЬФя╕П Expense / Income рдмрд╛рдЯ рдбреЗрдЯрд╛ рд╕реНрд╡рддрдГ рд▓рд┐рдЗрдиреНрдЫ<br>
тЬФя╕П Toggle OFF = рдПрдЙрдЯреИ % рд╕рдмреИ рд╡рд░реНрд╖<br>
тЬФя╕П Toggle ON = Year-wise рдлрд░рдХ %
</div>

<!-- ===== NAVIGATION ===== -->
<div class="nav">
  <button onclick="location.href='profit-loss-demo.html'">тмЕ Previous</button>
  <button onclick="location.href='full-proposal.html'">Next тЮб</button>
</div>

</div>

<script>
/* ===== LOAD BASE DATA ===== */
let baseIncome=0, baseExpense=0, baseDep=0;
try{
  let key=localStorage.getItem("activeProject");
  if(key){
    let p=JSON.parse(localStorage.getItem(key));
    (p.incomeData||[]).forEach(i=>baseIncome+=Number(i.amount||0));
    (p.expenseData||[]).forEach(e=>{
      if(e.category==="рдореЗрд╢реАрди рдФрдЬрд╛рд░ / рдкреНрд░рд╡рд┐рдзрд┐"||e.category==="рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдирд┐рд░реНрдорд╛рдг")
        baseDep+=e.amount*0.15;
      else
        baseExpense+=e.amount;
    });
  }
}catch(e){}

/* ===== INPUTS ===== */
const incRates=document.querySelectorAll(".incRate");
const expRates=document.querySelectorAll(".expRate");
const toggle=document.getElementById("yearWiseToggle");

/* ===== CALC ===== */
function calcROI(){
  let income=baseIncome;
  let expense=baseExpense;
  let cumulative=-baseExpense;

  for(let i=0;i<5;i++){
    let ir=Number(incRates[toggle.checked?i:0].value||0);
    let er=Number(expRates[toggle.checked?i:0].value||0);

    if(i>0){
      income+=income*(ir/100);
      expense+=expense*(er/100);
    }

    let profit=income-expense-baseDep;
    cumulative+=profit;

    inc["inc"+i].innerText=Math.round(income);
    exp["exp"+i].innerText=Math.round(expense);
    prof["profit"+i].innerText=Math.round(profit);
    cum["cum"+i].innerText=Math.round(cumulative);
  }
}

/* SAFE DOM MAP */
const inc={}, exp={}, prof={}, cum={};
for(let i=0;i<5;i++){
  inc["inc"+i]=document.getElementById("inc"+i);
  exp["exp"+i]=document.getElementById("exp"+i);
  prof["profit"+i]=document.getElementById("profit"+i);
  cum["cum"+i]=document.getElementById("cum"+i);
}

/* EVENTS */
document.querySelectorAll("input").forEach(i=>i.addEventListener("input",calcROI));
calcROI();
</script>

</body>
</html>
