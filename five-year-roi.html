<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>5-Year ROI | FarmerBase BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:1150px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{color:#2e7d32;margin-top:0}

/* PROGRESS */
.progress{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.bar{height:8px;background:#2e7d32;width:86%;border-radius:6px;margin-top:8px}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:right;
}
th{background:#f0f0f0}
.left{text-align:left}

/* BOX */
.box{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-top:15px;
}
.green{background:#e8f5e9}
.big{font-size:18px;font-weight:700}

/* INPUT */
input[type=number]{width:70px}

/* NAV */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}

@media print{
  button,.progress,.growth{display:none}
}
</style>
</head>

<body>

<div class="container">

<div class="progress">
  <b>‡§ö‡§∞‡§£ ‡•¨ / ‡•≠ (‡•Æ‡•¨%)</b><br>
  Short Info ‚Üí Detail ‚Üí Expense ‚Üí Income ‚Üí Profit/Loss ‚Üí <b>5-Year ROI</b> ‚Üí Proposal
  <div class="bar"></div>
</div>

<h2>üìà ‡§™‡§æ‡§Å‡§ö ‡§µ‡§∞‡•ç‡§∑ ROI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h2>

<!-- GROWTH -->
<div class="box growth">
  <b>‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø (%)</b><br><br>
  ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø :
  <input type="number" id="incGrowth" value="10"> %
  &nbsp;&nbsp;
  ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø :
  <input type="number" id="expGrowth" value="6"> %
</div>

<!-- TABLE -->
<table>
<thead>
<tr>
  <th class="left">‡§µ‡§∞‡•ç‡§∑</th>
  <th>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</th>
  <th>‡§ñ‡§∞‡•ç‡§ö</th>
  <th>‡§π‡•ç‡§∞‡§æ‡§∏‡§ï‡§ü‡•ç‡§ü‡•Ä</th>
  <th>‡§®‡§æ‡§´‡§æ</th>
  <th>‡§¨‡§ö‡§§ ‡§®‡§æ‡§´‡§æ</th>
  <th>Cumulative Cashflow</th>
</tr>
</thead>
<tbody id="roiBody"></tbody>
</table>

<!-- SUMMARY -->
<div class="box green">
  <div class="big">ROI : <span id="roiPercent">0</span>%</div>
  <div>Payback Period : <b><span id="payback">‚Äì</span></b></div>
</div>

<div class="nav">
  <button onclick="location.href='profit-loss-demo.html'">‚¨Ö Previous</button>
  <button onclick="location.href='full-proposal.html'">Next ‚û°</button>
</div>

</div>

<script>
let key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key));

/* BASE INCOME */
let baseIncome = 0;
(p.incomeData||[]).forEach(i=> baseIncome += Number(i.amount||0));

/* BASE EXPENSE */
let baseExpense = 0;
let depreciation = 0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä"){
    depreciation += Number(e.amount||0)*0.10;
  }else{
    baseExpense += Number(e.amount||0);
  }
});

/* INVESTMENT */
let investment = 0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä"){
    investment += Number(e.amount||0);
  }
});

/* DIVIDEND */
let retainedRate = 1;
if(p.profitAllocation){
  let div = 0;
  p.profitAllocation.forEach(a=> div += a.percent);
  retainedRate = 1 - (div/100);
}

function calculateROI(){
  roiBody.innerHTML="";
  let incG = Number(incGrowth.value)/100;
  let expG = Number(expGrowth.value)/100;

  let cumulative = 0;
  let totalReturn = 0;
  let payback = null;

  for(let y=1;y<=5;y++){
    let incomeY = baseIncome * Math.pow(1+incG, y-1);
    let expenseY = baseExpense * Math.pow(1+expG, y-1);
    let profitY = incomeY - expenseY - depreciation;
    let retainedY = profitY * retainedRate;

    cumulative += retainedY;
    totalReturn += retainedY;

    if(cumulative >= investment && payback===null){
      payback = "‡§µ‡§∞‡•ç‡§∑ " + y;
    }

    roiBody.innerHTML += `
      <tr>
        <td class="left">‡§µ‡§∞‡•ç‡§∑ ${y}</td>
        <td>${Math.round(incomeY)}</td>
        <td>${Math.round(expenseY)}</td>
        <td>${Math.round(depreciation)}</td>
        <td>${Math.round(profitY)}</td>
        <td>${Math.round(retainedY)}</td>
        <td>${Math.round(cumulative)}</td>
      </tr>`;
  }

  roiPercent.innerText = investment>0
    ? Math.round((totalReturn/investment)*100)
    : 0;

  payback.innerText = payback || "‡•´ ‡§µ‡§∞‡•ç‡§∑‡§™‡§õ‡§ø";
}

/* EVENTS */
incGrowth.oninput = expGrowth.oninput = calculateROI;

calculateROI();
</script>

</body>
</html>
