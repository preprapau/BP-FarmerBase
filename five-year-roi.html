<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>5-Year ROI | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{margin-top:0;color:#2e7d32}

/* ===== PROGRESS ===== */
.progress-wrap{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.progress-title{font-weight:700;margin-bottom:6px}
.steps{font-size:13px}
.steps span{padding:3px 6px;border-radius:10px;background:#eee}
.steps .active{background:#2e7d32;color:#fff}
.steps .done{background:#a5d6a7}
.bar-wrap{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:8px}
.bar{height:100%;background:#2e7d32;width:86%}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:right;
}
th{background:#f0f0f0}
th.left,td.left{text-align:left}

/* ===== SUMMARY ===== */
.box{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-top:15px;
}
.green{background:#e8f5e9}
.big{font-size:18px;font-weight:700}

/* ===== NAV ===== */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}

@media print{
  button,.progress-wrap{display:none}
}
</style>
</head>

<body>

<div class="container">

<!-- PROGRESS -->
<div class="progress-wrap">
  <div class="progress-title">‡§ö‡§∞‡§£ 6 / 7 (86%)</div>
  <div class="steps">
    <span class="done">Short Info</span> ‚Üí
    <span class="done">Detail</span> ‚Üí
    <span class="done">Expense</span> ‚Üí
    <span class="done">Income</span> ‚Üí
    <span class="done">Profit/Loss</span> ‚Üí
    <span class="active">5-Year ROI</span> ‚Üí
    <span>Proposal</span>
  </div>
  <div class="bar-wrap"><div class="bar"></div></div>
</div>

<h2>üìà ‡§™‡§æ‡§Å‡§ö ‡§µ‡§∞‡•ç‡§∑‡•á ROI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h2>

<table>
<thead>
<tr>
  <th class="left">‡§µ‡§∞‡•ç‡§∑</th>
  <th>Retained Profit</th>
  <th>Cumulative Cashflow</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div class="box green">
  <div class="big">ROI : <span id="roiPercent">0</span>%</div>
  <div>Payback Period : <b><span id="payback">‚Äì</span></b></div>
</div>

<div class="box">
  <b>‡§®‡•ã‡§ü:</b>
  <ul>
    <li>Profit/Loss ‡§™‡•á‡§ú‡§ï‡•ã ‡§®‡§æ‡§´‡§æ ‡§∞ ‡§≤‡§æ‡§≠‡§æ‡§Ç‡§∂ ‡§µ‡§ø‡§§‡§∞‡§£ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§õ‡•§</li>
    <li>Year-2 ‡§¶‡•á‡§ñ‡§ø Retained Profit ‡§Æ‡§æ 8% growth ‡§Æ‡§æ‡§®‡§ø‡§è‡§ï‡•ã ‡§õ‡•§</li>
    <li>Initial Investment = ‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡•§</li>
  </ul>
</div>

<div class="nav">
  <button onclick="location.href='profit-loss-demo.html'">‚¨Ö Previous</button>
  <button onclick="location.href='full-proposal.html'">Next ‚û°</button>
</div>

</div>

<script>
let key = localStorage.getItem("activeProject");
if(!key){
  alert("‡§™‡§π‡§ø‡§≤‡•á Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
let p = JSON.parse(localStorage.getItem(key));

/* ===== INITIAL INVESTMENT ===== */
let investment = 0;
(p.expenseData||[]).forEach(e=>{
  if(e.category==="‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§≤‡§ó‡§æ‡§®‡•Ä"){
    investment += Number(e.amount||0);
  }
});

/* ===== BASE PROFIT (RETAINED) ===== */
let baseRetained = p.profitLoss?.retained || 0;

/* ===== ASSUMPTION ===== */
let growth = 0.08; // 8% retained profit growth

let cumulative = 0;
let totalReturn = 0;
let payback = null;

for(let y=1;y<=5;y++){
  let retained = y===1
    ? baseRetained
    : Math.round(baseRetained * Math.pow(1+growth, y-1));

  cumulative += retained;
  totalReturn += retained;

  if(cumulative >= investment && payback===null){
    payback = "‡§µ‡§∞‡•ç‡§∑ " + y;
  }

  tbody.innerHTML += `
    <tr>
      <td class="left">‡§µ‡§∞‡•ç‡§∑ ${y}</td>
      <td>${retained}</td>
      <td>${cumulative}</td>
    </tr>`;
}

/* ===== ROI ===== */
let roi = investment>0 ? Math.round((totalReturn/investment)*100) : 0;
roiPercent.innerText = roi;
payback.innerText = payback || "‡•´ ‡§µ‡§∞‡•ç‡§∑‡§™‡§õ‡§ø";

/* ===== SAVE SNAPSHOT ===== */
p.fiveYearROI = {
  investment,
  totalReturn,
  roi,
  payback
};
p.lastEdited = new Date().toLocaleString("ne-NP");
localStorage.setItem(key, JSON.stringify(p));
</script>

</body>
</html>
