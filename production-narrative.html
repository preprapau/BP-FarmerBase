<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Production Narrative | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#fff;
  margin:20px;
}
h2,h3{
  color:#2e7d32;
  margin-bottom:6px;
}
.small{
  font-size:13px;
  color:#555;
  margin-bottom:14px;
}
textarea{
  width:100%;
  box-sizing:border-box;
  padding:10px;
  font-size:14px;
  line-height:1.6;
}
button{
  padding:6px 12px;
  margin-bottom:10px;
}
.section{
  margin-top:20px;
}
</style>
</head>

<body>

<h2>ЁЯУЭ Production Narrative (рдЙрддреНрдкрд╛рджрди рд╡рд┐рд╡рд░рдг)</h2>
<button onclick="window.print()">ЁЯЦия╕П Print</button>

<p class="small">
рдпреЛ рд╡рд┐рд╡рд░рдг Production Page рдорд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдЧрд░рд┐рдПрдХреЛ рдбрд╛рдЯрд╛рдХрд╛ рдЖрдзрд╛рд░рдорд╛ рд╕реНрд╡рддрдГ рддрдпрд╛рд░ рдЧрд░рд┐рдПрдХреЛ рд╣реЛред
рдЖрд╡рд╢реНрдпрдХ рдкрд░реЗ рдХрд┐рд╕рд╛рдирд▓реЗ рдпрд╕рд▓рд╛рдИ рд╕рдЪреНрдпрд╛рдЙрди рд╡рд╛ рдердкреНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫред
</p>

<div class="section">
  <h3>ЁЯУД рдиреЗрдкрд╛рд▓реА рд╡рд┐рд╡рд░рдг</h3>
  <textarea id="neText" rows="10"></textarea>
</div>

<div class="section">
  <h3>ЁЯУД English Description</h3>
  <textarea id="enText" rows="10"></textarea>
</div>

<script>
/* LOAD PROJECT */
const key = localStorage.getItem("activeProject");
if(!key){ alert("Active рдпреЛрдЬрдирд╛ рднреЗрдЯрд┐рдПрди"); }
const project = JSON.parse(localStorage.getItem(key)) || {};
const products = project.productionProducts || [];

/* GROUP BY TYPE */
const groups = {};
products.forEach(p=>{
  if(!p.name || p.qty<=0) return;
  groups[p.type] = groups[p.type] || [];
  groups[p.type].push(p);
});

/* BUILD NEPALI TEXT */
let ne = "рдпрд╕ рд╡реНрдпрд╡рд╕рд╛рдп рдпреЛрдЬрдирд╛рдЕрдиреНрддрд░реНрдЧрдд рдирд┐рдореНрди рдЙрддреНрдкрд╛рджрдирд╣рд░реВ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░рд┐рдПрдХреЛ рдЫред\n\n";

Object.keys(groups).forEach(type=>{
  ne += "ЁЯФ╣ " + type + " рдЙрддреНрдкрд╛рджрди:\n";
  groups[type].forEach(p=>{
    ne += "тАУ " + p.name + " : " + p.qty + " " + (p.unit||"") ;
    if(p.note) ne += " ("+p.note+")";
    ne += "\n";
  });
  ne += "\n";
});

ne += "рдЙрдкрд░реЛрдХреНрдд рдЙрддреНрдкрд╛рджрдирд╣рд░реВрдмрд╛рдЯ рдмрдЬрд╛рд░рдорд╛ рдмрд┐рдХреНрд░реАрдпреЛрдЧреНрдп рдЙрддреНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рд╣реБрдиреЗ рд░ рддреНрдпрд╕рдмрд╛рдЯ рдЖрдореНрджрд╛рдиреА рд╕рд┐рд░реНрдЬрдирд╛ рд╣реБрдиреЗ рдЕрдкреЗрдХреНрд╖рд╛ рдЧрд░рд┐рдПрдХреЛ рдЫред";

/* BUILD ENGLISH TEXT */
let en = "This business plan includes the following production activities.\n\n";

Object.keys(groups).forEach(type=>{
  en += "тАв " + type + " products:\n";
  groups[type].forEach(p=>{
    en += "- " + p.name + ": " + p.qty + " " + (p.unit||"");
    if(p.note) en += " ("+p.note+")";
    en += "\n";
  });
  en += "\n";
});

en += "The above production activities are expected to generate marketable outputs and corresponding income.";

/* LOAD OR INIT */
neText.value = project.productionNarrativeNe || ne;
enText.value = project.productionNarrativeEn || en;

/* SAVE ON EDIT */
neText.oninput = ()=>{
  project.productionNarrativeNe = neText.value;
  save();
};
enText.oninput = ()=>{
  project.productionNarrativeEn = enText.value;
  save();
};

function save(){
  localStorage.setItem(key,JSON.stringify(project));
}
</script>

</body>
</html>


