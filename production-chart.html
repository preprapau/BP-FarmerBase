<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Production Charts | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#fff;
  margin:20px;
}
h2,h3{
  color:#2e7d32;
  margin-bottom:6px;
}
.small{
  font-size:13px;
  color:#555;
  margin-bottom:14px;
}
canvas{
  max-width:900px;
  margin:30px auto;
  display:block;
}
.section{
  margin-top:30px;
}
button{
  padding:6px 12px;
  margin-bottom:10px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #000;
  padding:6px;
  font-size:14px;
}
th{background:#f0f0f0}
.right{text-align:right}
</style>
</head>

<body>

<h2>ЁЯез Production Charts (рдЙрддреНрдкрд╛рджрди рджреГрд╢реНрдп рд╡рд┐рд╢реНрд▓реЗрд╖рдг)</h2>
<button onclick="window.print()">ЁЯЦия╕П Print</button>

<p class="small">
рдпреЛ рдЪрд╛рд░реНрдЯрд╣рд░реВ Production Master Page рдорд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдЧрд░рд┐рдПрдХреЛ рдбрд╛рдЯрд╛рдорд╛ рдЖрдзрд╛рд░рд┐рдд рдЫрдиреНред
</p>

<!-- ===== PIE CHART ===== -->
<div class="section">
  <h3>ЁЯУК рдЙрддреНрдкрд╛рджрди рдорд┐рд╢реНрд░рдг (Production Mix)</h3>
  <canvas id="mixPie"></canvas>
</div>

<!-- ===== BAR CHART ===== -->
<div class="section">
  <h3>ЁЯУИ рдЙрддреНрдкрд╛рджрди рдкрд░рд┐рдорд╛рдг рддреБрд▓рдирд╛</h3>
  <canvas id="qtyBar"></canvas>
</div>

<!-- ===== TABLE ===== -->
<div class="section">
  <h3>ЁЯУД рдЙрддреНрдкрд╛рджрди рд╡рд┐рд╡рд░рдг рддрд╛рд▓рд┐рдХрд╛</h3>
  <table>
    <thead>
      <tr>
        <th>рдЙрддреНрдкрд╛рджрди</th>
        <th>рдкреНрд░рдХрд╛рд░</th>
        <th class="right">рдкрд░рд┐рдорд╛рдг</th>
        <th>рдЗрдХрд╛рдЗ</th>
      </tr>
    </thead>
    <tbody id="prodTable"></tbody>
  </table>
</div>

<script>
/* LOAD PROJECT */
const key = localStorage.getItem("activeProject");
if(!key){ alert("Active рдпреЛрдЬрдирд╛ рднреЗрдЯрд┐рдПрди"); }
const project = JSON.parse(localStorage.getItem(key)) || {};
const products = project.productionProducts || [];

/* PREP DATA */
const labels = [];
const qtyData = [];
const tableBody = document.getElementById("prodTable");

products.forEach(p=>{
  if(!p.name || p.qty<=0) return;
  labels.push(p.name);
  qtyData.push(p.qty);

  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${p.name}</td>
    <td>${p.type||""}</td>
    <td class="right">${p.qty}</td>
    <td>${p.unit||""}</td>
  `;
  tableBody.appendChild(tr);
});

/* PIE: Production Mix */
new Chart(document.getElementById("mixPie"),{
  type:"pie",
  data:{
    labels:labels,
    datasets:[{
      data:qtyData,
      backgroundColor:[
        "#81c784","#4db6ac","#64b5f6",
        "#ffd54f","#ff8a65","#a1887f"
      ]
    }]
  },
  options:{
    responsive:true
  }
});

/* BAR: Quantity Comparison */
new Chart(document.getElementById("qtyBar"),{
  type:"bar",
  data:{
    labels:labels,
    datasets:[{
      label:"рдЙрддреНрдкрд╛рджрди рдкрд░рд┐рдорд╛рдг",
      data:qtyData,
      backgroundColor:"#66bb6a"
    }]
  },
  options:{
    responsive:true,
    plugins:{ legend:{ display:false } },
    scales:{ y:{ beginAtZero:true } }
  }
});
</script>

</body>
</html>

Income

<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Production тЖТ Income Link | FarmerBase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#fff;
  margin:20px;
}
h2{
  color:#2e7d32;
  margin-bottom:6px;
}
.small{
  font-size:13px;
  color:#555;
  margin-bottom:14px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #000;
  padding:6px;
  font-size:14px;
}
th{background:#f0f0f0}
.right{text-align:right}
.highlight{
  background:#e8f5e9;
  font-weight:700;
}
button{
  padding:6px 12px;
  margin-bottom:10px;
}
.note{
  margin-top:16px;
  font-size:13px;
  color:#444;
}
</style>
</head>

<body>

<h2>ЁЯУИ Production тЖТ Income Link Report</h2>
<button onclick="window.print()">ЁЯЦия╕П Print</button>

<p class="small">
рдпреЛ рд░рд┐рдкреЛрд░реНрдЯ Production Master рд░ Income Page рдорд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдЧрд░рд┐рдПрдХреЛ рдбрд╛рдЯрд╛рдХрд╛ рдЖрдзрд╛рд░рдорд╛
рддрдпрд╛рд░ рдЧрд░рд┐рдПрдХреЛ рд╣реЛред
</p>

<table>
<thead>
<tr>
  <th>рдЙрддреНрдкрд╛рджрди</th>
  <th>рдкреНрд░рдХрд╛рд░</th>
  <th class="right">рдЙрддреНрдкрд╛рджрди рдкрд░рд┐рдорд╛рдг</th>
  <th>рдЗрдХрд╛рдЗ</th>
  <th class="right">рдмрд┐рдХреНрд░реА рджрд░</th>
  <th class="right">рдЕрдиреБрдорд╛рдирд┐рдд рдЖрдореНрджрд╛рдиреА</th>
</tr>
</thead>
<tbody id="linkBody"></tbody>
<tfoot>
<tr class="highlight">
  <th colspan="5">рдХреБрд▓ рдЕрдиреБрдорд╛рдирд┐рдд рдЖрдореНрджрд╛рдиреА</th>
  <th class="right" id="grandIncome">0</th>
</tr>
</tfoot>
</table>

<div class="note">
<strong>ЁЯФН Note:</strong><br>
тАв рдЙрддреНрдкрд╛рджрди рдкрд░рд┐рдорд╛рдг Production Page рдмрд╛рдЯ рдЖрдПрдХреЛ рд╣реЛред<br>
тАв рдмрд┐рдХреНрд░реА рджрд░ Income Page рдмрд╛рдЯ рдЖрдПрдХреЛ рд╣реЛред<br>
тАв рдХреБрдиреИ рдЙрддреНрдкрд╛рджрдирдорд╛ рджрд░ рдирджрд┐рдЗрдПрдХреЛ рдЦрдгреНрдбрдорд╛ рдЖрдореНрджрд╛рдиреА 0 рджреЗрдЦрд┐рди рд╕рдХреНрдЫред
</div>

<script>
/* LOAD PROJECT */
const key = localStorage.getItem("activeProject");
if(!key){ alert("Active рдпреЛрдЬрдирд╛ рднреЗрдЯрд┐рдПрди"); }
const project = JSON.parse(localStorage.getItem(key)) || {};

/* DATA SOURCES */
const products = project.productionProducts || [];
const incomes = project.incomes || [];

/* MAP income by productId */
const rateMap = {};
incomes.forEach(i=>{
  if(i.productId){
    rateMap[i.productId] = Number(i.rate)||0;
  }
});

/* RENDER */
let totalIncome = 0;

products.forEach(p=>{
  if(!p.name || p.qty<=0) return;

  const rate = rateMap[p.id] || 0;
  const income = p.qty * rate;
  totalIncome += income;

  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${p.name}</td>
    <td>${p.type||""}</td>
    <td class="right">${p.qty}</td>
    <td>${p.unit||""}</td>
    <td class="right">${rate.toFixed(2)}</td>
    <td class="right">${income.toFixed(2)}</td>
  `;
  linkBody.appendChild(tr);
});

grandIncome.innerText = totalIncome.toFixed(2);
</script>

</body>
</html>
