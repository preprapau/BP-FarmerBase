<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (Save)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:950px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:8px;
}
h1,h2{color:#2e7d32}
h1{text-align:center;margin-top:0}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
}
th{background:#f0f0f0}
.right{text-align:right}

input{
  width:100%;
  padding:4px;
  box-sizing:border-box;
}

.note{
  font-size:13px;
  color:#555;
  margin-top:10px;
}

button{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
  margin-top:15px;
}

@media print{
  input,button{display:none}
  body{background:#fff}
  table{page-break-inside:avoid}
  tr{page-break-inside:avoid}
}
</style>
</head>

<body>

<div class="container">

<h1>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛</h1>

Reminder: рдпреЛ рдкреЗрдЬрдорд╛ Save рдЧрд░реЗрдкрдЫрд┐ рдорд╛рддреНрд░ Proposal рдорд╛ рджреЗрдЦрд┐рдиреНрдЫред

<!-- ===== BASE INPUT ===== -->
<h2>рдЖрдзрд╛рд░рднреВрдд рд╡рд┐рд╡рд░рдг</h2>
<table>
<tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдмрдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td><input id="startAdult" value="300"></td></tr>
<tr><th>рдмреНрдпрд╛рдЙрдиреЗ рджрд░ (%)</th><td><input id="birthRate" value="90"></td></tr>
<tr><th>рдкреНрд░рддрд┐ рдмрдпрд╕реНрдХ рд╡рд╛рд░реНрд╖рд┐рдХ рдмрдЪреНрдЪрд╛</th><td><input id="kidsPerAdult" value="20"></td></tr>
<tr><th>рднрд╛рд▓реЗ : рдкреЛрдереА рдЕрдиреБрдкрд╛рдд (%)</th><td><input id="sexRatio" value="50"></td></tr>
<tr><th>рдореГрддреНрдпреБрджрд░ (%)</th><td><input id="deathRate" value="10"></td></tr>
<tr><th>рд░рд╛рдЦрд┐рдиреЗ (%)</th><td><input id="keepRate" value="50"></td></tr>
<tr><th>рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди (%)</th><td><input id="replaceRate" value="10"></td></tr>
</table>

<!-- ===== RESULT ===== -->
<h2>рел рд╡рд░реНрд╖реЗ рдкрд░рд┐рдгрд╛рдо (рд╕реНрд╡рддрдГ рдЧрдгрдирд╛)</h2>
<table>
<thead>
<tr>
  <th>рд╡рд░реНрд╖</th>
  <th class="right">рдмрдпрд╕реНрдХ</th>
  <th class="right">рдмрдЪреНрдЪрд╛</th>
  <th class="right">рдорд░реЗрдХрд╛</th>
  <th class="right">рдмрд┐рдХреНрд░реА</th>
  <th class="right">рд░рд╛рдЦрд┐рдиреЗ</th>
  <th class="right">рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдмрд┐рдХреНрд░реА</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>

<button onclick="calculate()">ЁЯТ╛ Save & Calculate</button>

<div class="note">
ЁЯУМ рдиреЛрдЯ: рдореГрддреНрдпреБрджрд░ рдХрдЯрд╛рдПрдкрдЫрд┐ рдорд╛рддреНрд░ рдмрд┐рдХреНрд░реА, рд░рд╛рдЦрд┐рдиреЗ рддрдерд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЧрдгрдирд╛ рдЧрд░рд┐рдиреНрдЫред
</div>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("Project рднреЗрдЯрд┐рдПрди");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(key) || "{}");

/* ===== CALCULATE & SAVE ===== */
function calculate(){

  let startAdult = +startAdultInput.value;
  let birthRate = +birthRateInput.value/100;
  let kidsPerAdult = +kidsPerAdultInput.value;
  let sexRatio = +sexRatioInput.value/100;
  let deathRate = +deathRateInput.value/100;
  let keepRate = +keepRateInput.value/100;
  let replaceRate = +replaceRateInput.value/100;

  let adult = startAdult;
  let results = [];

  resultBody.innerHTML="";

  for(let y=1;y<=5;y++){

    let breeders = adult * birthRate;
    let kids = breeders * kidsPerAdult;

    let died = Math.round(kids * deathRate);
    let survived = kids - died;

    let sell = Math.round(survived * (1-keepRate));
    let keep = survived - sell;

    let replace = Math.round(adult * replaceRate);

    results.push({
      year:y,
      adult:adult,
      kids:kids,
      death:died,
      sell:sell,
      keep:keep,
      replace:replace
    });

    resultBody.innerHTML += `
      <tr>
        <td>${y}</td>
        <td class="right">${adult}</td>
        <td class="right">${kids}</td>
        <td class="right">${died}</td>
        <td class="right">${sell}</td>
        <td class="right">${keep}</td>
        <td class="right">${replace}</td>
      </tr>
    `;

    adult = keep; // next year adult
  }

  /* ===== SAVE ===== */
  project.productionSales = {
    base:{
      startAdult,birthRate,kidsPerAdult,sexRatio,deathRate,keepRate,replaceRate
    },
    result:results
  };

  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key, JSON.stringify(project));
}

/* ===== INPUT SHORTCUT ===== */
const startAdultInput = document.getElementById("startAdult");
const birthRateInput = document.getElementById("birthRate");
const kidsPerAdultInput = document.getElementById("kidsPerAdult");
const sexRatioInput = document.getElementById("sexRatio");
const deathRateInput = document.getElementById("deathRate");
const keepRateInput = document.getElementById("keepRate");
const replaceRateInput = document.getElementById("replaceRate");

/* Auto calculate on load */
window.onload = calculate;
</script>

</body>
</html>
