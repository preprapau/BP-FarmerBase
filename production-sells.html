<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ | Farmerbase BP Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;margin:0
}
header,footer{
  background:#e8f5e9;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px
}
header a,footer a{
  text-decoration:none;
  color:#2e7d32;
  font-weight:600
}
.container{
  max-width:1050px;
  margin:18px auto;
  background:#fff;
  padding:22px;
  border-radius:12px
}
h1,h2{color:#2e7d32;text-align:center}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center
}
th{background:#eef5ee}
input,select{
  width:100%;
  padding:6px;
  box-sizing:border-box
}
.note{font-size:13px;color:#555}
.auto{color:#2e7d32;font-size:13px}
</style>
</head>

<body>

<header>
  <a href="index.html">ЁЯПа Back to Home</a>
  <div>
    <a href="short-info.html">тЧАя╕П Previous</a> |
    <a href="operating-cost-engine.html">Operating Cost тЦ╢я╕П</a>
  </div>
</header>

<div class="container">

<h1>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛ (Auto-Save)</h1>

<table>
<tr>
  <th>рд╡реНрдпрд╡рд╕рд╛рдп рдкреНрд░рдХрд╛рд░</th>
  <td>
    <select id="bizType">
      <option value="pig">рдмрдВрдЧреБрд░</option>
      <option value="goat">рдмрд╛рдЦреНрд░рд╛</option>
      <option value="veg">рддрд░рдХрд╛рд░реА</option>
    </select>
  </td>
</tr>
<tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдмрдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td><input id="adult"></td></tr>
<tr><th>рдмреНрдпрд╛рдЙрдиреЗ рджрд░ (%)</th><td><input id="breedRate"></td></tr>
<tr><th>рдкреНрд░рддрд┐ рдмрдпрд╕реНрдХ рд╡рд╛рд░реНрд╖рд┐рдХ рдЙрддреНрдкрд╛рджрди</th><td><input id="kids"></td></tr>
<tr><th>рдореГрддреНрдпреБрджрд░ (%)</th><td><input id="death"></td></tr>
<tr><th>рд░рд╛рдЦрд┐рдиреЗ рдкреЛрдереА (%)</th><td><input id="keepFemale"></td></tr>
<tr><th>рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдмрд┐рдХреНрд░реА (%)</th><td><input id="replacement"></td></tr>
</table>

<h2>ЁЯФв Stage-wise рд╕рдВрдЦреНрдпрд╛ рд╡рд┐рддрд░рдг</h2>

<table>
<tr>
  <th>Stage</th><th>Label</th><th>рджрд┐рди</th><th>%</th><th>рд╕рдВрдЦреНрдпрд╛</th>
</tr>
<tr>
  <td>S1</td>
  <td><input id="l1"></td>
  <td><input id="d1"></td>
  <td><input id="p1"></td>
  <td id="c1">0</td>
</tr>
<tr>
  <td>S2</td>
  <td><input id="l2"></td>
  <td><input id="d2"></td>
  <td><input id="p2"></td>
  <td id="c2">0</td>
</tr>
<tr>
  <td>S3</td>
  <td><input id="l3"></td>
  <td><input id="d3"></td>
  <td><input id="p3"></td>
  <td id="c3">0</td>
</tr>
<tr>
  <td>S4</td>
  <td><input id="l4"></td>
  <td><input id="d4"></td>
  <td><input id="p4"></td>
  <td id="c4">0</td>
</tr>
</table>

<p class="auto">тЬФя╕П рдХреБрдиреИ рдкрдирд┐ рдкрд░рд┐рд╡рд░реНрддрди рд╣реБрдБрджрд╛ Auto-Save рд╣реБрдиреНрдЫ</p>

</div>

<footer>
  <a href="short-info.html">тЧАя╕П Previous</a>
  <a href="index.html">ЁЯПа Home</a>
  <a href="operating-cost-engine.html">Next тЦ╢я╕П</a>
</footer>

<script>
function num(id){return Number(document.getElementById(id).value)||0}
function $(id){return document.getElementById(id)}

let saved = JSON.parse(localStorage.getItem("PRODUCTION_STAGE_DATA")) || {
  businessType:"pig",
  adult:300,
  breedRate:90,
  kids:20,
  death:10,
  keepFemale:40,
  replacement:10,
  stages:{
    S1:{label:"1тАУ3 рдорд╣рд┐рдирд╛",days:90,pct:30},
    S2:{label:"4тАУ5 рдорд╣рд┐рдирд╛",days:60,pct:25},
    S3:{label:"5тАУ9 рдорд╣рд┐рдирд╛",days:120,pct:25},
    S4:{label:"10+ рдорд╣рд┐рдирд╛",days:365,pct:20}
  }
};

/* ===== RESTORE ===== */
bizType.value = saved.businessType;
adult.value = saved.adult;
breedRate.value = saved.breedRate;
kids.value = saved.kids;
death.value = saved.death;
keepFemale.value = saved.keepFemale;
replacement.value = saved.replacement;

["1","2","3","4"].forEach(i=>{
  $("l"+i).value = saved.stages["S"+i].label;
  $("d"+i).value = saved.stages["S"+i].days;
  $("p"+i).value = saved.stages["S"+i].pct;
});

/* ===== AUTO SAVE + CALCULATE ===== */
function saveAndCalculate(){
  let alive = num("adult")*(num("breedRate")/100)*num("kids");
  alive = alive*(100-num("death"))/100;

  let stages={};
  let totalPct=0;

  ["1","2","3","4"].forEach(i=>{
    let pct=num("p"+i);
    totalPct+=pct;
    let cnt=Math.round(alive*pct/100);
    $("c"+i).innerText=cnt;
    stages["S"+i]={
      label:$("l"+i).value,
      days:num("d"+i),
      pct:pct,
      count:cnt
    };
  });

  if(totalPct!==100) return;

  localStorage.setItem("PRODUCTION_STAGE_DATA",JSON.stringify({
    businessType:bizType.value,
    adult:num("adult"),
    breedRate:num("breedRate"),
    kids:num("kids"),
    death:num("death"),
    keepFemale:num("keepFemale"),
    replacement:num("replacement"),
    alive,
    stages
  }));
}

/* ===== AUTO SAVE EVENTS ===== */
document.addEventListener("input",e=>{
  if(e.target.tagName==="INPUT" || e.target.tagName==="SELECT"){
    saveAndCalculate();
  }
});

/* INIT */
saveAndCalculate();
</script>

</body>
</html>
