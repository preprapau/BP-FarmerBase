<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§§‡§•‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ (Year-wise Save)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:980px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:8px;
}
h1,h2{color:#2e7d32}
h1{text-align:center;margin-top:0}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
}
th{background:#f0f0f0}
.right{text-align:right}

input{
  width:100%;
  padding:4px;
}

button{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
  margin-top:15px;
}

@media print{
  input,button{display:none}
  body{background:#fff}
  table{page-break-inside:avoid}
  tr{page-break-inside:avoid}
}
</style>
</head>

<body>

<div class="container">

<h1>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§§‡§•‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ</h1>

<!-- ===== BASE INPUT ===== -->
<h2>‡§Ü‡§ß‡§æ‡§∞‡§≠‡•Ç‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>
<table>
<tr><th>‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§¨‡§Ø‡§∏‡•ç‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ</th><td><input id="startAdult" value="300"></td></tr>
<tr><th>‡§™‡•ç‡§∞‡§§‡§ø ‡§¨‡§Ø‡§∏‡•ç‡§ï ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§î‡§∏‡§§ ‡§¨‡§ö‡•ç‡§ö‡§æ</th><td><input id="kidsPerAdult" value="20"></td></tr>
<tr><th>‡§≠‡§æ‡§≤‡•á ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ (%)</th><td><input id="maleRatio" value="50"></td></tr>
</table>

<!-- ===== YEAR-WISE INPUT ===== -->
<h2>‡§µ‡§∞‡•ç‡§∑‡§ó‡§§ ‡§Æ‡§æ‡§™‡§¶‡§£‡•ç‡§° (Year-wise)</h2>
<table>
<thead>
<tr>
  <th>‡§µ‡§∞‡•ç‡§∑</th>
  <th>‡§¨‡•ç‡§Ø‡§æ‡§â‡§®‡•á ‡§¶‡§∞ %</th>
  <th>‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞ %</th>
  <th>‡§¨‡§ö‡•ç‡§ö‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä %</th>
  <th>‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡•ç‡§•‡§æ‡§™‡§® %</th>
</tr>
</thead>
<tbody id="yearInput"></tbody>
</table>

<!-- ===== RESULT ===== -->
<h2>‡•´ ‡§µ‡§∞‡•ç‡§∑‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ (‡§∏‡•ç‡§µ‡§§‡§É ‡§ó‡§£‡§®‡§æ)</h2>
<table>
<thead>
<tr>
  <th>‡§µ‡§∞‡•ç‡§∑</th>
  <th class="right">‡§¨‡§Ø‡§∏‡•ç‡§ï</th>
  <th class="right">‡§ú‡§®‡•ç‡§Æ‡§ø‡§è‡§ï‡§æ ‡§¨‡§ö‡•ç‡§ö‡§æ</th>
  <th class="right">‡§ñ‡•á‡§∞ ‡§ó‡§è‡§ï‡•ã</th>
  <th class="right">‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä (‡§¨‡§ö‡•ç‡§ö‡§æ)</th>
  <th class="right">‡§¨‡§Ø‡§∏‡•ç‡§ï ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</th>
  <th class="right">‡§Ö‡§∞‡•ç‡§ï‡•ã ‡§µ‡§∞‡•ç‡§∑‡§ï‡§æ ‡§¨‡§Ø‡§∏‡•ç‡§ï</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>

<button onclick="calculate()">üíæ Save & Calculate</button>

</div>

<script>
/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
if(!key){
  alert("Project ‡§≠‡•á‡§ü‡§ø‡§è‡§®");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(key)||"{}");

/* ===== INIT YEAR INPUT ===== */
let yearInput = document.getElementById("yearInput");
for(let y=1;y<=5;y++){
  yearInput.innerHTML += `
  <tr>
    <td>${y}</td>
    <td><input value="${90+y}"></td>
    <td><input value="${10-(y-1)}"></td>
    <td><input value="${60+y*2}"></td>
    <td><input value="10"></td>
  </tr>`;
}

/* ===== CALCULATE & SAVE (YEAR-WISE LOGIC) ===== */
function calculate(){

  let adult = +startAdult.value;
  let kidsPerAdult = +kidsPerAdult.value;
  let maleRatio = +maleRatio.value/100;

  let rows = yearInput.querySelectorAll("tr");
  let results = [];
  resultBody.innerHTML="";

  rows.forEach((r,i)=>{
    let cells = r.querySelectorAll("input");

    let birthRate = cells[0].value/100;
    let deathRate = cells[1].value/100;
    let sellRate  = cells[2].value/100;
    let replaceRate = cells[3].value/100;

    let breeders = adult * birthRate;
    let born = breeders * kidsPerAdult;

    let died = born * deathRate;
    let survived = born - died;

    let childSold = survived * sellRate;
    let adultSold = adult * replaceRate;

    let kept = survived - childSold;
    let nextAdult = adult - adultSold + kept;

    results.push({
      year:i+1,
      adult:Math.round(adult),
      born:Math.round(born),
      death:Math.round(died),
      childSold:Math.round(childSold),
      adultSold:Math.round(adultSold),
      nextAdult:Math.round(nextAdult)
    });

    resultBody.innerHTML += `
    <tr>
      <td>${i+1}</td>
      <td class="right">${Math.round(adult)}</td>
      <td class="right">${Math.round(born)}</td>
      <td class="right">${Math.round(died)}</td>
      <td class="right">${Math.round(childSold)}</td>
      <td class="right">${Math.round(adultSold)}</td>
      <td class="right">${Math.round(nextAdult)}</td>
    </tr>`;

    adult = nextAdult;
  });

  /* ===== SAVE ===== */
  project.productionSales = {
    base:{
      startAdult,
      kidsPerAdult,
      maleRatio
    },
    yearWise: results
  };

  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key, JSON.stringify(project));
}

/* Auto calculate on load */
window.onload = calculate;
</script>

</body>
</html>
