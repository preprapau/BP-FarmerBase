<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati",system-ui;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:980px;
  margin:25px auto;
  background:#fff;
  padding:30px;
  border-radius:8px;
}
h1{color:#2e7d32;text-align:center;margin-top:0}

/* ===== Tabs ===== */
.tabs{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}
.tab-btn{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  background:#e0e0e0;
  display:flex;
  align-items:center;
  gap:6px;
}
.tab-btn.active{
  background:#2e7d32;
  color:#fff;
}
.badge{
  background:#fff;
  color:#2e7d32;
  font-size:12px;
  padding:2px 8px;
  border-radius:12px;
  font-weight:bold;
}
.tab-btn.active .badge{
  background:#c8e6c9;
}
.tab-content{display:none}
.tab-content.active{display:block}

/* ===== Table ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
}
th{background:#f0f0f0}
.right{text-align:right}

input{
  width:100%;
  padding:4px;
}

button.main{
  padding:8px 18px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
  margin-top:15px;
}

.error{
  color:#d32f2f;
  font-size:13px;
  margin-top:8px;
}

/* ===== Print ===== */
@media print{
  input,button,.tabs{display:none}
  body{background:#fff}
  .tab-content{display:block !important}
  table{page-break-inside:avoid}
}
</style>
</head>

<body>

<div class="container">
<h1>рдЙрддреНрдкрд╛рджрди рддрдерд╛ рдмрд┐рдХреНрд░реА рдпреЛрдЬрдирд╛</h1>

<!-- ===== Tabs ===== -->
<div class="tabs">
  <button class="tab-btn active" onclick="openTab('inputTab',this)">
    ЁЯУЭ рд╡рд┐рд╡рд░рдг
  </button>
  <button class="tab-btn" onclick="openTab('calcTab',this)">
    ЁЯУК рдЧрдгрдирд╛ <span class="badge">рел рд╡рд░реНрд╖</span>
  </button>
</div>

<!-- ===== INPUT TAB ===== -->
<div id="inputTab" class="tab-content active">

<table>
<tr><th>рдкреНрд░рд╛рд░рдореНрднрд┐рдХ рдмрдпрд╕реНрдХ рд╕рдВрдЦреНрдпрд╛</th><td><input id="adultStart" value="300"></td></tr>
<tr><th>рдмреНрдпрд╛рдЙрдиреЗ рджрд░ (%)</th><td><input id="breedRate" value="90"></td></tr>
<tr><th>рдкреНрд░рддрд┐ рдмрдпрд╕реНрдХ рд╡рд╛рд░реНрд╖рд┐рдХ рдмрдЪреНрдЪрд╛</th><td><input id="kidsPerAdult" value="20"></td></tr>
<tr><th>рдмрдЪреНрдЪрд╛ рдореГрддреНрдпреБрджрд░ (%)</th><td><input id="deathRate" value="10"></td></tr>
<tr><th>рднрд╛рд▓реЗ рдЕрдиреБрдкрд╛рдд (%)</th><td><input id="maleRatio" value="50"></td></tr>
<tr><th>рд░рд╛рдЦрд┐рдиреЗ рднрд╛рд▓реЗ (%)</th><td><input id="keepMale" value="0"></td></tr>
<tr><th>рд░рд╛рдЦрд┐рдиреЗ рдкреЛрдереА (%)</th><td><input id="keepFemale" value="40"></td></tr>
<tr><th>рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди (рдмрдпрд╕реНрдХ рдмрд┐рдХреНрд░реА %) </th><td><input id="replaceRate" value="10"></td></tr>
</table>

<div id="errorBox" class="error"></div>

<button class="main" onclick="calculate()">ЁЯТ╛ Save & Calculate</button>

</div>

<!-- ===== CALC TAB ===== -->
<div id="calcTab" class="tab-content">

<table>
<thead>
<tr>
  <th>рд╡рд░реНрд╖</th>
  <th class="right">рдмрдпрд╕реНрдХ</th>
  <th class="right">рдЬрдиреНрдорд┐рдПрдХрд╛</th>
  <th class="right">рдорд░реЗрдХрд╛</th>
  <th class="right">рднрд╛рд▓реЗ рдмрд┐рдХреНрд░реА</th>
  <th class="right">рдкреЛрдереА рдмрд┐рдХреНрд░реА</th>
  <th class="right">рдмрдпрд╕реНрдХ рдмрд┐рдХреНрд░реА</th>
  <th class="right">рдЕрд░реНрдХреЛ рд╡рд░реНрд╖ рдмрдпрд╕реНрдХ</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>

</div>

</div>

<script>
/* ===== TAB SWITCH ===== */
function openTab(id,btn){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

/* ===== LOAD PROJECT ===== */
let key = localStorage.getItem("activeProject");
let project = JSON.parse(localStorage.getItem(key)||"{}");

/* ===== VALIDATION ===== */
function validPercent(v){
  return v>=0 && v<=100;
}

function calculate(){

  let err = "";

  let adult = +adultStart.value;
  let breedRate = +breedRate.value;
  let kidsPerAdult = +kidsPerAdult.value;
  let deathRate = +deathRate.value;
  let maleRatio = +maleRatio.value;
  let keepMale = +keepMale.value;
  let keepFemale = +keepFemale.value;
  let replaceRate = +replaceRate.value;

  if(
    ![breedRate,deathRate,maleRatio,keepMale,keepFemale,replaceRate]
      .every(validPercent)
  ){
    err = "тЭМ рд╕рдмреИ рдкреНрд░рддрд┐рд╢рдд рдорд╛рди режтАУрезрежреж рднрд┐рддреНрд░ рд╣реБрдиреБрдкрд░реНрдЫ ред";
  }

  if(maleRatio>100){
    err = "тЭМ рднрд╛рд▓реЗ рдЕрдиреБрдкрд╛рдд резрежреж% рднрдиреНрджрд╛ рдмрдвреА рд╣реБрди рд╕рдХреНрджреИрди ред";
  }

  if(err){
    errorBox.innerText = err;
    return;
  }
  errorBox.innerText="";

  /* ===== LOGIC ===== */
  resultBody.innerHTML="";
  let results=[];

  for(let year=1;year<=5;year++){

    let breeders = adult * (breedRate/100);
    let born = breeders * kidsPerAdult;

    let died = born * (deathRate/100);
    let survived = born - died;

    let male = survived * (maleRatio/100);
    let female = survived - male;

    let maleKept = male * (keepMale/100);
    let maleSold = male - maleKept;

    let femaleKept = female * (keepFemale/100);
    let femaleSold = female - femaleKept;

    let adultSold = adult * (replaceRate/100);

    let nextAdult =
      (adult - adultSold) +
      maleKept +
      femaleKept;

    results.push({year,adult,born,died,maleSold,femaleSold,adultSold,nextAdult});

    resultBody.innerHTML += `
    <tr>
      <td>${year}</td>
      <td class="right">${Math.round(adult)}</td>
      <td class="right">${Math.round(born)}</td>
      <td class="right">${Math.round(died)}</td>
      <td class="right">${Math.round(maleSold)}</td>
      <td class="right">${Math.round(femaleSold)}</td>
      <td class="right">${Math.round(adultSold)}</td>
      <td class="right">${Math.round(nextAdult)}</td>
    </tr>`;

    adult = nextAdult;
  }

  /* ===== SAVE ===== */
  project.productionSales = {
    logic:"Male/Female separate keep %, adult carry-forward",
    result:results
  };
  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(key,JSON.stringify(project));

  openTab('calcTab',document.querySelectorAll('.tab-btn')[1]);
}

window.onload = calculate;
</script>

</body>
</html>
